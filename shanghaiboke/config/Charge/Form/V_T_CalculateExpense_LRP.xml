<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="V_T_CalculateExpense_LRP" Caption="承运商费用计算">
    <Body>
        <Block>
            <FlexFlowLayoutPanel Key="root" Caption="根面板">
                <GridLayoutPanel Key="first_head" Padding="5px" Height="pref" Caption="基本信息">
                    <Dict Key="DispatchOrg" Caption="调度组织" BuddyKey="Lab_DispatchOrg" X="1" Y="0" AllowMultiSelection="true" ItemKey="LRP_DispatchOrg" TabOrder="10" XSpan="3"/>
                    <Label Key="Lab_DispatchOrg" Caption="调度组织" X="0" Y="0"/>
                    <Dict Key="Carrier" Caption="承运商" BuddyKey="Lab_Carrier" X="6" Y="0" AllowMultiSelection="true" ItemKey="LRP_Carrier" TabOrder="20" XSpan="3"/>
                    <Label Key="Lab_Carrier" Caption="承运商" X="5" Y="0"/>
                    <DatePicker Key="StartDate" Caption="日期范围起" BuddyKey="Lab_StartDate" X="1" Y="1" TabOrder="30" XSpan="3"/>
                    <Label Key="Lab_StartDate" Caption="日期范围起" X="0" Y="1"/>
                    <DatePicker Key="EndDate" Caption="至" BuddyKey="Lab_EndDate" X="6" Y="1" TabOrder="40" XSpan="3"/>
                    <Label Key="Lab_EndDate" Caption="至" X="5" Y="1"/>
                    <ComboBox Key="DateField" Caption="日期字段" BuddyKey="Lab_DateField" X="1" Y="2" Enable="false" Clearable="false" XSpan="3">
                        <DataBinding DefaultValue="OrderDateTime"/>
                        <Item Caption="下单日期时间" Key="OrderDateTime" Value="OrderDateTime"/>
                    </ComboBox>
                    <Label Key="Lab_DateField" Caption="日期字段" X="0" Y="2"/>
                    <TextEditor Key="No" Caption="运输调度单号" BuddyKey="Lab_No" X="6" Y="2" MaxLength="40" TabOrder="60" XSpan="3" Trim="true"/>
                    <Label Key="Lab_No" Caption="运输调度单号" X="5" Y="2"/>
                    <Button Key="Calculate" Caption="计算" X="10" Y="0" TabOrder="100">
                        <OnClick>
                            <![CDATA[OUT(GetValue('DispatchOrg'));
OUT(CheckListBox1);
if (IsControlNull("DateField")){
    Confirm(LocaleString('CHshow','chkey3'),'OK');
    return 0;
}

if (IsControlNull("No")) {
    if (IsControlNull("DispatchOrg") || IsControlNull("Carrier") || IsControlNull("StartDate") || IsControlNull("EndDate")) {
         Confirm(LocaleString('CHshow','chkey14'),'OK');
         return 0;
    }
}



//后台计算
var r = InvokeService("LRP_T_CalculateExpense", false, false, GetValue("No"),GetJSONValue("DispatchOrg"),GetJSONValue("Carrier"),GetValue("StartDate"),GetValue("EndDate"),GetValue("DateField"));
if (r == 1){
    Confirm(LocaleString('CHshow','chkey5'),'OK','OK:{}');
}
]]>
                        </OnClick>
                    </Button>
                    <Button Key="Reset" Caption="重置" X="10" Y="1" TabOrder="120">
                        <OnClick>
                            <![CDATA[//设置各条件字段为空
SetValue("DispatchOrg","");
SetValue("Carrier","");
SetValue("StartDate", "");
SetValue("EndDate", "");
SetValue("No", "");
]]>
                        </OnClick>
                    </Button>
                    <CheckListBox BuddyKey="Lab_CheckListBox1" Caption="CheckListBox1" Key="CheckListBox1" SourceType="Query" X="1" XSpan="3" Y="3">
                        <QueryDef>
                            <Statement>
                                <![CDATA[select oid,name from lrp_dispatchorg where oid>0]]>
                            </Statement>
                            <ParameterCollection/>
                        </QueryDef>
                    </CheckListBox>
                    <Label Key="Lab_CheckListBox1" Caption="CheckListBox1" X="0" Y="3"/>
                    <RowDefCollection RowGap="8">
                        <RowDef Height="30px"/>
                        <RowDef Height="30px"/>
                        <RowDef Height="30px"/>
                        <RowDef Height="30px"/>
                    </RowDefCollection>
                    <ColumnDefCollection ColumnGap="8">
                        <ColumnDef Width="70px"/>
                        <ColumnDef Width="25%"/>
                        <ColumnDef Width="55px"/>
                        <ColumnDef Width="25%"/>
                        <ColumnDef Width="55px"/>
                        <ColumnDef Width="70px"/>
                        <ColumnDef Width="25%"/>
                        <ColumnDef Width="55px"/>
                        <ColumnDef Width="25%"/>
                        <ColumnDef Width="30px"/>
                        <ColumnDef Width="80px"/>
                    </ColumnDefCollection>
                </GridLayoutPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
</Form>
