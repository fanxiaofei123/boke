<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="CHCS_ImportContract" Caption="引入供应商合同" FormType="View">
    <DataSource RefObjectKey="CHCS_ImportContract"/>
    <OperationCollection>
        <Operation Key="put" Caption="下推" Enable="GetRowCount(&quot;Grid3&quot;)==1">
            <Action>
                <![CDATA[if(GetValue("OID_H")==0){
    Confirm("不存在对应的合同！");
    return false;
}
ViewMap("ImportContract2Supplement",false);
Close();]]>
            </Action>
        </Operation>
    </OperationCollection>
    <QueryCollection>
        <Query Key="FillGrid1">
            <Statement DBType="MySql">
                <![CDATA[select `OID`,`SOID`,`POID`,`VERID`,`DVERID`,`Standard_Clause`,`Deviation_Description`,`Lnfluence_Link` from CHCS_Item_Management where soid = ?]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Long"/>
            </ParameterCollection>
        </Query>
        <Query Key="FillGrid2">
            <Statement DBType="MySql">
                <![CDATA[select * from CHCS_Contract_Price where soid = ?]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Long"/>
            </ParameterCollection>
        </Query>
    </QueryCollection>
    <Body PopHeight="500px" PopWidth="1000px">
        <Block>
            <FlexFlowLayoutPanel Key="main" Caption="根面板">
                <ToolBar Key="main_toolbar" Height="pref" Caption="main_toolbar">
                    <ToolBarItemCollection/>
                </ToolBar>
                <SplitPanel Key="SplitPanel1" Orientation="Vertical" Height="100%" Caption="SplitPanel1">
                    <GridLayoutPanel Key="query" Height="100%" Padding="5px" Caption="查询字段">
                        <Label Key="L_Business_Unit" Caption="业务单元" X="0" Y="0"/>
                        <TextEditor Key="Business_Unit" Caption="业务单元" BuddyKey="L_Business_Unit" X="1" Y="0">
                            <Condition ColumnKey="Business_Unit" TableKey="CHCS_Verdor_Contract" CondSign="like"/>
                        </TextEditor>
                        <Label Key="L_Contract_Name" Caption="合同名称" X="3" Y="0"/>
                        <TextEditor Key="Contract_Name" Caption="合同名称" BuddyKey="L_Contract_Name" X="4" Y="0">
                            <Condition ColumnKey="Contract_Name" TableKey="CHCS_Verdor_Contract" CondSign="like"/>
                        </TextEditor>
                        <Label Key="L_Principal_Contract_Code" Caption="主合同编号" X="6" Y="0"/>
                        <TextEditor Key="Principal_Contract_Code" Caption="主合同编号" BuddyKey="L_Principal_Contract_Code" X="7" Y="0">
                            <Condition ColumnKey="Principal_Contract_Code" TableKey="CHCS_Verdor_Contract" CondSign="like"/>
                        </TextEditor>
                        <Label Key="L_Contract_Code" Caption="合同编号" X="0" Y="1"/>
                        <TextEditor Key="Contract_Code" Caption="合同编号" BuddyKey="L_Contract_Code" X="1" Y="1">
                            <Condition ColumnKey="Contract_Code" TableKey="CHCS_Verdor_Contract" CondSign="like"/>
                        </TextEditor>
                        <Label Key="L_Contract_Unit" Caption="签约单位" X="3" Y="1"/>
                        <TextEditor Key="Contract_Unit" Caption="签约单位" BuddyKey="L_Contract_Unit" X="4" Y="1">
                            <Condition ColumnKey="Contract_Unit" TableKey="CHCS_Verdor_Contract" CondSign="like"/>
                        </TextEditor>
                        <Label Key="L_Contract_Classify" Caption="合同分类" X="6" Y="1"/>
                        <TextEditor Key="Contract_Classify" Caption="合同分类" BuddyKey="L_Contract_Classify" X="7" Y="1">
                            <Condition ColumnKey="Contract_Classify" TableKey="CHCS_Verdor_Contract" CondSign="like"/>
                        </TextEditor>
                        <Label Key="L_Supplier_NO" Caption="供应商编号" X="0" Y="2"/>
                        <TextEditor Key="Supplier_NO" Caption="供应商编号" BuddyKey="L_Supplier_NO" X="1" Y="2">
                            <Condition ColumnKey="Supplier_NO" TableKey="CHCS_Verdor_Contract" CondSign="like"/>
                        </TextEditor>
                        <Button Key="Query" Caption="查询" X="7" Y="2" Enable="true">
                            <OnClick>
                                <![CDATA[DealCondition();LoadData();ShowData();]]>
                            </OnClick>
                        </Button>
                        <Button Key="cancel" Caption="重置" X="7" Y="3" Enable="true">
                            <OnClick>
                                <![CDATA[
								ResetCondition();	
								]]>
                            </OnClick>
                        </Button>
                        <NumberEditor Key="OID_H" Caption="OID" BuddyKey="Lab_OID_H" X="4" Y="2" Visible="false" Format="">
                            <DataBinding DefaultFormulaValue="GetCellValue(&quot;Grid3&quot;, 0, &quot;OID&quot;);" DefaultValue="0"/>
                        </NumberEditor>
                        <Label Key="Lab_OID_H" Caption="OID" X="3" Y="2"/>
                        <RowDefCollection RowHeight="30" RowGap="6">
                            <RowDef/>
                            <RowDef/>
                            <RowDef/>
                            <RowDef/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="20">
                            <ColumnDef Width="80px"/>
                            <ColumnDef Width="33%"/>
                            <ColumnDef Width="30px"/>
                            <ColumnDef Width="80px"/>
                            <ColumnDef Width="33%"/>
                            <ColumnDef Width="30px"/>
                            <ColumnDef Width="80px"/>
                            <ColumnDef Width="33%"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <TabPanel Caption="TabPanel1" Height="pref" Key="TabPanel1">
                        <Grid Key="Grid1" Caption="条款管理" NewEmptyRow="false" PageLoadType="DB" CanDelete="false" CanInsert="false" CanShift="false">
                            <GridColumnCollection>
                                <GridColumn Key="Standard_Clause" Caption="标准条款" Width="80px"/>
                                <GridColumn Key="Deviation_Description" Caption="偏离描述" Width="80px"/>
                                <GridColumn Key="Lnfluence_Link" Caption="影响环节" Width="80px"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="row1" RowHeight="36" TableKey="CHCS_Item_Management">
                                    <GridCell Key="Standard_Clause" Caption="标准条款" CellType="TextEditor">
                                        <DataBinding ColumnKey="Standard_Clause"/>
                                    </GridCell>
                                    <GridCell Key="Deviation_Description" Caption="偏离描述" CellType="TextEditor">
                                        <DataBinding ColumnKey="Deviation_Description"/>
                                    </GridCell>
                                    <GridCell Key="Lnfluence_Link" Caption="影响环节" CellType="TextEditor">
                                        <DataBinding ColumnKey="Lnfluence_Link"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                            <GridFilter>
                                <FilterValue FieldKey="SOID" Type="Field"/>
                            </GridFilter>
                        </Grid>
                        <Grid Key="Grid2" Caption="合同管理" NewEmptyRow="false" PageLoadType="DB" CanDelete="false" CanInsert="false" CanShift="false">
                            <GridColumnCollection>
                                <GridColumn Key="SrcOID" Caption="合同OID" Width="80px" Visible="false"/>
                                <GridColumn Key="Product" Caption="餐种" Width="80px"/>
                                <GridColumn Key="Unit_Price" Caption="单价" Width="80px"/>
                                <GridColumn Key="Valid_Time_Start" Caption="有效期起" Width="90px"/>
                                <GridColumn Key="Valid_Time_End" Caption="有效期止" Width="90px"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="row1" RowHeight="36" TableKey="CHCS_Contract_Price">
                                    <GridCell Key="SrcOID" Caption="合同OID" CellType="NumberEditor" Format="">
                                        <DataBinding ColumnKey="OID"/>
                                    </GridCell>
                                    <GridCell Key="Product" Caption="餐种" CellType="Dict" ItemKey="CHCS_Product">
                                        <DataBinding ColumnKey="Product"/>
                                    </GridCell>
                                    <GridCell Key="Unit_Price" Caption="单价" CellType="NumberEditor" Format="">
                                        <DataBinding ColumnKey="Unit_Price"/>
                                    </GridCell>
                                    <GridCell Key="Valid_Time_Start" Caption="有效期起" CellType="DatePicker" OnlyDate="true">
                                        <DataBinding ColumnKey="Valid_Time_Start"/>
                                    </GridCell>
                                    <GridCell Key="Valid_Time_End" Caption="有效期止" CellType="DatePicker" OnlyDate="true">
                                        <DataBinding ColumnKey="Valid_Time_End"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                        </Grid>
                        <Grid Key="Grid3" Caption="供应商合同" NewEmptyRow="false" Visible="false" PageLoadType="DB" CanDelete="false" CanInsert="false" CanShift="false" Option="">
                            <GridColumnCollection>
                                <GridColumn Key="select3" Caption="选择" Width="80px"/>
                                <GridColumn Key="OID" Caption="对象标识" Width="80px"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="row1" RowHeight="36" TableKey="CHCS_Verdor_Contract">
                                    <GridCell Key="select3" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                    <GridCell Key="OID" Caption="对象标识" CellType="NumberEditor" Format="">
                                        <DataBinding ColumnKey="OID"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                        </Grid>
                    </TabPanel>
                    <SplitSize Size="40%"/>
                    <SplitSize Size="60%"/>
                </SplitPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
    <OnPostShow>
        <![CDATA[if(GetRowCount("Grid3")>1){
    Confirm("你选择的条件存在多个合同，请重新输入！");
    ClearAllRows("Grid1");
    ClearAllRows("Grid2");
    ClearAllRows("Grid3");
    SetValue("OID_H");
    return false;
}
var gridData1 = DBNamedQuery("FillGrid1", GetCellValue("Grid3",0,"OID"));
var gridData2 = DBNamedQuery("FillGrid2", GetCellValue("Grid3",0,"OID"));
FillGridData("Grid1", gridData1, "true");
FillGridData("Grid2", gridData2, "true");]]>
    </OnPostShow>
</Form>
