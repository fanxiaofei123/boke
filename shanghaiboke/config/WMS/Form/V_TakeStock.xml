<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Caption="盘点单" FormType="Entity" Key="V_TakeStock">
    <DataSource RefObjectKey="LRP_TakeStock"/>
    <OperationCollection>
        <Operation Key="New" Caption="新增" Visible="ReadOnly()">
            <Action>
                <![CDATA[New('V_TakeStock')]]>
            </Action>
        </Operation>
        <Operation Caption="复制新增" Key="CopyNew" RefKey="CopyNew" ShortCuts="Ctrl+E"/>
        <Operation Caption="编辑" Key="Edit" RefKey="Edit"/>
        <Operation Key="QuoteQuant" Caption="引入库存" Enable="!ReadOnly()&amp;&amp;Status==100&amp;&amp;ToLong(OwnerId)&gt;0">
            <Action>
                <![CDATA[        
				if(OwnerId==0){
					 Confirm(LocaleString("OwnerNull", "key146"), 'OK',{OK:{}});
					 return true;
                }
				ShowModal('V_QuoteQuantView',
						{WarehouseCenterId_para:{WarehouseCenterId},
						OwnerId_para:{OwnerId},
						pFormKey:{GetFormKey()},
						});
				]]>
            </Action>
        </Operation>
        <Operation Key="BuildCountDetail" Caption="生成盘点单明细" Enable="!ReadOnly()&amp;&amp;Status==100&amp;&amp;ToLong(OwnerId)&gt;0">
            <Action>
                <![CDATA[
				SetNewEmptyRow('Grid0',true);Edit();
				if(GetRowCount('Grid0',false)>0){
						Confirm(LocaleString("OwnerNull", "key123"),'YES_NO',{
					                    YES:{
							    //清空明细行
						                    ClearAllRows('Grid0');
								    //生成新的明细
								    BuildCountDetail();
					                    },
							    NO:{}
						});
				}
				else{
					//生成新的明细
					BuildCountDetail();
				}
				SetNewEmptyRow('Grid0',false);
				]]>
            </Action>
        </Operation>
        <Operation Caption="删除明细行" Key="DeleteRow" Visible="!ReadOnly()">
            <Action>
                <![CDATA[
				var flag=0;
				var i=0;
				var count = GetRowCount('Grid0',false);
				while ( i < count ) {
				   //当生成方式是盘点录入的时候可以删除
				   if(ToInt(GetCellValue("Grid0", i,"Select_L0")==1)){
					   if(GetCellValue("Grid0", i,"GenMethod_L0")==0 && Status==200){
							Confirm(LocaleString("OwnerNull", "key124"),'OK','OK:{}');
						}else{
							DeleteRow("Grid0",i);
							i=i-1;
							count=count-1;
						}
						flag=1;
					}
					i=i+1;
				}
				if(flag==0){
					Confirm(LocaleString("OwnerNull", "key125"),'OK','OK:{}');
				}
			]]>
            </Action>
        </Operation>
        <Operation Caption="保存" Key="Save" Visible="!ReadOnly()">
            <Action>
                <![CDATA[
				if(GetRowCount('Grid0', false)==0){
					Confirm(LocaleString("OwnerNull", "key103"), 'OK','OK:{}');
					return true;
				}
				SaveData(); UpdateView();
			 
				]]>
            </Action>
        </Operation>
        <Operation Caption="取消" Key="Cancel" RefKey="Cancel"/>
        <Operation Caption="确认" Key="Confirm" RefKey="Confirm"/>
        <Operation Caption="撤销确认" Key="Confirm-R" RefKey="Confirm-R"/>
        <Operation Caption="盘点录入" Key="TakeIn" Enable="ReadOnly() &amp;&amp; Status==200">
            <Action>
                <![CDATA[
				Edit();SetNewEmptyRow('Grid0',true);
			]]>
            </Action>
        </Operation>
        <Operation Key="Finish" Caption="完成" Visible="ReadOnly() &amp;&amp; Status==200">
            <Action>
                <![CDATA[
				Status=900;SaveData();UpdateView();
				]]>
            </Action>
        </Operation>
        <Operation Key="Finish-R" Caption="撤销完成" Visible="ReadOnly() &amp;&amp; Status==900">
            <Action>
                <![CDATA[
				Status=200;SaveData();UpdateView();
			 
				]]>
            </Action>
        </Operation>
        <Operation Key="ExcelTakeStock_L" Caption="导出盘点明细">
            <Action>
                <![CDATA[ExportExcelWithTemplate("V_TakeStockExcel", true)]]>
            </Action>
        </Operation>
        <Operation Key="ExcelTakeStock_L2" Caption="导出盘点差异明细">
            <Action>
                <![CDATA[SetPara('S_OID',GetOID());Load();ExportExcelWithTemplate("V_TakeStockExcel2", true)]]>
            </Action>
        </Operation>
        <Operation Caption="删除" Key="Delete" RefKey="Delete"/>
        <Operation Caption="关闭界面" Key="Close" RefKey="Close"/>
    </OperationCollection>
    <ScriptCollection>
        <Script Caption="载入" Key="Load" Range="Action" Verb="Load">
            <![CDATA[LoadData();]]>
        </Script>
    </ScriptCollection>
    <Body>
        <Block>
            <FlexFlowLayoutPanel Caption="根面板" Key="root">
                <ToolBar Caption="ToolBar1" Height="pref" Key="ToolBar1">
                    <ToolBarItemCollection/>
                </ToolBar>
                <SplitPanel Caption="主面板" Height="100%" Key="main" Orientation="Vertical">
                    <TabPanel Caption="TabPanel2" Key="TabPanel2">
                        <GridLayoutPanel Caption="基本信息" Height="pref" Key="first_head" Padding="10px">
                            <TextEditor Key="No" Caption="盘点单号" BuddyKey="Lab_No" X="1" Y="0" Enable="false">
                                <DataBinding ColumnKey="No" TableKey="LRP_TakeStock_H"/>
                            </TextEditor>
                            <Label Key="Lab_No" Caption="盘点单号" X="0" Y="0"/>
                            <Dict Key="OwnerId" Caption="货主" BuddyKey="Lab_OwnerId" X="4" Y="0" Enable="!ReadOnly()&amp;&amp; Status==100" ItemKey="LRP_Owner">
                                <DataBinding ColumnKey="OwnerId" TableKey="LRP_TakeStock_H" Required="true">
                                    <ValueChanging>
                                        <![CDATA[
											Confirm(LocaleString("OwnerNull", "key147"),'YES_NO',
												{YES:{
													CommitValue('OwnerId');
													ClearAllRows('Grid0');
													ClearAllRows('Grid1');
													},
												NO:{RollbackValue('OwnerId');}});
									  ]]>
                                    </ValueChanging>
                                    <ValueValidation>
                                        <![CDATA[GetRowCount('Grid0',false)<1]]>
                                    </ValueValidation>
                                </DataBinding>
                            </Dict>
                            <Label Key="Lab_OwnerId" Caption="货主" X="3" Y="0"/>
                            <Dict Key="StoreroomId" Caption="仓间" BuddyKey="Lab_StoreroomId" X="1" Y="1" Enable="!ReadOnly()&amp;&amp; Status==100 &amp;&amp; WarehouseCenterId&gt;0" ItemKey="LRP_Storeroom">
                                <DataBinding ColumnKey="StoreroomId" TableKey="LRP_TakeStock_H"/>
                                <ItemFilter ItemKey="LRP_Storeroom">
                                    <Filter Type="FieldValue" FilterDependency="WarehouseCenterId">
                                        <FilterValue DataType="Long" FieldKey="WarehouseCenterId" RefValue="WarehouseCenterId" Type="Field"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <Label Key="Lab_StoreroomId" Caption="仓间" X="0" Y="1"/>
                            <Dict Key="StoreareaId" Caption="库区" BuddyKey="Lab_StoreareaId" X="4" Y="1" Enable="!ReadOnly()&amp;&amp; Status==100 &amp;&amp; StoreroomId&gt;0" ItemKey="LRP_Storearea">
                                <DataBinding ColumnKey="StoreareaId" TableKey="LRP_TakeStock_H"/>
                                <ItemFilter ItemKey="LRP_Storearea">
                                    <Filter Type="FieldValue" FilterDependency="StoreroomId">
                                        <FilterValue DataType="Long" FieldKey="StoreroomId" RefValue="StoreroomId" Type="Field"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <Label Key="Lab_StoreareaId" Caption="库区" X="3" Y="1"/>
                            <Dict Key="LocationId" Caption="储位" BuddyKey="Lab_LocationId" X="7" Y="1" Enable="!ReadOnly()&amp;&amp; Status==100 &amp;&amp; StoreareaId&gt;0" ItemKey="LRP_Location">
                                <DataBinding ColumnKey="LocationId" TableKey="LRP_TakeStock_H"/>
                                <ItemFilter ItemKey="LRP_Location">
                                    <Filter Type="FieldValue" FilterDependency="StoreareaId">
                                        <FilterValue DataType="Long" FieldKey="StoreareaId" RefValue="StoreareaId" Type="Field"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <Label Key="Lab_LocationId" Caption="储位" X="6" Y="1"/>
                            <Dict Key="MaterialId" Caption="物料" BuddyKey="Lab_MaterialId" X="1" Y="2" Enable="!ReadOnly()&amp;&amp; Status==100 &amp;&amp; OwnerId&gt;0" ItemKey="LRP_Material">
                                <DataBinding ColumnKey="MaterialId" TableKey="LRP_TakeStock_H"/>
                                <ItemFilter ItemKey="LRP_Material">
                                    <Filter Type="DataSet" FilterDependency="OwnerId" Query="select m.OID from LRP_Material m join LRP_OwnerMaterial om on m.OID=om.SOID where om.OwnerId=?">
                                        <FilterValue DataType="Long" Type="Field" ParaValue="OwnerId"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <Label Key="Lab_MaterialId" Caption="物料" X="0" Y="2"/>
                            <DatePicker Key="StartDate" Caption="异动日期" BuddyKey="Lab_StartDate" X="4" Y="2" Enable="!ReadOnly()&amp;&amp; Status==100" OnlyDate="true">
                                <DataBinding ColumnKey="StartDate" TableKey="LRP_TakeStock_H"/>
                            </DatePicker>
                            <Label Key="Lab_StartDate" Caption="异动日期" X="3" Y="2"/>
                            <DatePicker Key="EndDate" Caption="至" BuddyKey="Lab_EndDate" X="7" Y="2" Enable="!ReadOnly()&amp;&amp; Status==100" OnlyDate="true">
                                <DataBinding ColumnKey="EndDate" TableKey="LRP_TakeStock_H"/>
                            </DatePicker>
                            <Label Key="Lab_EndDate" Caption="至" X="6" Y="2"/>
                            <TextEditor Key="CheckPerson" Caption="盘点员" BuddyKey="Lab_CheckPerson" X="1" Y="3" Enable="!ReadOnly()&amp;&amp; (Status==100||Status==200)">
                                <DataBinding ColumnKey="CheckPerson" TableKey="LRP_TakeStock_H"/>
                            </TextEditor>
                            <Label Key="Lab_CheckPerson" Caption="盘点员" X="0" Y="3"/>
                            <DatePicker Key="CheckDatetime" Caption="盘点日期时间" BuddyKey="Lab_CheckDatetime" X="4" Y="3" Enable="!ReadOnly()&amp;&amp; (Status==100||Status==200)">
                                <DataBinding ColumnKey="CheckDatetime" TableKey="LRP_TakeStock_H" Required="true"/>
                            </DatePicker>
                            <Label Key="Lab_CheckDatetime" Caption="盘点日期时间" X="3" Y="3"/>
                            <ComboBox Key="Status" Caption="状态" BuddyKey="Lab_Status" X="7" Y="3" Enable="false" SourceType="Status">
                                <DataBinding ColumnKey="Status" TableKey="LRP_TakeStock_H" DefaultValue="100"/>
                            </ComboBox>
                            <Label Key="Lab_Status" Caption="状态" X="6" Y="3"/>
                            <TextEditor Key="Remark" Caption="备注" BuddyKey="Lab_Remark" X="1" Y="4" Enable="!ReadOnly()&amp;&amp; Status==100" MaxLength="1000">
                                <DataBinding ColumnKey="Remark" TableKey="LRP_TakeStock_H"/>
                            </TextEditor>
                            <Label Key="Lab_Remark" Caption="备注" X="0" Y="4"/>
                            <Dict Key="WarehouseCenterId" Caption="仓储中心ID" BuddyKey="Lab_WarehouseCenterId" X="7" Y="0" Visible="false" ItemKey="LRP_WarehouseCenter">
                                <DataBinding ColumnKey="WarehouseCenterId" DefaultFormulaValue="getCurOrgID()" TableKey="LRP_TakeStock_H"/>
                            </Dict>
                            <Label Key="Lab_WarehouseCenterId" Caption="仓储中心ID" Visible="false" X="6" Y="0"/>
                            <RowDefCollection RowGap="8">
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="8">
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="33%" MinWidth="40px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="99px"/>
                                <ColumnDef Width="33%" MinWidth="40px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="33%" MinWidth="40px"/>
                                <ColumnDef Width="55px"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                        <GridLayoutPanel Key="SystemInfo" Padding="10px" Caption="系统信息">
                            <Dict BuddyKey="Lab_CREATOR" Caption="创建人" ItemKey="Operator" Key="CREATOR" X="1" Y="0" Enable="false">
                                <DataBinding ColumnKey="CREATOR" DefaultFormulaValue="GetOperator()" TableKey="LRP_TakeStock_H"/>
                            </Dict>
                            <Label Key="Lab_CREATOR" Caption="创建人" X="0" Y="0"/>
                            <DatePicker BuddyKey="Lab_CREATETIME" Caption="创建时间" Key="CREATETIME" X="4" Y="0" Enable="false">
                                <DataBinding ColumnKey="CREATETIME" DefaultFormulaValue="ServerDate()" TableKey="LRP_TakeStock_H"/>
                            </DatePicker>
                            <Label Key="Lab_CREATETIME" Caption="创建时间" X="3" Y="0"/>
                            <Dict BuddyKey="Lab_MODIFIER" Caption="修改人" ItemKey="Operator" Key="MODIFIER" X="1" Y="1" Enable="false">
                                <DataBinding ColumnKey="MODIFIER" DefaultFormulaValue="GetOperator()" TableKey="LRP_TakeStock_H"/>
                            </Dict>
                            <Label Key="Lab_MODIFIER" Caption="修改人" X="0" Y="1"/>
                            <DatePicker BuddyKey="Lab_MODIFYTIME" Caption="修改时间" Key="MODIFYTIME" X="4" Y="1" Enable="false">
                                <DataBinding ColumnKey="MODIFYTIME" DefaultFormulaValue="ServerDate()" TableKey="LRP_TakeStock_H"/>
                            </DatePicker>
                            <Label Key="Lab_MODIFYTIME" Caption="修改时间" X="3" Y="1"/>
                            <RowDefCollection RowGap="8">
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="8">
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="33%" MinWidth="40px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="33%" MinWidth="40px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="33%" MinWidth="40px"/>
                                <ColumnDef Width="55px"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                    </TabPanel>
                    <TabPanel Caption="TabPanel1" Key="TabPanel1">
                        <Grid Caption="盘点明细" Height="100%" Key="Grid0" NewEmptyRow="false" CanShift="false" CanInsert="false" CanDelete="false">
                            <GridColumnCollection>
                                <GridColumn Key="Select_L0" Caption="选择" ColumnType="Detail" Visible="true" Width="93px" Sortable="true"/>
                                <GridColumn Key="MaterialId_L0" Caption="物料" Width="80px" Sortable="true"/>
                                <GridColumn Key="BatchNo_L0" Caption="批号" Visible="ToBool(GetSessionPara('BatchNo_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="ManufDate_L0" Caption="生产日期" Visible="ToBool(GetSessionPara('ManufDate_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="ExpireDate_L0" Caption="失效日期" Visible="ToBool(GetSessionPara('ExpireDate_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="ProjectId_L0" Caption="项目" Visible="ToBool(GetSessionPara('ProjectId_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="StrUserDef1_L0" Caption="字符型1" Visible="ToBool(GetSessionPara('StrUserDef1_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="StrUserDef2_L0" Caption="字符型2" Visible="ToBool(GetSessionPara('StrUserDef2_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="StrUserDef3_L0" Caption="字符型3" Visible="ToBool(GetSessionPara('StrUserDef3_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="StrUserDef4_L0" Caption="字符型4" Visible="ToBool(GetSessionPara('StrUserDef4_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="StrUserDef5_L0" Caption="字符型5" Visible="ToBool(GetSessionPara('StrUserDef5_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DictUserDef1_L0" Caption="字典型1" Visible="ToBool(GetSessionPara('DictUserDef1_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DictUserDef2_L0" Caption="字典型2" Visible="ToBool(GetSessionPara('DictUserDef2_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DictUserDef3_L0" Caption="字典型3" Visible="ToBool(GetSessionPara('DictUserDef3_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DictUserDef4_L0" Caption="字典型4" Visible="ToBool(GetSessionPara('DictUserDef4_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DictUserDef5_L0" Caption="字典型5" Visible="ToBool(GetSessionPara('DictUserDef5_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DateUserDef1_L0" Caption="日期型1" Visible="ToBool(GetSessionPara('DateUserDef1_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DateUserDef2_L0" Caption="日期型2" Visible="ToBool(GetSessionPara('DateUserDef2_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="NumUserDef1_L0" Caption="数值型1" Visible="ToBool(GetSessionPara('NumUserDef1_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="NumUserDef2_L0" Caption="数值型2" Visible="ToBool(GetSessionPara('NumUserDef2_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="NumUserDef3_L0" Caption="数值型3" Visible="ToBool(GetSessionPara('NumUserDef3_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="MaterialStatusId_L0" Caption="物料状态" Width="80px" Sortable="true"/>
                                <GridColumn Key="Qty_L0" Caption="账面量" Width="80px" Sortable="true"/>
                                <GridColumn Key="CheckQty_L0" Caption="实盘量" Width="80px" Sortable="true"/>
                                <GridColumn Key="BasicUnit_L0" Caption="单位" Width="80px" Sortable="true"/>
                                <GridColumn Key="StoreroomId_L0" Caption="仓间" Width="80px" Sortable="true"/>
                                <GridColumn Key="StoreareaId_L0" Caption="库区" Width="80px" Sortable="true"/>
                                <GridColumn Key="LocationId_L0" Caption="储位" Width="80px" Sortable="true"/>
                                <GridColumn Key="GenMethod_L0" Caption="生成方式" Width="80px" Sortable="true"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="R_0" RowHeight="30" TableKey="LRP_TakeStock_L">
                                    <GridCell Key="Select_L0" Caption="选择" CellType="CheckBox" Enable="true" IsSelect="true"/>
                                    <GridCell Key="MaterialId_L0" Caption="物料" CellType="Dict" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" ItemKey="LRP_Material">
                                        <DataBinding ColumnKey="MaterialId" CheckRule="IIF(GenMethod_L0==1,MaterialId_L0&gt;0,true)" ErrorInfo="盘点录入保存时物料不可为空。"/>
                                        <ItemFilter ItemKey="LRP_Material">
                                            <Filter Type="DataSet" FilterDependency="OwnerId" Query="select m.OID from LRP_Material m join LRP_OwnerMaterial om on m.OID=om.SOID where om.OwnerId=?">
                                                <FilterValue Type="Field" ParaValue="OwnerId"/>
                                            </Filter>
                                        </ItemFilter>
                                    </GridCell>
                                    <GridCell Key="BatchNo_L0" Caption="批号" CellType="TextEditor" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1">
                                        <DataBinding ColumnKey="BatchNo" DefaultValue="*"/>
                                    </GridCell>
                                    <GridCell Key="ManufDate_L0" Caption="生产日期" CellType="DatePicker" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" OnlyDate="true" Format="yyyy-MM-dd">
                                        <DataBinding ColumnKey="ManufDate" DefaultValue="1980-01-01"/>
                                    </GridCell>
                                    <GridCell Key="ExpireDate_L0" Caption="失效日期" CellType="DatePicker" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" OnlyDate="true" Format="yyyy-MM-dd">
                                        <DataBinding ColumnKey="ExpireDate" DefaultValue="1980-01-01"/>
                                    </GridCell>
                                    <GridCell Key="ProjectId_L0" Caption="项目" CellType="Dict" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" ItemKey="LRP_Project">
                                        <DataBinding ColumnKey="ProjectId"/>
                                    </GridCell>
                                    <GridCell Key="StrUserDef1_L0" Caption="字符型1" CellType="TextEditor" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1">
                                        <DataBinding ColumnKey="StrUserDef1" DefaultValue="*"/>
                                    </GridCell>
                                    <GridCell Key="StrUserDef2_L0" Caption="字符型2" CellType="TextEditor" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1">
                                        <DataBinding ColumnKey="StrUserDef2" DefaultValue="*"/>
                                    </GridCell>
                                    <GridCell Key="StrUserDef3_L0" Caption="字符型3" CellType="TextEditor" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1">
                                        <DataBinding ColumnKey="StrUserDef3" DefaultValue="*"/>
                                    </GridCell>
                                    <GridCell Key="StrUserDef4_L0" Caption="字符型4" CellType="TextEditor" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1">
                                        <DataBinding ColumnKey="StrUserDef4" DefaultValue="*"/>
                                    </GridCell>
                                    <GridCell Key="StrUserDef5_L0" Caption="字符型5" CellType="TextEditor" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1">
                                        <DataBinding ColumnKey="StrUserDef5" DefaultValue="*"/>
                                    </GridCell>
                                    <GridCell Key="DictUserDef1_L0" Caption="字典型1" CellType="Dict" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" ItemKeySource="DictUserItemKey.DictUser1ItemKey" ItemKeySourceType="Para">
                                        <DataBinding ColumnKey="DictUserDef1"/>
                                    </GridCell>
                                    <GridCell Key="DictUserDef2_L0" Caption="字典型2" CellType="Dict" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" ItemKeySource="DictUserItemKey.DictUser2ItemKey" ItemKeySourceType="Para">
                                        <DataBinding ColumnKey="DictUserDef2"/>
                                    </GridCell>
                                    <GridCell Key="DictUserDef3_L0" Caption="字典型3" CellType="Dict" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" ItemKeySource="DictUserItemKey.DictUser3ItemKey" ItemKeySourceType="Para">
                                        <DataBinding ColumnKey="DictUserDef3"/>
                                    </GridCell>
                                    <GridCell Key="DictUserDef4_L0" Caption="字典型4" CellType="Dict" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" ItemKeySource="DictUserItemKey.DictUser4ItemKey" ItemKeySourceType="Para">
                                        <DataBinding ColumnKey="DictUserDef4"/>
                                    </GridCell>
                                    <GridCell Key="DictUserDef5_L0" Caption="字典型5" CellType="Dict" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" ItemKeySource="DictUserItemKey.DictUser5ItemKey" ItemKeySourceType="Para">
                                        <DataBinding ColumnKey="DictUserDef5"/>
                                    </GridCell>
                                    <GridCell Key="DateUserDef1_L0" Caption="日期型1" CellType="DatePicker" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" OnlyDate="true" Format="yyyy-MM-dd">
                                        <DataBinding ColumnKey="DateUserDef1"/>
                                    </GridCell>
                                    <GridCell Key="DateUserDef2_L0" Caption="日期型2" CellType="DatePicker" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" OnlyDate="true" Format="yyyy-MM-dd">
                                        <DataBinding ColumnKey="DateUserDef2"/>
                                    </GridCell>
                                    <GridCell Key="NumUserDef1_L0" Caption="数值型1" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" Precision="15" Scale="3" ShowZero="true">
                                        <DataBinding ColumnKey="NumUserDef1"/>
                                    </GridCell>
                                    <GridCell Key="NumUserDef2_L0" Caption="数值型2" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" Precision="15" Scale="3" ShowZero="true">
                                        <DataBinding ColumnKey="NumUserDef2"/>
                                    </GridCell>
                                    <GridCell Key="NumUserDef3_L0" Caption="数值型3" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" Precision="15" Scale="3" ShowZero="true">
                                        <DataBinding ColumnKey="NumUserDef3"/>
                                    </GridCell>
                                    <GridCell Key="MaterialStatusId_L0" Caption="物料状态" CellType="Dict" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1" ItemKey="LRP_MaterialStatus">
                                        <DataBinding ColumnKey="MaterialStatusId" CheckRule="IIF(GenMethod_L0==1,MaterialStatusId_L0&gt;0,true)" ErrorInfo="盘点录入保存时物料状态不可为空。"/>
                                    </GridCell>
                                    <GridCell Key="Qty_L0" Caption="账面量" CellType="NumberEditor" Enable="false" ShowZero="true" Precision="15" Scale="3">
                                        <DataBinding ColumnKey="Qty" DefaultValue="0"/>
                                    </GridCell>
                                    <GridCell Key="CheckQty_L0" Caption="实盘量" CellType="NumberEditor" Enable="!ReadOnly()" ShowZero="true" Precision="15" Scale="3">
                                        <DataBinding ColumnKey="CheckQty"/>
                                    </GridCell>
                                    <GridCell Key="BasicUnit_L0" Caption="单位" CellType="TextEditor" Enable="false">
                                        <DataBinding DefaultFormulaValue="GetDictValue('LRP_Material', MaterialId_L0, 'BasicUnit')"/>
                                    </GridCell>
                                    <GridCell Key="StoreroomId_L0" Caption="仓间" CellType="Dict" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1 &amp;&amp; WarehouseCenterId&gt;0" ItemKey="LRP_Storeroom">
                                        <DataBinding ColumnKey="StoreroomId" CheckRule="IIF(GenMethod_L0==1,StoreroomId_L0&gt;0,true)" ErrorInfo="盘点录入保存时仓间不可为空。"/>
                                        <ItemFilter ItemKey="LRP_Storeroom">
                                            <Filter Type="FieldValue" FilterDependency="WarehouseCenterId">
                                                <FilterValue DataType="Long" FieldKey="WarehouseCenterId" RefValue="WarehouseCenterId" Type="Field"/>
                                            </Filter>
                                        </ItemFilter>
                                    </GridCell>
                                    <GridCell Key="StoreareaId_L0" Caption="库区" CellType="Dict" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1 &amp;&amp; StoreroomId_L0&gt;0" ItemKey="LRP_Storearea">
                                        <DataBinding ColumnKey="StoreareaId" CheckRule="IIF(GenMethod_L0==1,StoreareaId_L0&gt;0,true)" ErrorInfo="盘点录入保存时库区不可为空。"/>
                                        <ItemFilter ItemKey="LRP_Storearea">
                                            <Filter Type="FieldValue" FilterDependency="StoreroomId_L0">
                                                <FilterValue DataType="Long" FieldKey="StoreroomId" RefValue="StoreroomId_L0" Type="Field"/>
                                            </Filter>
                                        </ItemFilter>
                                    </GridCell>
                                    <GridCell Key="LocationId_L0" Caption="储位" CellType="Dict" Enable="!ReadOnly()&amp;&amp; Status==200 &amp;&amp; GenMethod_L0==1 &amp;&amp; StoreareaId_L0&gt;0" ItemKey="LRP_Location">
                                        <DataBinding ColumnKey="LocationId" CheckRule="IIF(GenMethod_L0==1,LocationId_L0&gt;0,true)" ErrorInfo="盘点录入保存时储位不可为空。"/>
                                        <ItemFilter ItemKey="LRP_Location">
                                            <Filter Type="FieldValue" FilterDependency="StoreareaId_L0">
                                                <FilterValue DataType="Long" FieldKey="StoreareaId" RefValue="StoreareaId_L0" Type="Field"/>
                                            </Filter>
                                        </ItemFilter>
                                    </GridCell>
                                    <GridCell Key="GenMethod_L0" Caption="生成方式" CellType="ComboBox" Enable="false">
                                        <DataBinding ColumnKey="GenMethod" DefaultValue="1"/>
                                        <Item Caption="系统生成" Key="0" Value="0"/>
                                        <Item Caption="盘点录入" Key="1" Value="1"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                        </Grid>
                        <Grid Key="Grid1" Caption="盘点差异明细" Enable="false" Visible="Status==900" NewEmptyRow="false" CanDelete="false" CanInsert="false" CanShift="false">
                            <Activate>
                                <![CDATA[SetPara('S_OID',GetOID());Load();]]>
                            </Activate>
                            <GridColumnCollection>
                                <GridColumn Key="Select_L1" Caption="选择" ColumnType="Detail" Visible="true" Width="93px" Sortable="true"/>
                                <GridColumn Key="MaterialId_L1" Caption="物料" Width="80px" Sortable="true"/>
                                <GridColumn Key="BatchNo_L1" Caption="批号" Visible="ToBool(GetSessionPara('BatchNo_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="ManufDate_L1" Caption="生产日期" Visible="ToBool(GetSessionPara('ManufDate_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="ExpireDate_L1" Caption="失效日期" Visible="ToBool(GetSessionPara('ExpireDate_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="ProjectId_L1" Caption="项目" Visible="ToBool(GetSessionPara('ProjectId_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="StrUserDef1_L1" Caption="字符型1" Visible="ToBool(GetSessionPara('StrUserDef1_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="StrUserDef2_L1" Caption="字符型2" Visible="ToBool(GetSessionPara('StrUserDef2_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="StrUserDef3_L1" Caption="字符型3" Visible="ToBool(GetSessionPara('StrUserDef3_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="StrUserDef4_L1" Caption="字符型4" Visible="ToBool(GetSessionPara('StrUserDef4_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="StrUserDef5_L1" Caption="字符型5" Visible="ToBool(GetSessionPara('StrUserDef5_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DictUserDef1_L1" Caption="字典型1" Visible="ToBool(GetSessionPara('DictUserDef1_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DictUserDef2_L1" Caption="字典型2" Visible="ToBool(GetSessionPara('DictUserDef2_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DictUserDef3_L1" Caption="字典型3" Visible="ToBool(GetSessionPara('DictUserDef3_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DictUserDef4_L1" Caption="字典型4" Visible="ToBool(GetSessionPara('DictUserDef4_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DictUserDef5_L1" Caption="字典型5" Visible="ToBool(GetSessionPara('DictUserDef5_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DateUserDef1_L1" Caption="日期型1" Visible="ToBool(GetSessionPara('DateUserDef1_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="DateUserDef2_L1" Caption="日期型2" Visible="ToBool(GetSessionPara('DateUserDef2_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="NumUserDef1_L1" Caption="数值型1" Visible="ToBool(GetSessionPara('NumUserDef1_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="NumUserDef2_L1" Caption="数值型2" Visible="ToBool(GetSessionPara('NumUserDef2_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="NumUserDef3_L1" Caption="数值型3" Visible="ToBool(GetSessionPara('NumUserDef3_IsShow'))" Width="80px" Sortable="true"/>
                                <GridColumn Key="MaterialStatusId_L1" Caption="物料状态" Width="80px" Sortable="true"/>
                                <GridColumn Key="Qty_L1" Caption="账面量" Width="80px" Sortable="true"/>
                                <GridColumn Key="CheckQty_L1" Caption="盘点量" Width="80px" Sortable="true"/>
                                <GridColumn Key="BasicUnit_L1" Caption="单位" Width="80px" Sortable="true"/>
                                <GridColumn Key="StoreroomId_L1" Caption="仓间" Width="80px" Sortable="true"/>
                                <GridColumn Key="StoreareaId_L1" Caption="库区" Width="80px" Sortable="true"/>
                                <GridColumn Key="LocationId_L1" Caption="储位" Width="80px" Sortable="true"/>
                                <GridColumn Key="GenMethod_L1" Caption="生成方式" Width="80px" Sortable="true"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="R_1" RowHeight="30" TableKey="LRP_TakeStock_L2">
                                    <GridCell Key="Select_L1" Caption="选择" CellType="CheckBox" Enable="true" IsSelect="true"/>
                                    <GridCell Key="MaterialId_L1" Caption="物料" CellType="Dict" ItemKey="LRP_Material">
                                        <DataBinding ColumnKey="MaterialId"/>
                                    </GridCell>
                                    <GridCell Key="BatchNo_L1" Caption="批号" CellType="TextEditor" Enable="false">
                                        <DataBinding ColumnKey="BatchNo"/>
                                    </GridCell>
                                    <GridCell Key="ManufDate_L1" Caption="生产日期" CellType="DatePicker" Enable="false" OnlyDate="true" Format="yyyy-MM-dd">
                                        <DataBinding ColumnKey="ManufDate"/>
                                    </GridCell>
                                    <GridCell Key="ExpireDate_L1" Caption="失效日期" CellType="DatePicker" Enable="false" OnlyDate="true" Format="yyyy-MM-dd">
                                        <DataBinding ColumnKey="ExpireDate"/>
                                    </GridCell>
                                    <GridCell Key="ProjectId_L1" Caption="项目" CellType="Dict" Enable="false" ItemKey="LRP_Project">
                                        <DataBinding ColumnKey="ProjectId"/>
                                    </GridCell>
                                    <GridCell Key="StrUserDef1_L1" Caption="字符型1" CellType="TextEditor" Enable="false">
                                        <DataBinding ColumnKey="StrUserDef1"/>
                                    </GridCell>
                                    <GridCell Key="StrUserDef2_L1" Caption="字符型2" CellType="TextEditor" Enable="false">
                                        <DataBinding ColumnKey="StrUserDef2"/>
                                    </GridCell>
                                    <GridCell Key="StrUserDef3_L1" Caption="字符型3" CellType="TextEditor" Enable="false">
                                        <DataBinding ColumnKey="StrUserDef3"/>
                                    </GridCell>
                                    <GridCell Key="StrUserDef4_L1" Caption="字符型4" CellType="TextEditor" Enable="false">
                                        <DataBinding ColumnKey="StrUserDef4"/>
                                    </GridCell>
                                    <GridCell Key="StrUserDef5_L1" Caption="字符型5" CellType="TextEditor" Enable="false">
                                        <DataBinding ColumnKey="StrUserDef5"/>
                                    </GridCell>
                                    <GridCell Key="DictUserDef1_L1" Caption="字典型1" CellType="Dict" Enable="false" ItemKeySource="DictUserItemKey.DictUser1ItemKey" ItemKeySourceType="Para">
                                        <DataBinding ColumnKey="DictUserDef1"/>
                                    </GridCell>
                                    <GridCell Key="DictUserDef2_L1" Caption="字典型2" CellType="Dict" Enable="false" ItemKeySource="DictUserItemKey.DictUser2ItemKey" ItemKeySourceType="Para">
                                        <DataBinding ColumnKey="DictUserDef2"/>
                                    </GridCell>
                                    <GridCell Key="DictUserDef3_L1" Caption="字典型3" CellType="Dict" Enable="false" ItemKeySource="DictUserItemKey.DictUser3ItemKey" ItemKeySourceType="Para">
                                        <DataBinding ColumnKey="DictUserDef3"/>
                                    </GridCell>
                                    <GridCell Key="DictUserDef4_L1" Caption="字典型4" CellType="Dict" Enable="false" ItemKeySource="DictUserItemKey.DictUser4ItemKey" ItemKeySourceType="Para">
                                        <DataBinding ColumnKey="DictUserDef4"/>
                                    </GridCell>
                                    <GridCell Key="DictUserDef5_L1" Caption="字典型5" CellType="Dict" Enable="false" ItemKeySource="DictUserItemKey.DictUser5ItemKey" ItemKeySourceType="Para">
                                        <DataBinding ColumnKey="DictUserDef5"/>
                                    </GridCell>
                                    <GridCell Key="DateUserDef1_L1" Caption="日期型1" CellType="DatePicker" Enable="false" OnlyDate="true" Format="yyyy-MM-dd">
                                        <DataBinding ColumnKey="DateUserDef1"/>
                                    </GridCell>
                                    <GridCell Key="DateUserDef2_L1" Caption="日期型2" CellType="DatePicker" Enable="false" OnlyDate="true" Format="yyyy-MM-dd">
                                        <DataBinding ColumnKey="DateUserDef2"/>
                                    </GridCell>
                                    <GridCell Key="NumUserDef1_L1" Caption="数值型1" CellType="NumberEditor" Enable="false" Precision="15" Scale="3" ShowZero="true">
                                        <DataBinding ColumnKey="NumUserDef1"/>
                                    </GridCell>
                                    <GridCell Key="NumUserDef2_L1" Caption="数值型2" CellType="NumberEditor" Enable="false" Precision="15" Scale="3" ShowZero="true">
                                        <DataBinding ColumnKey="NumUserDef2"/>
                                    </GridCell>
                                    <GridCell Key="NumUserDef3_L1" Caption="数值型3" CellType="NumberEditor" Enable="false" Precision="15" Scale="3" ShowZero="true">
                                        <DataBinding ColumnKey="NumUserDef3"/>
                                    </GridCell>
                                    <GridCell Key="MaterialStatusId_L1" Caption="物料状态" CellType="Dict" Enable="false" ItemKey="LRP_MaterialStatus">
                                        <DataBinding ColumnKey="MaterialStatusId"/>
                                    </GridCell>
                                    <GridCell Key="Qty_L1" Caption="账面量" CellType="NumberEditor" Enable="false" ShowZero="true" Precision="15" Scale="3">
                                        <DataBinding ColumnKey="Qty"/>
                                    </GridCell>
                                    <GridCell Key="CheckQty_L1" Caption="盘点量" CellType="NumberEditor" Enable="false" ShowZero="true" Precision="15" Scale="3">
                                        <DataBinding ColumnKey="CheckQty"/>
                                    </GridCell>
                                    <GridCell Key="BasicUnit_L1" Caption="单位" CellType="TextEditor" Enable="false">
                                        <DataBinding DefaultFormulaValue="GetDictValue('LRP_Material', MaterialId_L1, 'BasicUnit')"/>
                                    </GridCell>
                                    <GridCell Key="StoreroomId_L1" Caption="仓间" CellType="Dict" ItemKey="LRP_Storeroom" Enable="false">
                                        <DataBinding ColumnKey="StoreroomId"/>
                                    </GridCell>
                                    <GridCell Key="StoreareaId_L1" Caption="库区" CellType="Dict" ItemKey="LRP_Storearea" Enable="false">
                                        <DataBinding ColumnKey="StoreareaId"/>
                                    </GridCell>
                                    <GridCell Key="LocationId_L1" Caption="储位" CellType="Dict" ItemKey="LRP_Location" Enable="false">
                                        <DataBinding ColumnKey="LocationId"/>
                                    </GridCell>
                                    <GridCell Key="GenMethod_L1" Caption="生成方式" CellType="ComboBox" Enable="false">
                                        <DataBinding ColumnKey="GenMethod" DefaultValue="1"/>
                                        <Item Caption="系统生成" Key="0" Value="0"/>
                                        <Item Caption="盘点录入" Key="1" Value="1"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                        </Grid>
                    </TabPanel>
                    <SplitSize Size="230px"/>
                    <SplitSize Size="100%"/>
                </SplitPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[                
		SetColumnCaption("Grid0","BatchNo",ToString(GetSessionPara('BatchNo_Name')));
		SetColumnCaption("Grid0","ManufDate",ToString(GetSessionPara('ManufDate_Name')));
		SetColumnCaption("Grid0","ExpireDate",ToString(GetSessionPara('ExpireDate_Name')));
		SetColumnCaption("Grid0","ProjectId",ToString(GetSessionPara('ProjectId_Name')));
		SetColumnCaption("Grid0","StrUserDef1",ToString(GetSessionPara('StrUserDef1_Name')));
		SetColumnCaption("Grid0","StrUserDef2",ToString(GetSessionPara('StrUserDef2_Name')));
		SetColumnCaption("Grid0","StrUserDef3",ToString(GetSessionPara('StrUserDef3_Name')));
		SetColumnCaption("Grid0","StrUserDef4",ToString(GetSessionPara('StrUserDef4_Name')));
		SetColumnCaption("Grid0","StrUserDef5",ToString(GetSessionPara('StrUserDef5_Name')));
		SetColumnCaption("Grid0","DictUserDef1",ToString(GetSessionPara('DictUserDef1_Name')));
		SetColumnCaption("Grid0","DictUserDef2",ToString(GetSessionPara('DictUserDef2_Name')));
		SetColumnCaption("Grid0","DictUserDef3",ToString(GetSessionPara('DictUserDef3_Name')));
		SetColumnCaption("Grid0","DictUserDef4",ToString(GetSessionPara('DictUserDef4_Name')));
		SetColumnCaption("Grid0","DictUserDef5",ToString(GetSessionPara('DictUserDef5_Name')));
		SetColumnCaption("Grid0","DateUserDef1",ToString(GetSessionPara('DateUserDef1_Name')));
		SetColumnCaption("Grid0","DateUserDef2",ToString(GetSessionPara('DateUserDef2_Name')));
		SetColumnCaption("Grid0","NumUserDef1",ToString(GetSessionPara('NumUserDef1_Name')));
		SetColumnCaption("Grid0","NumUserDef2",ToString(GetSessionPara('NumUserDef2_Name')));
		SetColumnCaption("Grid0","NumUserDef3",ToString(GetSessionPara('NumUserDef3_Name')));
		SetColumnCaption("Grid1","BatchNo",ToString(GetSessionPara('BatchNo_Name')));
		SetColumnCaption("Grid1","ManufDate",ToString(GetSessionPara('ManufDate_Name')));
		SetColumnCaption("Grid1","ExpireDate",ToString(GetSessionPara('ExpireDate_Name')));
		SetColumnCaption("Grid1","ProjectId",ToString(GetSessionPara('ProjectId_Name')));
		SetColumnCaption("Grid1","StrUserDef1",ToString(GetSessionPara('StrUserDef1_Name')));
		SetColumnCaption("Grid1","StrUserDef2",ToString(GetSessionPara('StrUserDef2_Name')));
		SetColumnCaption("Grid1","StrUserDef3",ToString(GetSessionPara('StrUserDef3_Name')));
		SetColumnCaption("Grid1","StrUserDef4",ToString(GetSessionPara('StrUserDef4_Name')));
		SetColumnCaption("Grid1","StrUserDef5",ToString(GetSessionPara('StrUserDef5_Name')));
		SetColumnCaption("Grid1","DictUserDef1",ToString(GetSessionPara('DictUserDef1_Name')));
		SetColumnCaption("Grid1","DictUserDef2",ToString(GetSessionPara('DictUserDef2_Name')));
		SetColumnCaption("Grid1","DictUserDef3",ToString(GetSessionPara('DictUserDef3_Name')));
		SetColumnCaption("Grid1","DictUserDef4",ToString(GetSessionPara('DictUserDef4_Name')));
		SetColumnCaption("Grid1","DictUserDef5",ToString(GetSessionPara('DictUserDef5_Name')));
		SetColumnCaption("Grid1","DateUserDef1",ToString(GetSessionPara('DateUserDef1_Name')));
		SetColumnCaption("Grid1","DateUserDef2",ToString(GetSessionPara('DateUserDef2_Name')));
		SetColumnCaption("Grid1","NumUserDef1",ToString(GetSessionPara('NumUserDef1_Name')));
		SetColumnCaption("Grid1","NumUserDef2",ToString(GetSessionPara('NumUserDef2_Name')));
		SetColumnCaption("Grid1","NumUserDef3",ToString(GetSessionPara('NumUserDef3_Name')));
		]]>
    </OnLoad>
    <MacroCollection>
        <Macro Key="BuildCountDetail">
            <![CDATA[
				  //生成新的明细
					  var table=InvokeService("LRP_BuildCountDetail", false, false,OwnerId,StoreroomId,StoreareaId,LocationId,MaterialId,StartDate,EndDate,WarehouseCenterId);
				      var i=0;
				      //把查询的明细写进grid中,生成方式是0 系统生成
				      table.beforefirst();
				      while(table.next()){
						  InsertRow("Grid0", -1);
						  SetCellValue("Grid0", i, "MaterialId_L0",ToLong(table.MaterialId));
						  SetCellValue("Grid0", i, "BatchNo_L0", table.BatchNo);
						  SetCellValue("Grid0", i, "ManufDate_L0", table.ManufDate);
						  SetCellValue("Grid0", i, "ExpireDate_L0", table.ExpireDate);
						  SetCellValue("Grid0", i, "ProjectId_L0", ToLong(table.ProjectId));
						  SetCellValue("Grid0", i, "StrUserDef1_L0", table.StrUserDef1);
						  SetCellValue("Grid0", i, "StrUserDef2_L0", table.StrUserDef2);
						  SetCellValue("Grid0", i, "StrUserDef3_L0", table.StrUserDef3);
						  SetCellValue("Grid0", i, "StrUserDef4_L0", table.StrUserDef4 );
						  SetCellValue("Grid0", i, "StrUserDef5_L0", table.StrUserDef5);
						  SetCellValue("Grid0", i, "DictUserDef1_L0", ToLong(table.DictUserDef1));
						  SetCellValue("Grid0", i, "DictUserDef2_L0", ToLong(table.DictUserDef2));
						  SetCellValue("Grid0", i, "DictUserDef3_L0", ToLong(table.DictUserDef3));
						  SetCellValue("Grid0", i, "DictUserDef4_L0", ToLong(table.DictUserDef4));
						  SetCellValue("Grid0", i, "DictUserDef5_L0", ToLong(table.DictUserDef5));
						  SetCellValue("Grid0", i, "DateUserDef1_L0", table.DateUserDef1);
						  SetCellValue("Grid0", i, "DateUserDef2_L0", table.DateUserDef2);
						  SetCellValue("Grid0", i, "NumUserDef1_L0", table.NumUserDef1);
						  SetCellValue("Grid0", i, "NumUserDef2_L0", table.NumUserDef2);
						  SetCellValue("Grid0", i, "NumUserDef3_L0", table.NumUserDef3);
						  SetCellValue("Grid0", i, "MaterialStatusId_L0", ToLong(table.MaterialStatusId));
						  SetCellValue("Grid0", i, "Qty_L0", table.OnhandQty);
						  SetCellValue("Grid0", i, "CheckQty_L0", table.OnhandQty);
						  SetCellValue("Grid0", i, "StoreroomId_L0", ToLong(table.StoreroomId));
						  SetCellValue("Grid0", i, "StoreareaId_L0", ToLong(table.StoreareaId));
						  SetCellValue("Grid0", i, "LocationId_L0", ToLong(table.LocationId));
						  SetCellValue("Grid0", i, "GenMethod_L0", 0);
						  i=i+1;
				      }
	    ]]>
        </Macro>
    </MacroCollection>
</Form>
