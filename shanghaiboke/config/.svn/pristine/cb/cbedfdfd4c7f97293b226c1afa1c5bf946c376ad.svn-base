<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="MyLogin" Authenticate="False">
	<NavigationBar BackColor="#f14c52">
		<BarItem Key="TitleCenter_bar" Caption="登录" Location="Center">
			<Label Key="TitleCenter" Caption="登录" Width="pref">
				<Format HAlign="Center" ForeColor="#ffffff">
					<Font Size="20"/>
				</Format>
			</Label>
		</BarItem>
	</NavigationBar>
	<Body> 
		<Block>
			<TableView Key="root">
				<Format BackColor="#f1f3f8">
				</Format>
				<TableRowCollection>
					<TableRow Key="r1" RowType="Fix">
						<GridLayoutPanel Key="header" Height="200px">
							<Format BackColor="#f1f3f8">
							</Format>
							<RowDefCollection>
								<RowDef Height="50px"/>
								<RowDef Height="120px"/>
								<RowDef Height="30px"/>
							</RowDefCollection>
							<ColumnDefCollection>
								<ColumnDef Width="50%"/>
								<ColumnDef Width="120px"/>
								<ColumnDef Width="50%"/>
							</ColumnDefCollection>
							<Image Key="mylogo" Caption="我的头像" Stretch="True" ImageScaleType="Fit_XY" PromptImage="5.png" X="1" Y="1" BorderStyle="none">
								<Format BackColor="#f1f3f8"/>
							</Image>
						</GridLayoutPanel>
					</TableRow>
					<TableRow Key="r2" RowType="Fix">
						<LinearLayoutPanel Key="user_panel" Orientation="Horizontal" Height="50px">
							<Label Key="lbl_1" Width="20px" Weight="0" Height="auto">
								<Format BackColor="#f1f3f8">
								</Format>
							</Label>
							<Label Key="lbl_user" Caption="帐号" Width="60px" LeftPadding="10px" Weight="0" Height="auto" BorderStyle="solid none solid solid" BorderColor="#dde0e7" HasBorder="true">
								<Format BackColor="#ffffff" ForeColor="#969696">
									<Font Size="16"/>
								</Format>
							</Label>
							<TextEditor Key="user" Caption="帐号" PromptText="手机号/用户名" BorderStyle="solid solid solid none" BorderColor="#dde0e7" HasBorder="true" Width="0px" Weight="1" Height="auto">
								<DataBinding DefaultFormulaValue="LoadLocalData('user')"/>
								<Format BackColor="#ffffff">
									<Font Size="16"/>
								</Format>
							</TextEditor>
							<Label Key="lbl_2" Width="20px" Weight="0" Height="auto">
								<Format BackColor="#f1f3f8">
								</Format>
							</Label>
						</LinearLayoutPanel>
					</TableRow>
					<TableRow Key="r3" RowType="Fix">
						<LinearLayoutPanel Key="password_panel" Orientation="Horizontal" Height="50px">
							<Label Key="lbl_3" Width="20px" Weight="0" Height="auto">
								<Format BackColor="#f1f3f8">
								</Format>
							</Label>
							<Label Key="lbl_password" Caption="密码" Width="60px" LeftPadding="10px" BorderStyle="none none solid solid" BorderColor="#dde0e7" HasBorder="true" Weight="0" Height="auto">
								<Format BackColor="#ffffff" ForeColor="#969696">
									<Font Size="16"/>
								</Format>
							</Label>
							<PasswordEditor Key="password" Caption="密码" BorderStyle="none solid solid none" BorderColor="#dde0e7" HasBorder="true" PromptText="请输入密码" Width="0px" Weight="1" Height="auto">
								<Format BackColor="#ffffff">
									<Font Size="16"/>
								</Format>
							</PasswordEditor>
							<Label Key="lbl_4" Width="20px" Weight="0" Height="auto">
								<Format BackColor="#f1f3f8">
								</Format>
							</Label>
						</LinearLayoutPanel>
					</TableRow>
					<TableRow Key="r4" RowType="Fix" TopMargin="30px">
						<GridLayoutPanel Key="r4_layout" Height="50px">
							<Format BackColor="#f1f3f8">
							</Format>
							<RowDefCollection>
								<RowDef Height="45px"/>
							</RowDefCollection>
							<ColumnDefCollection>
								<ColumnDef Width="20px"/>
								<ColumnDef Width="100%"/>
								<ColumnDef Width="20px"/>
							</ColumnDefCollection>
							<Button Key="login" Caption="登录" Width="0px" Height="auto" X="1" Y="0">
								<Format BackColor="#f14c52" ForeColor="#ffffff">
									<Font Size="20"/>
								</Format>
								<OnClick>
									<![CDATA[
										if(user==''){
											ShowToast("请输入用户名！");
											return true;
										}
										if(password==''){
											ShowToast("请输入密码！");
											return true;
										}
										
										if(InvokeUnsafeService('LRP_IsNaN', false, false , user)){
											var userCode=DBNamedQueryValue('QueryCode', user);
											SaveLocalData('user',userCode);
												GuestLogin(userCode,password);
										}else{
											SaveLocalData('user',user);
											GuestLogin(user,password);	
										}
										SendSignal('SessionChanged');
										root.SetPara('UserDispatchOrg',DBNamedQueryValue('QueryUserDispatchOrg',user,user));
										Close();
									]]>	
								</OnClick>
							</Button>
						</GridLayoutPanel>
					</TableRow>
					<TableRow Key="r5" RowType="Fix">
						<LinearLayoutPanel Key="more_panel" Orientation="Horizontal" Height="50px" LeftPadding="30px" RightPadding="30px">
							<Format BackColor="#f1f3f8">
							</Format>
							<HyperLink Key="register" Caption="注册新帐户" Width="120px" Weight="0" Height="auto">
								<OnClick>
									<![CDATA[Show('MyRegister')]]>
								</OnClick>
								<Format HAlign="Left" BackColor="#f1f3f8" ForeColor="#969696">
									<Font Size="16"/>
								</Format>
							</HyperLink>
							<Label Key="more_sep" Width="0px" Weight="1" Height="auto">
								<Format BackColor="#f1f3f8"/>
							</Label>
							<HyperLink Key="forget" Caption="忘记密码？" Width="120px" Weight="0" Height="auto">
								<Format HAlign="Right" BackColor="#f1f3f8" ForeColor="#f14c52">
									<Font Size="16"/>
								</Format>
								<OnClick>
									<![CDATA[
									Show('MyReapplyPass');
									]]>
								</OnClick>
							</HyperLink>
						</LinearLayoutPanel>
					</TableRow>
				</TableRowCollection>
			</TableView>
		</Block>
	</Body>
	<QueryCollection>
		<Query Key="QueryCode" Description="">
			<Statement>
				<![CDATA[select Code from USER_OPERATOR where Mobile=?]]>
			</Statement>
		</Query>
		<Query Key="QueryUserDispatchOrg" Description="">
			<Statement>
				<![CDATA[select defaultdispatchOrgId from USER_Operator where (mobile = ? or code=?)]]>
			</Statement>
			<ParameterCollection>
				<Parameter DataType="Varchar"/>
				<Parameter DataType="Varchar"/>
			</ParameterCollection>
		</Query>
	</QueryCollection>

</Form>
