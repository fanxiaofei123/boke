<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="PutawayByStockDetail" Caption="上架输入" Authenticate="false" HasNavigationBar="false">
    <DataSource>
        <DataObject Key="LRP_PutawayByStockDetail" Caption="上架输入" PrimaryTableKey="LRP_WMTx_L">
            <TableCollection>
                <Table Key="LRP_WMTx_L" Caption="待上架明细" TableMode="Detail" SourceType="Query">
                    <Column Caption="对象标识" DataType="Long" Key="OID"/>
                    <Column Caption="物料ID" DataType="Long" Key="MaterialId"/>
                    <Column Caption="单位" DataType="Varchar" Key="MaterialUnit" Length="10"/>
                    <Column Caption="上架量" DataType="Numeric" Key="Qty" Precision="18" Scale="6"/>
                    <Column Key="MaterialName" Caption="物料名称" DataType="Varchar" Length="200"/>
                    <Column Key="MaterialCode" Caption="物料代码" DataType="Varchar" Length="100"/>
                    <Column Key="DestBatchNo" Caption="批号" DataType="Varchar" Length="200"/>
                    <Column Caption="储位ID" DataType="Long" Key="DestLocationId"/>
                    <Column Key="LocationCode" Caption="储位代码" DataType="Varchar" Length="100"/>
                    <Column Caption="明细对象标识" DataType="Long" Key="LineOID"/>
                    <!--  <ParameterCollection>
						<Parameter Formula="GetPara('OID')" DataType="Long"/>
                    </ParameterCollection>   -->
                    <Statement>
                        <![CDATA[ 
select 
h.oid,
  l.oid as LineOid,
  l.SOID,
  l.MaterialId,
  l.qty,
  l.MaterialUnit,  
  l.DestLocationId,
l.DestBatchNo,
  o.Code as LocationCode,
  m.Name as MaterialName,
  m.Code as MaterialCode
  from LRP_WMTx_H h left join LRP_WMTx_L l on h.oid=l.soid
  left join LRP_Material m on m.oid = l.MaterialId left join LRP_Location o on o.oid=l.DestLocationId  where 1=0
    ]]>
                    </Statement>
                </Table>
                <Table Key="LRP_WMTx_LTX" Caption="本次上架明细" TableMode="Detail" SourceType="Query">
                    <Column Caption="对象标识" DataType="Long" Key="OID"/>
                    <Column Caption="物料ID" DataType="Long" Key="MaterialId"/>
                    <Column Caption="单位" DataType="Varchar" Key="MaterialUnit" Length="10"/>
                    <Column Caption="通知量" DataType="Numeric" Key="Qty" Precision="18" Scale="6"/>
                    <Column Caption="收货量" DataType="Numeric" Key="RecvQty" Precision="18" Scale="6"/>
                    <Column Key="MaterialName" Caption="物料名称" DataType="Varchar" Length="200"/>
                    <Column Key="MaterialCode" Caption="物料代码" DataType="Varchar" Length="100"/>
                    <Column Key="DestBatchNo" Caption="批号" DataType="Varchar" Length="200"/>
                    <Column Caption="储位ID" DataType="Long" Key="DestLocationId"/>
                    <Column Key="LocationCode" Caption="储位代码" DataType="Varchar" Length="100"/>
                    <Column Caption="明细对象标识" DataType="Long" Key="LineOID"/>
                    <!--  <ParameterCollection>
						<Parameter Formula="GetPara('OID')" DataType="Long"/>
                    </ParameterCollection> -->
                    <Statement>
                        <![CDATA[ 
select 
h.oid,
  l.oid as LineOid,
  l.SOID,
  l.MaterialId,
  l.qty,
  l.MaterialUnit,  
  l.DestLocationId,
l.DestBatchNo,
  o.Code as LocationCode,
  m.Name as MaterialName,
  m.Code as MaterialCode
  from LRP_WMTx_H h left join LRP_WMTx_L l on h.oid=l.soid
  left join LRP_Material m on m.oid = l.MaterialId left join LRP_Location o on o.oid=l.DestLocationId where 1=0
    ]]>
                    </Statement>
                </Table>
            </TableCollection>
        </DataObject>
    </DataSource>
    <QueryCollection>
        <Query Key="SelectLocation" Description="查找存储区储位">
            <Statement>
                <![CDATA[
				select l.Code from LRP_Location l left join LRP_Storearea s on l.Storeareaid=s.oid 
				where s.IsRecvArea=0 and s.IsShipArea=0 and s.IsSampleTestArea=0 and s.IsKittingArea=0 and l.WarehouseCenterId = ? ]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Long"/>
            </ParameterCollection>
        </Query>
    </QueryCollection>
    <Body>
        <Block>
            <GridLayoutPanel Key="root">
                <Format BackColor="#e6e6e6"/>
                <LinearLayoutPanel Caption="Title3" Key="Title" Orientation="Horizontal" X="0" Y="0">
                    <Format BackColor="#f14c52"/>
                    <Button Key="Cancel" Caption="取消" Height="auto" Width="60px">
                        <Format BackColor="#f14c52" ForeColor="#ffffff" HAlign="Left">
                            <Font Size="16"/>
                        </Format>
                        <OnClick>
                            <![CDATA[
									ShowConfirm('是否放弃本次上架？', 'YES_NO', 
										{
											YES: {
													Back();
												}, 
											NO: {} 
										}
												)
								]]>
                        </OnClick>
                    </Button>
                    <Label Key="OrderTitle3" Caption="上架输入" Height="auto" Weight="1.0">
                        <Format ForeColor="#ffffff" HAlign="Center">
                            <Font Size="20"/>
                        </Format>
                    </Label>
                    <Button Key="Finish" Caption="完成" Height="auto" Width="60px">
                        <Format BackColor="#f14c52" ForeColor="#ffffff" HAlign="Right">
                            <Font Size="16"/>
                        </Format>
                        <OnClick>
                            <![CDATA[
									var count = GetRowCount('list2',false);
									var b = true;
									if(count > 0){
										InvokeService("LRP_PutawayFinish", true, false,GetPara('OID'),GetOperator(),Para('WarehouseCenterId2'),Para('ownerId2'));
										ShowToast("上架完成");
										Parent.LoadData();
										Back();
									}
									else{	
										ShowToast("本次上架明细无数据，无法完成。");								
									}
																													
									]]>
                        </OnClick>
                    </Button>
                </LinearLayoutPanel>
                <Label Key="ShowValue" X="0" Y="1" Visible="false"/>
                <TabGroup Caption="上架输入" Key="TabPanel1" IndicatorColor="#ff5000" X="0" Y="1">
                    <TabItem Text="待上架明细">
                        <Action>
                            <![CDATA[SetValue('ShowValue', 0);]]>
                        </Action>
                    </TabItem>
                    <TabItem Text="本次上架明细">
                        <Action>
                            <![CDATA[SetValue('ShowValue', 1);]]>
                        </Action>
                    </TabItem>
                </TabGroup>
                <TableView Key="RouteName_table" X="0" Y="2" Visible="ShowValue==0">
                    <Format BackColor="#f1f3f8"/>
                    <TableRowCollection>
                        <TableRow Key="r1" SeparatorStyle="solid solid solid none" SeparatorColor="#dde0e7" TopMargin="5px">
                            <LinearLayoutPanel Key="service_center_panel33" Height="50px" Orientation="Horizontal">
                                <TextEditor Key="Material_code" Caption="扫描物料条码" PromptText="扫描物料条码" BorderStyle="none" Weight="1.0" Height="auto">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                    <KeyEnter>
                                        <![CDATA[
										     CheckMaterial();
										
									  ]]>
                                    </KeyEnter>
                                </TextEditor>
                                <Button Key="query_btn" Icon="12.png" OnlyIcon="True" Enable="true" Width="40px" BorderStyle="none" Height="auto">
                                    <Format HAlign="Left">
                                        <Font Size="6"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
										CheckMaterial();
									]]>
                                    </OnClick>
                                </Button>
                                <Button Key="AllPutaway" Caption="全部上架" Enable="true" Width="100px" BorderRadius="4" BorderColor="#dde0e7" HasBorder="true">
                                    <Format BackColor="#f14c52" ForeColor="#ffffff" HAlign="Center">
                                        <Font Size="13"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
										 var count = GetRowCount('list');
										 var i = count-1;
										 while(i <= count){
										    if(GetCellValue('list',i,'Location')<>''){
											       var MtlCode = GetCellValue('list',i,'Materialcode');
								                   var MtlName = GetCellValue('list',i,'MaterialName');
											       var MtlUnit = GetCellValue('list',i,'MaterialUnit');
											       var batchNo = GetCellValue('list',i,'BatchNo');
												   var qty = GetCellValue('list',i,'Qty');	
                                                   var location = GetCellValue('list',i,'Location');
												   var lineOID = GetCellValue('list',i, 'LineOID');
												   var materialId = GetCellValue('list',i, 'MaterialId');
												   
												   var rowIndex = InsertRow('list2');
												   SetCellValue('list2', rowIndex, 'Materialcode2', MtlCode,false);
												   SetCellValue('list2', rowIndex, 'MaterialName2', MtlName,false);
												   SetCellValue('list2', rowIndex, 'MaterialUnit2', MtlUnit,false);
												   SetCellValue('list2', rowIndex, 'Qty2', qty,false);
												   SetCellValue('list2', rowIndex, 'BatchNo2',batchNo,false);
												   SetCellValue('list2', rowIndex, 'Location2',location,false);
												   SetCellValue('list2', rowIndex, 'LineOID2',lineOID,false);
												   SetCellValue('list2', rowIndex, 'MaterialId2',materialId,false);
												      
											        DeleteRow('list',i);

										     }
										   i=i-1;
										 }
									]]>
                                    </OnClick>
                                </Button>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="list" SeparatorStyle="solid none solid none" RowType="Detail" SeparatorColor="#dde0e7" TableKey="LRP_WMTx_L" SelectColor="#dddddd">
                            <GridLayoutPanel Key="GridLayoutPanel3" Caption="GridLayoutPanel3">
                                <Label Key="LineOID" LeftPadding="5px" Visible="false" X="0" Y="0" XSpan="2">
                                    <DataBinding ColumnKey="LineOID"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialId" LeftPadding="5px" Visible="false" X="0" Y="0" XSpan="2">
                                    <DataBinding ColumnKey="MaterialId"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="Materialcode" LeftPadding="5px" X="0" Y="0" XSpan="2">
                                    <DataBinding DefaultFormulaValue="GetDictValue('LRP_Material',MaterialId,'Code')"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialName" LeftPadding="5px" X="2" Y="0" XSpan="2">
                                    <DataBinding DefaultFormulaValue="GetDictValue('LRP_Material',MaterialId,'Name')"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialUnit" LeftPadding="5px" X="4" Y="1" XSpan="2">
                                    <DataBinding ColumnKey="MaterialUnit"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="BatchNo" Caption="批号" Enable="false" LeftPadding="5px" X="6" Y="0" XSpan="4">
                                    <DataBinding ColumnKey="DestBatchNo"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </TextEditor>
                                <Label Key="Qty_lbl" Caption="上架量" LeftPadding="5px" X="0" Y="1" XSpan="2">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <NumberEditor Key="Qty" Precision="18" Scale="0" X="2" Y="1" XSpan="2">
                                    <DataBinding ColumnKey="Qty"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </NumberEditor>
                                <Label Key="Location_lbl" Caption="储位" LeftPadding="5px" X="6" Y="1" XSpan="2">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="Location" Caption="储位" X="8" Y="1" XSpan="4">
                                    <DataBinding ColumnKey="LocationCode"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                    <KeyEnter>
                                        <![CDATA[
										  
										   var index = GetRowIndex('list');
										   var rs = DBNamedQuery('SelectLocation',root.GetPara('WarehouseCenterId'));
										   var flag = false;	
										   if(GetCellValue('list',index,'Location')<>''){
											    rs.beforefirst();
												while(rs.next()){
												if(GetCellValue('list',index,'Location') == rs.Code){
													flag=true;
													break;
												 }
											   }
											   if(flag == false){
											       ShowToast("存储区中不存在储位" + GetCellValue('list',index,'Location'));
											   }else{
											      if(GetCellValue('list',index,'Qty') > 0){
												    var MtlCode = GetCellValue('list',index, 'Materialcode');
								                    var MtlName = GetCellValue('list',index, 'MaterialName');
											       var MtlUnit = GetCellValue('list',index, 'MaterialUnit');
											       var batchNo = GetCellValue('list',index, 'BatchNo');
												   var qty = GetCellValue('list',index, 'Qty');	
                                                   var location = GetCellValue('list',index, 'Location');
												   var lineOID = GetCellValue('list',index, 'LineOID');
												   var materialId = GetCellValue('list',index, 'MaterialId');
												   
												   var rowIndex = InsertRow('list2');

												   SetCellValue('list2', rowIndex, 'Materialcode2', MtlCode,false);
												   SetCellValue('list2', rowIndex, 'MaterialName2', MtlName,false);
												   SetCellValue('list2', rowIndex, 'MaterialUnit2', MtlUnit,false);
												   SetCellValue('list2', rowIndex, 'Qty2', qty,false);
												   SetCellValue('list2', rowIndex, 'BatchNo2',batchNo,false);
												   SetCellValue('list2', rowIndex, 'Location2',location,false);
												   SetCellValue('list2', rowIndex, 'LineOID2',lineOID,false);
												   SetCellValue('list2', rowIndex, 'MaterialId2',materialId,false);
												   
												   DeleteRow('list',index);
                                                
												  }else{
												     ShowToast("上架量要大于0");
												  }
											   }
											 }
										
										
									  ]]>
                                    </KeyEnter>
                                </TextEditor>
                                <Button Key="Delete" Caption="删除" BorderRadius="4" BorderColor="#dde0e7" HasBorder="true" X="0" Y="2" XSpan="4">
                                    <Format BackColor="#f14c52" ForeColor="#ffffff" HAlign="Center">
                                        <Font Size="13"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
								          ShowConfirm('确定删除该条明细吗?', 'YES_NO', 
												{
													YES: {
														DeleteRow('list', GetRowIndex('list'));	
														ShowToast('已删除');	  
													  }, 
													NO: {} 
												}	
											)
											
										
									]]>
                                    </OnClick>
                                </Button>
                                <Button Key="Split" Caption="拆分" BorderRadius="4" BorderColor="#dde0e7" HasBorder="true" X="4" Y="2" XSpan="4">
                                    <Format BackColor="#f14c52" ForeColor="#ffffff" HAlign="Center">
                                        <Font Size="13"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
								       var MtlCode = GetCellValue('list', -1, 'Materialcode');
								       var MtlName = GetCellValue('list', -1, 'MaterialName');
									   var MtlUnit = GetCellValue('list', -1, 'MaterialUnit');
									   var batchNo = GetCellValue('list', -1, 'BatchNo');
									   var materialId = GetCellValue('list',-1, 'MaterialId');
								
									   var rowIndex= InsertRow('list',GetRowIndex('list')+1);

									   SetCellValue('list', rowIndex, 'Materialcode', MtlCode);
									   SetCellValue('list', rowIndex, 'MaterialName', MtlName);
									   SetCellValue('list', rowIndex, 'MaterialUnit', MtlUnit);
									   SetCellValue('list', rowIndex, 'Qty', 0);
									   SetCellValue('list', rowIndex, 'BatchNo',batchNo);
									   SetCellValue('list', rowIndex, 'Location',"");
									   SetCellValue('list', rowIndex, 'MaterialId',materialId);

									]]>
                                    </OnClick>
                                </Button>
                                <Button Key="Putaway" Caption="上架" BorderRadius="4" BorderColor="#dde0e7" HasBorder="true" X="8" Y="2" XSpan="4">
                                    <Format BackColor="#f14c52" ForeColor="#ffffff" HAlign="Center">
                                        <Font Size="13"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
								       var index = GetRowIndex('list');
									    var rs = DBNamedQuery('SelectLocation',root.GetPara('WarehouseCenterId'));
								        var flag = false;	
										   if(GetCellValue('list',index,'Location')<>''){
											    rs.beforefirst();
												while(rs.next()){
												if(GetCellValue('list',index,'Location') == rs.Code){
													flag=true;
													break;
												 }
											   }
											   if(flag == false){
											      ShowToast("存储区中不存在储位" + GetCellValue('list',index,'Location'));
											   }else{
											      if(GetCellValue('list',index,'Qty') > 0){
												    var MtlCode = GetCellValue('list',index, 'Materialcode');
								                    var MtlName = GetCellValue('list',index, 'MaterialName');
											       var MtlUnit = GetCellValue('list',index, 'MaterialUnit');
											       var batchNo = GetCellValue('list',index, 'BatchNo');
												   var qty = GetCellValue('list',index, 'Qty');	
                                                   var location = GetCellValue('list',index, 'Location');
												   var lineOID = GetCellValue('list',index, 'LineOID');
												   var materialId = GetCellValue('list',index, 'MaterialId');
												   
												   var rowIndex = InsertRow('list2');

												   SetCellValue('list2', rowIndex, 'Materialcode2', MtlCode,false);
												   SetCellValue('list2', rowIndex, 'MaterialName2', MtlName,false);
												   SetCellValue('list2', rowIndex, 'MaterialUnit2', MtlUnit,false);
												   SetCellValue('list2', rowIndex, 'Qty2', qty,false);
												   SetCellValue('list2', rowIndex, 'BatchNo2',batchNo,false);
												   SetCellValue('list2', rowIndex, 'Location2',location,false);
												   SetCellValue('list2', rowIndex, 'LineOID2',lineOID,false);
												   SetCellValue('list2', rowIndex, 'MaterialId2',materialId,false);
												   
												   DeleteRow('list', index);
												     
												  }else{
												     ShowToast("上架量要大于0");
												  }
											   }
											 }else{
											     ShowToast("储位不能为空。");
											 }
											 
									]]>
                                    </OnClick>
                                </Button>
                                <RowDefCollection RowGap="1">
                                    <RowDef Height="40px"/>
                                    <RowDef Height="40px"/>
                                    <RowDef Height="40px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="1">
                                    <ColumnDef Width="50px"/>
                                    <ColumnDef Width="18%"/>
                                    <ColumnDef Width="50px"/>
                                    <ColumnDef Width="18%"/>
                                    <ColumnDef Width="20px"/>
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="50px"/>
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="50px"/>
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="80px"/>
                                    <ColumnDef Width="16%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
                <TableView Key="RouteName_table2" X="0" Y="2" Visible="ShowValue==1">
                    <Format BackColor="#f1f3f8"/>
                    <TableRowCollection>
                        <TableRow Key="list2" SeparatorStyle="solid none solid none" RowType="Detail" SeparatorColor="#dde0e7" TableKey="LRP_WMTx_LTX" SelectColor="#dddddd">
                            <GridLayoutPanel Key="GridLayoutPanel4" Caption="GridLayoutPanel4">
                                <Label Key="LineOID2" LeftPadding="5px" Visible="false" X="0" Y="0" XSpan="2">
                                    <DataBinding ColumnKey="LineOID"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialId2" LeftPadding="5px" Visible="false" X="0" Y="0" XSpan="2">
                                    <DataBinding ColumnKey="MaterialId"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="Materialcode2" LeftPadding="5px" X="0" Y="0" XSpan="2">
                                    <DataBinding ColumnKey="MaterialCode"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialName2" LeftPadding="5px" X="2" Y="0" XSpan="2">
                                    <DataBinding ColumnKey="MaterialName"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialUnit2" LeftPadding="5px" X="4" Y="1" XSpan="2">
                                    <DataBinding ColumnKey="MaterialUnit"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="BatchNo2" Caption="批号" Enable="false" LeftPadding="5px" X="6" Y="0" XSpan="4">
                                    <DataBinding ColumnKey="DestBatchNo"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </TextEditor>
                                <Label Key="Qty_lbl2" Caption="上架量" LeftPadding="5px" X="0" Y="1" XSpan="2">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <NumberEditor Key="Qty2" Precision="18" Scale="0" X="2" Y="1" Enable="false" XSpan="2">
                                    <DataBinding ColumnKey="Qty"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </NumberEditor>
                                <Label Key="Location_lbl2" Caption="储位" LeftPadding="5px" X="6" Y="1" XSpan="2">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="Location2" Caption="储位" Enable="false" X="8" Y="1" XSpan="2">
                                    <DataBinding ColumnKey="LocationCode"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </TextEditor>
                                <Button Key="Putaway_R" Caption="下架" BorderRadius="4" BorderColor="#dde0e7" HasBorder="true" X="10" Y="1" XSpan="2">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
								       ShowConfirm('是否将该行明细下架？', 'YES_NO', 
										{
											YES: {
											      var index = GetRowIndex('list2');
												  var MtlCode = GetCellValue('list2',index, 'Materialcode2');
								                  var MtlName = GetCellValue('list2',index, 'MaterialName2');
											       var MtlUnit = GetCellValue('list2',index, 'MaterialUnit2');
											       var batchNo = GetCellValue('list2',index, 'BatchNo2');
												   var qty = GetCellValue('list2',index, 'Qty2');	
                                                   var location = GetCellValue('list2',index, 'Location2');
												   var lineOID = GetCellValue('list2',index, 'LineOID2');
												   var materialId = GetCellValue('list2',index, 'MaterialId2');
												   
												   var rowIndex = InsertRow('list');

												   SetCellValue('list', rowIndex, 'Materialcode', MtlCode);
												   SetCellValue('list', rowIndex, 'MaterialName', MtlName);
												   SetCellValue('list', rowIndex, 'MaterialUnit', MtlUnit);
												   SetCellValue('list', rowIndex, 'Qty', qty);
												   SetCellValue('list', rowIndex, 'BatchNo',batchNo);
												   SetCellValue('list', rowIndex, 'Location',location);
												   SetCellValue('list', rowIndex, 'LineOID',lineOID);
												   SetCellValue('list', rowIndex, 'MaterialId',materialId,false);
												   
												   DeleteRow('list2', index);
												}, 
											NO: {} 
										}
												)
									]]>
                                    </OnClick>
                                </Button>
                                <RowDefCollection RowGap="1">
                                    <RowDef Height="40px"/>
                                    <RowDef Height="40px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="1">
                                    <ColumnDef Width="50px"/>
                                    <ColumnDef Width="18%"/>
                                    <ColumnDef Width="80px"/>
                                    <ColumnDef Width="18%"/>
                                    <ColumnDef Width="20px"/>
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="50px"/>
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="50px"/>
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="50px"/>
                                    <ColumnDef Width="16%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
                <RowDefCollection>
                    <RowDef Height="50px"/>
                    <RowDef Height="50px"/>
                    <RowDef Height="100%"/>
                </RowDefCollection>
                <ColumnDefCollection>
                    <ColumnDef Width="100%"/>
                </ColumnDefCollection>
            </GridLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[
		    LoadData();
			var dt = InvokeService("LRP_PutawayByStock", true, false,Para('OID'));
			ReplaceTable('LRP_WMTx_L',dt);
			RefreshControl("RouteName_table");
			
		
					  
        ]]>
    </OnLoad>
    <MacroCollection>
        <!--        <Macro Key="CalculateQty" Description="计算并设置总通知量和总收货量">
            <![CDATA[
				var total = 0.0;
				var recvqty = 0.0; 
				
				var count = GetRowCount('list');
				var i = 0;
				while(i < count){
					total = total + GetCellValue('list',i,'Qty');
					recvqty = recvqty + GetCellValue('list',i,'CheckQty');
					i = i + 1;							
				}
				SetValue('NoticeQty_code',total);
				SetValue('RecvQty_Null_code',recvqty);
			]]>
        </Macro> -->
        <Macro Key="CheckMaterial" Description="根据扫入的物料条码定位对应的物料">
            <![CDATA[
				if(Material_code<>''){
					var focusRowIndex=GetFocusRow('list');
					var flag=false;
					var count = GetRowCount('list',false);
					var i=0;
					var j=0;
					while(i<count){
						if(GetCellValue('list', i,'Materialcode')==Material_code ){
							SetFocusRow('list',i);
							SetRowIndex('list',i);
							ScrollTo('list',i);
							flag=true;
							break;
								}
								i=i+1;							
					          }
					if(flag==false){
						ShowToast("待上架明细中找不到该条码物料。");
					  }
				}
				SetFocus('Material_code');
			]]>
        </Macro>
    </MacroCollection>
    <FormParaCollection>
        <FormPara Formula="Para('OID')" Key="OID" Type="Formula"/>
    </FormParaCollection>
</Form>
