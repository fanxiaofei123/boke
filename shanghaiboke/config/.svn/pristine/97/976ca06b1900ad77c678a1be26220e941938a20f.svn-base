<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="CHCS_Verdor_Contract_Supplemen" Caption="合同信息补充" FormType="Entity" ViewKey="CHCS_Verdor_Contract_SupplemenView">
    <DataSource RefObjectKey="CHCS_Verdor_Contract_Supplement"/>
    <OperationCollection>
        <Operation Key="WORKITEM" Caption="WORKITEM" Tag="WORKITEM"/>
        <Operation Key="BPM" Caption="BPM" Tag="BPM"/>
        <Operation Key="Save" Caption="保存" Visible="!ReadOnly()">
            <Action>
                <![CDATA[var i = 0;
var rowCount = GetRowCount("Grid1");
while(i<rowCount-1){
    var price = GetCellValue("Grid1", i, "Unit_Price");
    var startTime = GetCellValue("Grid1", i, "Valid_Time_Start");
    var endTime = GetCellValue("Grid1", i, "Valid_Time_End");
    var contractOID = GetCellValue("Grid1", i, "Origin_OID");
    DBNamedUpdate("updateContract",price,startTime,endTime,contractOID);
    i = i + 1;
}
SaveData(); UpdateView();]]>
            </Action>
        </Operation>
        <Operation Key="New" Caption="新增" Visible="ReadOnly()">
            <Action>
                <![CDATA[New('CHCS_Verdor_Contract_Supplemen', 'self');]]>
            </Action>
        </Operation>
        <Operation Key="Delete" Caption="删除" Visible="ReadOnly()">
            <Action>
                <![CDATA[DeleteData();UpdateView();Close();]]>
            </Action>
        </Operation>
        <Operation Key="Edit" Caption="编辑" Visible="ReadOnly()">
            <Action>
                <![CDATA[Edit();]]>
            </Action>
        </Operation>
        <Operation Key="Cancel" Caption="取消" Visible="!ReadOnly()">
            <Action>
                <![CDATA[Cancel();]]>
            </Action>
        </Operation>
        <Operation Key="ImportContract" Caption="引入供应商合同">
            <Action>
                <![CDATA[ShowModal("CHCS_ImportContract",{pFormKey:{GetFormKey()}});]]>
            </Action>
        </Operation>
    </OperationCollection>
    <ScriptCollection>
        <Script Key="Load" Caption="载入" Range="Action" Verb="Load">
            <![CDATA[LoadData();]]>
        </Script>
    </ScriptCollection>
    <QueryCollection>
        <Query Key="queryOID" Description="查询OID作为条件传给引入的界面">
            <Statement DBType="MySql">
                <![CDATA[select OID from CHCS_Verdor_Contract_Supplement where ]]>
            </Statement>
        </Query>
        <Query Key="updateContract" Description="更新合同信息">
            <Statement DBType="MySql">
                <![CDATA[update CHCS_Contract_Price set Unit_Price = ?, Valid_Time_Start = ?, Valid_Time_End = ? where oid = ?]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Numeric"/>
                <Parameter DataType="Date"/>
                <Parameter DataType="Date"/>
                <Parameter DataType="Long"/>
            </ParameterCollection>
        </Query>
    </QueryCollection>
    <Body>
        <Block>
            <FlexFlowLayoutPanel Key="root" Caption="根面板">
                <ToolBar Key="ToolBar1" Height="pref" Caption="ToolBar1">
                    <ToolBarItemCollection/>
                </ToolBar>
                <SplitPanel Key="main" Orientation="Vertical" Height="100%" Caption="主面板">
                    <TabPanel Caption="TabPanel1" Height="pref" Key="TabPanel1">
                        <GridLayoutPanel Key="Basic_Info" Height="pref" Padding="5px" OverflowY="Scroll" Caption="基本信息">
                            <TextEditor Key="Business_Unit" Caption="业务单元" BuddyKey="Lab_Business_Unit" X="9" Y="3" AsQuery="true" XSpan="2">
                                <DataBinding ColumnKey="Business_Unit" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </TextEditor>
                            <Label Key="Lab_Business_Unit" Caption="业务单元" X="8" Y="3"/>
                            <TextEditor Key="Contract_Name" Caption="合同名称" BuddyKey="Lab_Contract_Name" X="5" Y="1" AsQuery="true" XSpan="2">
                                <DataBinding ColumnKey="Contract_Name" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </TextEditor>
                            <Label Key="Lab_Contract_Name" Caption="合同名称" X="4" Y="1"/>
                            <TextEditor Key="Principal_Contract_Code" Caption="主合同编号" BuddyKey="Lab_Principal_Contract_Code" X="9" Y="2" AsQuery="true" XSpan="2">
                                <DataBinding ColumnKey="Principal_Contract_Code" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </TextEditor>
                            <Label Key="Lab_Principal_Contract_Code" Caption="主合同编号" X="8" Y="2"/>
                            <TextEditor Key="Contract_Code" Caption="合同编号" BuddyKey="Lab_Contract_Code" X="1" Y="1" AsQuery="true" XSpan="2">
                                <DataBinding ColumnKey="Contract_Code" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </TextEditor>
                            <Label Key="Lab_Contract_Code" Caption="合同编号" X="0" Y="1"/>
                            <TextEditor Key="Contract_Unit" Caption="签约单位" BuddyKey="Lab_Contract_Unit" X="1" Y="4" AsQuery="true" XSpan="2">
                                <DataBinding ColumnKey="Contract_Unit" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </TextEditor>
                            <Label Key="Lab_Contract_Unit" Caption="签约单位" X="0" Y="4"/>
                            <TextEditor Key="Contract_Classify" Caption="合同分类" BuddyKey="Lab_Contract_Classify" X="9" Y="1" AsQuery="true" XSpan="2">
                                <DataBinding ColumnKey="Contract_Classify" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </TextEditor>
                            <Label Key="Lab_Contract_Classify" Caption="合同分类" X="8" Y="1"/>
                            <TextEditor Key="Supplier_NO" Caption="供应商编号" BuddyKey="Lab_Supplier_NO" X="1" Y="2" AsQuery="true" XSpan="2">
                                <DataBinding ColumnKey="Supplier_NO" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </TextEditor>
                            <Label Key="Lab_Supplier_NO" Caption="供应商编号" X="0" Y="2"/>
                            <TextEditor Key="Supplier_Abbr" Caption="供应商简称" BuddyKey="Lab_Supplier_Abbr" X="5" Y="2" XSpan="2">
                                <DataBinding ColumnKey="Supplier_Abbr" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </TextEditor>
                            <Label Key="Lab_Supplier_Abbr" Caption="供应商简称" X="4" Y="2"/>
                            <DatePicker Key="Valid_Time_Start_H" Caption="有效期起" BuddyKey="Lab_Valid_Time_Start_H" X="1" Y="3" OnlyDate="true" AsQuery="true" XSpan="2">
                                <DataBinding ColumnKey="Valid_Time_Start" TableKey="CHCS_Verdor_Contract_Supplement"/>
                                <Format/>
                            </DatePicker>
                            <Label Key="Lab_Valid_Time_Start_H" Caption="有效期起" X="0" Y="3"/>
                            <DatePicker Key="Valid_Time_End_H" Caption="有效期止" BuddyKey="Lab_Valid_Time_End_H" X="5" Y="3" OnlyDate="true" AsQuery="true" XSpan="2">
                                <DataBinding ColumnKey="Valid_Time_End" TableKey="CHCS_Verdor_Contract_Supplement"/>
                                <Format/>
                            </DatePicker>
                            <Label Key="Lab_Valid_Time_End_H" Caption="有效期止" X="4" Y="3"/>
                            <TextEditor Key="NO" Caption="单据编号" BuddyKey="Lab_NO" X="1" Y="0" Enable="false" EmbedTextColor="" XSpan="2" AsQuery="true">
                                <DataBinding ColumnKey="NO" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </TextEditor>
                            <Label Key="Lab_NO" Caption="单据编号" X="0" Y="0"/>
                            <DatePicker Key="BillDate" Caption="单据日期" BuddyKey="Lab_BillDate" X="5" Y="0" Enable="false" XSpan="2" AsQuery="true">
                                <DataBinding ColumnKey="BillDate" TableKey="CHCS_Verdor_Contract_Supplement"/>
                                <Format/>
                            </DatePicker>
                            <Label Key="Lab_BillDate" Caption="单据日期" X="4" Y="0"/>
                            <ComboBox Key="Status" Caption="状态" BuddyKey="Lab_Status" X="9" Y="0" SourceType="Status" Enable="false" XSpan="2" AsQuery="true">
                                <DataBinding ColumnKey="Status" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </ComboBox>
                            <Label Key="Lab_Status" Caption="状态" X="8" Y="0"/>
                            <RowDefCollection RowHeight="30" RowGap="6">
                                <RowDef/>
                                <RowDef/>
                                <RowDef/>
                                <RowDef/>
                                <RowDef/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="20">
                                <ColumnDef Width="70px"/>
                                <ColumnDef Width="80px"/>
                                <ColumnDef Width="33%" MinWidth="50px"/>
                                <ColumnDef Width="30px"/>
                                <ColumnDef Width="70px"/>
                                <ColumnDef Width="80px"/>
                                <ColumnDef Width="33%" MinWidth="50px"/>
                                <ColumnDef Width="30px"/>
                                <ColumnDef Width="60px"/>
                                <ColumnDef Width="80px"/>
                                <ColumnDef Width="33%" MinWidth="50px"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                        <GridLayoutPanel Key="Sys_Info" Height="pref" Padding="5px" Caption="系统信息">
                            <Dict Key="CREATOR" Caption="创建人" BuddyKey="Lab_CREATOR" X="1" Y="0" ItemKey="Operator">
                                <DataBinding ColumnKey="CREATOR" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </Dict>
                            <Label Key="Lab_CREATOR" Caption="创建人" X="0" Y="0"/>
                            <DatePicker Key="CREATETIME" Caption="创建时间" BuddyKey="Lab_CREATETIME" X="3" Y="0">
                                <DataBinding ColumnKey="CREATETIME" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </DatePicker>
                            <Label Key="Lab_CREATETIME" Caption="创建时间" X="2" Y="0"/>
                            <Dict Key="MODIFIER" Caption="修改人" BuddyKey="Lab_MODIFIER" X="1" Y="1" ItemKey="Operator">
                                <DataBinding ColumnKey="MODIFIER" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </Dict>
                            <Label Key="Lab_MODIFIER" Caption="修改人" X="0" Y="1"/>
                            <DatePicker Key="MODIFYTIME" Caption="修改时间" BuddyKey="Lab_MODIFYTIME" X="3" Y="1">
                                <DataBinding ColumnKey="MODIFYTIME" TableKey="CHCS_Verdor_Contract_Supplement"/>
                            </DatePicker>
                            <Label Key="Lab_MODIFYTIME" Caption="修改时间" X="2" Y="1"/>
                            <RowDefCollection RowHeight="30" RowGap="6">
                                <RowDef/>
                                <RowDef/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="20">
                                <ColumnDef Width="60px"/>
                                <ColumnDef Width="50%"/>
                                <ColumnDef Width="60px"/>
                                <ColumnDef Width="50%"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                    </TabPanel>
                    <Grid Key="Grid1" Caption="Grid1" Option="">
                        <GridColumnCollection>
                            <GridColumn Key="select1" Caption="选择" Width="80px"/>
                            <GridColumn Key="Origin_OID" Caption="对象标识" Visible="false" Width="80px"/>
                            <GridColumn Key="Product" Caption="餐种" Width="80px"/>
                            <GridColumn Key="Origin_Unit_Price" Caption="原合同单价" Width="80px"/>
                            <GridColumn Key="Origin_Valid_Time_Start" Caption="原有效期起" Width="80px"/>
                            <GridColumn Key="Origin_Valid_Time_End" Caption="原有效期止" Width="80px"/>
                            <GridColumn Key="Unit_Price" Caption="单价" Width="80px"/>
                            <GridColumn Key="Valid_Time_Start" Caption="有效期起" Width="80px"/>
                            <GridColumn Key="Valid_Time_End" Caption="有效期止" Width="80px"/>
                        </GridColumnCollection>
                        <GridRowCollection>
                            <GridRow Key="row1" RowHeight="36" TableKey="CHCS_Contract_Price_Maintain">
                                <GridCell Key="select1" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                <GridCell Key="Origin_OID" Caption="对象标识" CellType="NumberEditor" Format="">
                                    <DataBinding ColumnKey="Origin_OID"/>
                                </GridCell>
                                <GridCell Key="Product" Caption="餐种" CellType="Dict" ItemKey="CHCS_Product">
                                    <DataBinding ColumnKey="Product"/>
                                </GridCell>
                                <GridCell Key="Origin_Unit_Price" Caption="原合同单价" CellType="NumberEditor" Format="">
                                    <DataBinding ColumnKey="Origin_Unit_Price"/>
                                </GridCell>
                                <GridCell Key="Origin_Valid_Time_Start" Caption="原有效期起" CellType="DatePicker" OnlyDate="true" Format="yyyy-MM-dd">
                                    <DataBinding ColumnKey="Origin_Valid_Time_Start"/>
                                </GridCell>
                                <GridCell Key="Origin_Valid_Time_End" Caption="原有效期止" CellType="DatePicker" OnlyDate="true" Format="yyyy-MM-dd">
                                    <DataBinding ColumnKey="Origin_Valid_Time_End"/>
                                </GridCell>
                                <GridCell Key="Unit_Price" Caption="单价" CellType="NumberEditor" Format="">
                                    <DataBinding ColumnKey="Unit_Price"/>
                                </GridCell>
                                <GridCell Key="Valid_Time_Start" Caption="有效期起" CellType="DatePicker" OnlyDate="true">
                                    <DataBinding ColumnKey="Valid_Time_Start"/>
                                </GridCell>
                                <GridCell Key="Valid_Time_End" Caption="有效期止" CellType="DatePicker" OnlyDate="true">
                                    <DataBinding ColumnKey="Valid_Time_End"/>
                                </GridCell>
                                <UICheckRuleCollection>
                                    <UICheckRule ErrorInfo="餐种不能重复">
                                        <![CDATA[!CheckDuplicate("Product");]]>
                                    </UICheckRule>
                                </UICheckRuleCollection>
                            </GridRow>
                        </GridRowCollection>
                    </Grid>
                    <SubDetail BindingGridKey="Grid1" Caption="SubDetail1" Key="SubDetail1">
                        <Grid Key="Grid2" Caption="Grid2">
                            <GridColumnCollection>
                                <GridColumn Key="column1" Caption="选择" Width="80px"/>
                                <GridColumn Key="Product_L" Caption="餐种" Width="80px" Enable="false"/>
                                <GridColumn Key="Single_Type" Caption="单品类型" Width="80px"/>
                                <GridColumn Key="Origin_Unit_Price_L" Caption="原合同单价" Width="80px"/>
                                <GridColumn Key="Origin_Valid_Time_Start_L" Caption="原有效期起" Width="80px"/>
                                <GridColumn Key="Origin_Valid_Time_End_L" Caption="原有效期止" Width="80px"/>
                                <GridColumn Key="Unit_Price_L" Caption="单价" Width="80px"/>
                                <GridColumn Key="Valid_Time_Start_L" Caption="有效期起" Width="80px"/>
                                <GridColumn Key="Valid_Time_End_L" Caption="有效期止" Width="80px"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="row1" RowHeight="36" TableKey="CHCS_Single_Price_Maintain">
                                    <GridCell Key="select" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                    <GridCell Key="Product_L" Caption="餐种" CellType="Dict" ItemKey="CHCS_Product">
                                        <DataBinding ColumnKey="Product" DefaultFormulaValue="SetCellValue(&quot;Grid2&quot;, 0, &quot;Product_L&quot;, GetCellValue(&quot;Grid1&quot;, GetFocusRow(&quot;Grid1&quot;), &quot;Product&quot;)); if(GetRowCount(&quot;Grid2&quot;)==1){     SetCellValue(&quot;Grid2&quot;, 0, &quot;Product_L&quot;, GetCellValue(&quot;Grid1&quot;, GetFocusRow(&quot;Grid1&quot;), &quot;Product&quot;)); } var grid2RowCount = GetRowCount(&quot;Grid2&quot;); if(grid2RowCount&gt;1){     var i = 1;     while(i&lt;grid2RowCount-1){         SetCellValue(&quot;Grid2&quot;, i, &quot;Product_L&quot;, GetCellValue(&quot;Grid1&quot;, GetFocusRow(&quot;Grid1&quot;), &quot;Product&quot;));         i = i + 1;     } }" ValueDependency="Product"/>
                                    </GridCell>
                                    <GridCell Key="Single_Type" Caption="单品类型" CellType="TextEditor">
                                        <DataBinding ColumnKey="Single_Type"/>
                                    </GridCell>
                                    <GridCell Key="Origin_Unit_Price_L" Caption="原合同单价" CellType="NumberEditor" Format="">
                                        <DataBinding ColumnKey="Origin_Unit_Price"/>
                                    </GridCell>
                                    <GridCell Key="Origin_Valid_Time_Start_L" Caption="原有效期起" CellType="DatePicker" OnlyDate="true" Format="yyyy-MM-dd">
                                        <DataBinding ColumnKey="Origin_Valid_Time_Start"/>
                                    </GridCell>
                                    <GridCell Key="Origin_Valid_Time_End_L" Caption="原有效期止" CellType="DatePicker" OnlyDate="true" Format="yyyy-MM-dd">
                                        <DataBinding ColumnKey="Origin_Valid_Time_End"/>
                                    </GridCell>
                                    <GridCell Key="Unit_Price_L" Caption="单价" CellType="NumberEditor" Format="">
                                        <DataBinding ColumnKey="Unit_Price"/>
                                    </GridCell>
                                    <GridCell Key="Valid_Time_Start_L" Caption="有效期起" CellType="DatePicker">
                                        <DataBinding ColumnKey="Valid_Time_Start"/>
                                    </GridCell>
                                    <GridCell Key="Valid_Time_End_L" Caption="有效期止" CellType="DatePicker">
                                        <DataBinding ColumnKey="Valid_Time_End"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                        </Grid>
                    </SubDetail>
                    <SplitSize Size="34%"/>
                    <SplitSize Size="33%"/>
                    <SplitSize Size="33%"/>
                </SplitPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
</Form>
