<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="V_O_ExpenseTerm_LRP" Caption="其它费用条款" FormType="Entity" ViewKey="V_O_ExpenseTerm_LRPView">
    <DataSource RefObjectKey="LRP_O_ExpenseTerm"/>
    <OperationCollection>
        <Operation Key="New" Caption="新增" Visible="ReadOnly()">
            <Action>
                <![CDATA[New('V_O_ExpenseTerm_LRP', 'self');]]>
            </Action>
        </Operation>
        <Operation Key="CopyNew" Caption="复制新增" Visible="ReadOnly()" RefKey="CopyNew" ShortCuts="Ctrl+E"/>
        <Operation Key="Save" Caption="保存" Visible="!ReadOnly()&amp;&amp;Status==100" ShortCuts="Ctrl+S">
            <Action>
                <![CDATA[
                        if(ConditionSql_Save()){
                         SaveData(); UpdateView();
						 }
						 ]]>
            </Action>
        </Operation>
        <Operation Key="Edit" Caption="编辑" Visible="ReadOnly()" RefKey="Edit" ShortCuts="Ctrl+E"/>
        <Operation Key="Cancel" Caption="取消" Visible="!ReadOnly()" RefKey="Cancel"/>
        <Operation Key="Confirm" Caption="确认" Visible="ReadOnly()" RefKey="Confirm"/>
        <Operation Key="Confirm-R" Caption="撤销确认" Visible="ReadOnly();" RefKey="Confirm-R"/>
        <Operation Key="ToCancel" Caption="作废" Visible="ReadOnly()" RefKey="ToCancel"/>
        <Operation Key="ToCancel-R" Caption="撤销作废" Visible="ReadOnly()" RefKey="ToCancel-R"/>
        <Operation Key="Delete" Caption="删除" Visible="ReadOnly()" RefKey="Delete"/>
        <Operation Key="Close" Caption="关闭" Visible="ReadOnly()" RefKey="Close"/>
    </OperationCollection>
    <ScriptCollection>
        <Script Key="Load" Caption="载入" Range="Action" Verb="Load">
            <![CDATA[LoadData();]]>
        </Script>
    </ScriptCollection>
    <Body>
        <Block>
            <SplitPanel Key="main" Orientation="Vertical" Height="100%" Caption="主面板">
                <FlexFlowLayoutPanel Key="root" Caption="根面板">
                    <ToolBar Key="main_toolbar" Height="pref">
                        <ToolBarItemCollection/>
                    </ToolBar>
                    <TabPanel Caption="TabPanel1" Key="TabPanel1" Height="pref">
                        <GridLayoutPanel Key="BasicTab" Padding="10px" Caption="基本信息" BottomPadding="5px">
                            <TextEditor Key="No" Caption="条款号" BuddyKey="Lab_No" X="1" Y="0" Enable="false">
                                <DataBinding ColumnKey="No" TableKey="LRP_O_ExpenseTerm_H"/>
                            </TextEditor>
                            <Label Key="Lab_No" Caption="条款号" X="0" Y="0"/>
                            <TextEditor Key="Name" Caption="条款名称" BuddyKey="Lab_Name" X="4" Y="0">
                                <DataBinding ColumnKey="Name" TableKey="LRP_O_ExpenseTerm_H" Required="true"/>
                            </TextEditor>
                            <Label Key="Lab_Name" Caption="条款名称" X="3" Y="0"/>
                            <Dict Key="ExpenseId" Caption="费用名称" BuddyKey="Lab_ExpenseId" X="7" Y="0" ItemKey="LRP_Expense" XSpan="3">
                                <DataBinding ColumnKey="ExpenseId" TableKey="LRP_O_ExpenseTerm_H" Required="true"/>
                            </Dict>
                            <Label Key="Lab_ExpenseId" Caption="费用名称" X="6" Y="0"/>
                            <ComboBox Key="DataObjectKey" Caption="数据对象" BuddyKey="Lab_DataObjectKey" X="1" Y="1" SourceType="Formula">
                                <DataBinding ColumnKey="DataObjectKey" TableKey="LRP_O_ExpenseTerm_H" Required="true">
                                    <ValueChanged>
                                        <![CDATA[                   								        								            
										 WarehouseIdField = '';
										 DispatchOrgIdField = '';
										 CarrierIdField = '';
										 SettlementIdField = '';
										 NoField = '';
									     OrderDateField = '';
									     QtyField = '';	                 
				              ]]>
                                    </ValueChanged>
                                    <ValueChanging>
                                        <![CDATA[                   
								 Confirm(LocaleString('CHshow','chkey18'),'YES_NO',        
								 {YES: {             
								         CommitValue('DataObjectKey');             
								         ClearAllRows('Grid0'); 
										 ClearAllRows('Grid1');
										 ClearAllRows('Grid2');
										 WarehouseIdField = '';
										 DispatchOrgIdField = '';
										 CarrierIdField = '';
										 SettlementIdField = '';
										 NoField = '';
									     OrderDateField = '';
									     QtyField = '';
										 },         
								   NO: {
								        RollbackValue('DataObjectKey');}});       
				              ]]>
                                    </ValueChanging>
                                    <ValueValidation>
                                        <![CDATA[GetRowCount('Grid0')<=1 && GetRowCount('Grid1')<=1 && GetRowCount('Grid2')<=1]]>
                                    </ValueValidation>
                                </DataBinding>
                                <FormulaItems>
                                    <![CDATA[InvokeService("LRP_GetDataObjectKey", true, false);]]>
                                </FormulaItems>
                            </ComboBox>
                            <Label Key="Lab_DataObjectKey" Caption="数据对象" X="0" Y="1"/>
                            <ComboBox Key="WarehouseIdField" Caption="仓储中心字段" BuddyKey="Lab_WarehouseIdField" SourceType="Formula" X="4" Y="1" ItemsDependency="DataObjectKey">
                                <DataBinding ColumnKey="WarehouseIdField" TableKey="LRP_O_ExpenseTerm_H"/>
                                <FormulaItems>
                                    <![CDATA[InvokeService("LRP_GetFieldKey", false, false,GetValue("DataObjectKey"),"Long");]]>
                                </FormulaItems>
                            </ComboBox>
                            <Label Key="Lab_WarehouseIdField" Caption="仓储中心字段" X="3" Y="1"/>
                            <ComboBox Key="DispatchOrgIdField" Caption="调度组织字段" BuddyKey="Lab_DispatchOrgIdField" SourceType="Formula" X="7" Y="1" XSpan="3" ItemsDependency="DataObjectKey">
                                <DataBinding ColumnKey="DispatchOrgIdField" TableKey="LRP_O_ExpenseTerm_H"/>
                                <FormulaItems>
                                    <![CDATA[InvokeService("LRP_GetFieldKey", false, false,GetValue("DataObjectKey"),"Long");]]>
                                </FormulaItems>
                            </ComboBox>
                            <Label Key="Lab_DispatchOrgIdField" Caption="调度组织字段" X="6" Y="1"/>
                            <ComboBox Key="CarrierIdField" Caption="承运商字段" BuddyKey="Lab_CarrierIdField" SourceType="Formula" X="1" Y="2" ItemsDependency="DataObjectKey">
                                <DataBinding ColumnKey="CarrierIdField" TableKey="LRP_O_ExpenseTerm_H"/>
                                <FormulaItems>
                                    <![CDATA[InvokeService("LRP_GetFieldKey", false, false,GetValue("DataObjectKey"),"Long");]]>
                                </FormulaItems>
                            </ComboBox>
                            <Label Key="Lab_CarrierIdField" Caption="承运商字段" X="0" Y="2"/>
                            <ComboBox Key="SettlementIdField" Caption="结算方字段" BuddyKey="Lab_SettlementIdField" SourceType="Formula" X="4" Y="2" ItemsDependency="DataObjectKey">
                                <DataBinding ColumnKey="SettlementIdField" TableKey="LRP_O_ExpenseTerm_H"/>
                                <FormulaItems>
                                    <![CDATA[InvokeService("LRP_GetFieldKey", false, false,GetValue("DataObjectKey"),"Long");]]>
                                </FormulaItems>
                            </ComboBox>
                            <Label Key="Lab_SettlementIdField" Caption="结算方字段" X="3" Y="2"/>
                            <ComboBox Key="NoField" Caption="唯一单号字段" BuddyKey="Lab_NoField" SourceType="Formula" X="7" Y="2" XSpan="3" ItemsDependency="DataObjectKey">
                                <DataBinding ColumnKey="NoField" TableKey="LRP_O_ExpenseTerm_H" Required="true"/>
                                <FormulaItems>
                                    <![CDATA[InvokeService("LRP_GetFieldKey", false, false,GetValue("DataObjectKey"),"String");]]>
                                </FormulaItems>
                            </ComboBox>
                            <Label Key="Lab_NoField" Caption="唯一单号字段" X="6" Y="2"/>
                            <ComboBox Key="OrderDateField" Caption="业务日期字段" BuddyKey="Lab_OrderDateField" SourceType="Formula" X="1" Y="3" ItemsDependency="DataObjectKey">
                                <DataBinding ColumnKey="OrderDateField" TableKey="LRP_O_ExpenseTerm_H" Required="true"/>
                                <FormulaItems>
                                    <![CDATA[InvokeService("LRP_GetFieldKey", false, false,GetValue("DataObjectKey"),"Datetime");]]>
                                </FormulaItems>
                            </ComboBox>
                            <Label Key="Lab_OrderDateField" Caption="业务日期字段" X="0" Y="3"/>
                            <ComboBox Key="QtyField" Caption="业务量字段" BuddyKey="Lab_QtyField" SourceType="Formula" X="4" Y="3" ItemsDependency="DataObjectKey">
                                <DataBinding ColumnKey="QtyField" TableKey="LRP_O_ExpenseTerm_H" Required="true"/>
                                <FormulaItems>
                                    <![CDATA[InvokeService("LRP_GetFieldKey", false, false,GetValue("DataObjectKey"),"Numeric");]]>
                                </FormulaItems>
                            </ComboBox>
                            <Label Key="Lab_QtyField" Caption="业务量字段" X="3" Y="3"/>
                            <CheckBox Key="NeedSummaryApportion" Caption="汇总分摊" BuddyKey="Lab_NeedSummaryApportion" X="7" Y="3">
                                <DataBinding ColumnKey="NeedSummaryApportion" TableKey="LRP_O_ExpenseTerm_H">
                                    <ValueChanged>
                                        <![CDATA[  
										         if(NeedSummaryApportion==0){
												        ApportionType='';
												        ClearAllRows('Grid2');
												 }
								      
				                                ]]>
                                    </ValueChanged>
                                </DataBinding>
                            </CheckBox>
                            <ComboBox Key="ApportionType" Caption="分摊方式" BuddyKey="Lab_ApportionType" Enable="NeedSummaryApportion==1" X="9" Y="3">
                                <DataBinding ColumnKey="ApportionType" TableKey="LRP_O_ExpenseTerm_H"/>
                                <Item Caption="按业务量分摊" Key="qty" Value="qty"/>
                                <Item Caption="按单据数分摊" Key="count" Value="count"/>
                            </ComboBox>
                            <Label Key="Lab_ApportionType" Caption="分摊方式" X="8" Y="3"/>
                            <TextEditor Key="Remark" Caption="备注" BuddyKey="Lab_Remark" X="1" Y="4" XSpan="4">
                                <DataBinding ColumnKey="Remark" TableKey="LRP_O_ExpenseTerm_H"/>
                            </TextEditor>
                            <Label Key="Lab_Remark" Caption="备注" X="0" Y="4"/>
                            <ComboBox Key="Status" Caption="状态" BuddyKey="Lab_Status" X="7" Y="4" SourceType="Status" Enable="false" XSpan="3">
                                <DataBinding ColumnKey="Status" TableKey="LRP_O_ExpenseTerm_H" DefaultValue="100"/>
                            </ComboBox>
                            <Label Key="Lab_Status" Caption="状态" X="6" Y="4"/>
                            <TextEditor Key="ConditionSql" Caption="条件SQL" BuddyKey="Lab_ConditionSql" Enable="false" X="1" Y="5" XSpan="9">
                                <DataBinding ColumnKey="ConditionSql" TableKey="LRP_O_ExpenseTerm_H"/>
                            </TextEditor>
                            <Label Key="Lab_ConditionSql" Caption="条件SQL" X="0" Y="5"/>
                            <ComboBox Key="cmb_amounttype" Caption="计算价格模式" BuddyKey="Lab_cmb_amounttype" X="1" Y="6">
                                <DataBinding ColumnKey="amounttype" TableKey="LRP_O_ExpenseTerm_H" DefaultValue="10">
                                    <ValueChanged>
                                        <![CDATA[if(GetValue('cmb_amounttype')==10){SetValue('pricefield', '');SetValue('customprice', '');SetValue('amountfield', '');SetValue('customamount', '');}
if(GetValue('cmb_amounttype')==20){SetValue('amountfield', '');SetValue('customamount', '');}
if(GetValue('cmb_amounttype')==30){SetValue('pricefield', '');SetValue('customprice', '');}]]>
                                    </ValueChanged>
                                </DataBinding>
                                <Item Caption="默认" Key="10" Value="10"/>
                                <Item Caption="单价" Key="20" Value="20"/>
                                <Item Caption="金额" Key="30" Value="30"/>
                            </ComboBox>
                            <Label Key="Lab_cmb_amounttype" Caption="计算价格模式" X="0" Y="6"/>
                            <ComboBox Key="pricefield" Caption="单价字段" BuddyKey="Lab_pricefield" X="4" Y="6" Enable="GetValue('cmb_amounttype')==20  &amp;&amp; !ReadOnly()" SourceType="Formula" EnableDependency="cmb_amounttype" ItemsDependency="DataObjectKey">
                                <DataBinding ColumnKey="pricefield" TableKey="LRP_O_ExpenseTerm_H"/>
                                <FormulaItems>
                                    <![CDATA[InvokeService("LRP_GetFieldKey", false, false,GetValue("DataObjectKey"),"Numeric");]]>
                                </FormulaItems>
                            </ComboBox>
                            <Label Key="Lab_pricefield" Caption="单价字段" X="3" Y="6"/>
                            <TextEditor Key="customprice" Caption="自定义单价" BuddyKey="Lab_customprice" X="7" Y="6" Enable="GetValue('cmb_amounttype')==20 &amp;&amp; !ReadOnly()" XSpan="3" EnableDependency="cmb_amounttype">
                                <DataBinding ColumnKey="customprice" TableKey="LRP_O_ExpenseTerm_H"/>
                            </TextEditor>
                            <Label Key="Lab_customprice" Caption="自定义单价" X="6" Y="6"/>
                            <ComboBox Key="amountfield" Caption="金额字段" BuddyKey="Lab_amountfield" X="4" Y="7" Enable="GetValue('cmb_amounttype')==30 &amp;&amp; !ReadOnly()" SourceType="Formula" EnableDependency="cmb_amounttype" ItemsDependency="DataObjectKey">
                                <DataBinding ColumnKey="amountfield" TableKey="LRP_O_ExpenseTerm_H"/>
                                <FormulaItems>
                                    <![CDATA[InvokeService("LRP_GetFieldKey", false, false,GetValue("DataObjectKey"),"Numeric");]]>
                                </FormulaItems>
                            </ComboBox>
                            <Label Key="Lab_amountfield" Caption="金额字段" X="3" Y="7"/>
                            <TextEditor Key="customamount" Caption="自定义金额" BuddyKey="Lab_customamount" X="7" Y="7" Enable="GetValue('cmb_amounttype')==30 &amp;&amp; !ReadOnly()" XSpan="3" EnableDependency="cmb_amounttype">
                                <DataBinding ColumnKey="customamount" TableKey="LRP_O_ExpenseTerm_H"/>
                            </TextEditor>
                            <Label Key="Lab_customamount" Caption="自定义金额" X="6" Y="7"/>
                            <RowDefCollection RowGap="5">
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="5">
                                <ColumnDef Width="77px"/>
                                <ColumnDef Width="34%" MinWidth="55px"/>
                                <ColumnDef Width="20px"/>
                                <ColumnDef Width="77px"/>
                                <ColumnDef Width="34%" MinWidth="55px"/>
                                <ColumnDef Width="20px"/>
                                <ColumnDef Width="77px"/>
                                <ColumnDef Width="15%" MinWidth="55px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="15%" MinWidth="55px"/>
                                <ColumnDef Width="10px"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                        <GridLayoutPanel Key="SystemInfo" Padding="10px" Caption="系统信息">
                            <Dict Key="CREATOR" Caption="创建人" BuddyKey="Lab_CREATOR" X="1" Y="0" Enable="false" ItemKey="Operator">
                                <DataBinding ColumnKey="CREATOR" DefaultFormulaValue="GetOperator()" TableKey="LRP_O_ExpenseTerm_H"/>
                            </Dict>
                            <Label Key="Lab_CREATOR" Caption="创建人" X="0" Y="0"/>
                            <DatePicker Key="CREATETIME" Caption="创建时间" BuddyKey="Lab_CREATETIME" X="4" Y="0" Enable="false">
                                <DataBinding ColumnKey="CREATETIME" DefaultFormulaValue="ServerDate()" TableKey="LRP_O_ExpenseTerm_H"/>
                            </DatePicker>
                            <Label Key="Lab_CREATETIME" Caption="创建时间" X="3" Y="0"/>
                            <Dict Key="MODIFIER" Caption="修改人" BuddyKey="Lab_MODIFIER" X="1" Y="1" Enable="false" ItemKey="Operator">
                                <DataBinding ColumnKey="MODIFIER" DefaultFormulaValue="GetOperator()" TableKey="LRP_O_ExpenseTerm_H"/>
                            </Dict>
                            <Label Key="Lab_MODIFIER" Caption="修改人" X="0" Y="1"/>
                            <DatePicker Key="MODIFYTIME" Caption="修改时间" BuddyKey="Lab_MODIFYTIME" X="4" Y="1" Enable="false">
                                <DataBinding ColumnKey="MODIFYTIME" DefaultFormulaValue="ServerDate()" TableKey="LRP_O_ExpenseTerm_H"/>
                            </DatePicker>
                            <Label Key="Lab_MODIFYTIME" Caption="修改时间" X="3" Y="1"/>
                            <RowDefCollection RowGap="5">
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="5">
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="33%"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="33%"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="33%"/>
                                <ColumnDef Width="55px"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                    </TabPanel>
                </FlexFlowLayoutPanel>
                <TabPanel Caption="TabPanel2" Key="TabPanel2">
                    <Grid Key="Grid0" Caption="条件明细">
                        <GridColumnCollection>
                            <GridColumn Key="column0" Caption="选择" Width="80px" Sortable="true"/>
                            <GridColumn Key="LeftBrackets" Caption="左括号" Width="80px" Sortable="true"/>
                            <GridColumn Key="ObjectAttribute" Caption="属性" Width="80px" Sortable="true"/>
                            <GridColumn Key="Operator" Caption="操作符" Width="80px" Sortable="true"/>
                            <GridColumn Key="Value" Caption="值" Width="80px" Sortable="true"/>
                            <GridColumn Key="RightBrackets" Caption="右括号" Width="80px" Sortable="true"/>
                            <GridColumn Key="LogicalOperator" Caption="逻辑运算符" Width="80px" Sortable="true"/>
                        </GridColumnCollection>
                        <GridRowCollection>
                            <GridRow Key="row1" RowHeight="35" TableKey="LRP_O_ExpenseTermCond_L">
                                <GridCell Key="select" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                <GridCell Key="LeftBrackets" Caption="左括号" CellType="ComboBox" Enable="!ReadOnly()">
                                    <DataBinding ColumnKey="LeftBrackets"/>
                                    <Item Caption="(" Key="ParenthesesLeft1" Value="("/>
                                    <Item Caption="((" Key="ParenthesesLeft2" Value="(("/>
                                    <Item Caption="(((" Key="ParenthesesLeft3" Value="((("/>
                                </GridCell>
                                <GridCell Key="ObjectAttribute" Caption="属性" CellType="ComboBox" SourceType="Formula" Enable="!ReadOnly()" ItemsDependency="DataObjectKey">
                                    <DataBinding ColumnKey="ObjectAttribute" Required="true"/>
                                    <FormulaItems>
                                        <![CDATA[InvokeService("LRP_GetFieldKey", false, false,GetValue("DataObjectKey"),"Head");]]>
                                    </FormulaItems>
                                </GridCell>
                                <GridCell Key="Operator" Caption="操作符" CellType="ComboBox" Enable="!ReadOnly()">
                                    <DataBinding ColumnKey="Operator" Required="true"/>
                                    <Item Caption="等于" Key="Option1" Value="="/>
                                    <Item Caption="不等于" Key="Option2" Value="&lt;&gt;"/>
                                    <Item Caption="大于" Key="Option3" Value="&gt;"/>
                                    <Item Caption="大于等于" Key="Option4" Value="&gt;="/>
                                    <Item Caption="小于" Key="Option5" Value="&lt;"/>
                                    <Item Caption="小于等于" Key="Option6" Value="&lt;="/>
                                    <Item Caption="包含" Key="Option7" Value="like"/>
                                </GridCell>
                                <GridCell Key="Value" Caption="值" CellType="TextEditor" Enable="!ReadOnly()">
                                    <DataBinding ColumnKey="Value" Required="true"/>
                                </GridCell>
                                <GridCell Key="RightBrackets" Caption="右括号" CellType="ComboBox" Enable="!ReadOnly()">
                                    <DataBinding ColumnKey="RightBrackets"/>
                                    <Item Caption=")" Key="ParenthesesRight1" Value=")"/>
                                    <Item Caption="))" Key="ParenthesesRight2" Value="))"/>
                                    <Item Caption=")))" Key="ParenthesesRight3" Value=")))"/>
                                </GridCell>
                                <GridCell Key="LogicalOperator" Caption="逻辑运算符" CellType="ComboBox" Enable="!ReadOnly()">
                                    <DataBinding ColumnKey="LogicalOperator"/>
                                    <Item Caption="并且" Key="And" Value="and"/>
                                    <Item Caption="或者" Key="Or" Value="or"/>
                                </GridCell>
                            </GridRow>
                        </GridRowCollection>
                    </Grid>
                    <Grid Key="Grid1" Caption="计费明细" Enable="!ReadOnly()">
                        <GridColumnCollection>
                            <GridColumn Key="column1" Caption="选择" Width="80px" Sortable="true"/>
                            <GridColumn Key="LowerNumber" Caption="下限" Width="94px" Sortable="true"/>
                            <GridColumn Key="UpperNumber" Caption="上限" Width="88px" Sortable="true"/>
                            <GridColumn Key="PriceType" Caption="单价/总价" Width="80px" Sortable="true"/>
                            <GridColumn Key="Price" Caption="价格" Width="84px" Sortable="true"/>
                            <GridColumn Key="AddPrice" Caption="附加金额" Width="111px" Sortable="true"/>
                            <GridColumn Key="MinPrice" Caption="最低金额" Width="97px" Sortable="true"/>
                            <GridColumn Key="MaxPrice" Caption="最高金额" Width="96px" Sortable="true"/>
                        </GridColumnCollection>
                        <GridRowCollection>
                            <GridRow Key="row2" RowHeight="35" TableKey="LRP_O_ExpenseTermCharge_L">
                                <GridCell Key="select1" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                <GridCell Key="LowerNumber" Caption="下限" CellType="NumberEditor" Precision="15" Scale="3" ShowZero="true">
                                    <DataBinding ColumnKey="LowerNumber">
                                        <ValueChanged>
                                            <![CDATA[//修改下限后更新上一行的上限
																	var i = GetFocusRow('Grid1');
																	if(GetRowIndex('Grid1')==i){
																		if (i <= 0) {
																			//第一行不做考虑
																			return 1;
																		} else {
																			var qty = GetCellValue('Grid1', -1, 'LowerNumber');
																			SetCellValue('Grid1', i - 1, 'UpperNumber', qty);
																		}
																	}]]>
                                        </ValueChanged>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="UpperNumber" Caption="上限" CellType="NumberEditor" Precision="15" Scale="3">
                                    <DataBinding ColumnKey="UpperNumber" Required="true">
                                        <ValueChanged>
                                            <![CDATA[//修改上限后更新下一行的上限
																var i = GetFocusRow('Grid1');
																var count = GetRowCount('Grid1', false);
																if(GetRowIndex('Grid1')==i){
																	if (i < count - 1) {    
																		var qty = GetCellValue('Grid1', -1, 'UpperNumber');  
																		SetCellValue('Grid1', i + 1, 'LowerNumber', qty);
																	}
																	if(i>0){
																		if(GetCellValue('Grid1', -1, 'LowerNumber')<>GetCellValue('Grid1', i-1, 'UpperNumber')){
																			SetCellValue('Grid1', -1, 'LowerNumber', GetCellValue('Grid1', i-1, 'UpperNumber'));
																		}
																	}
																}
																]]>
                                        </ValueChanged>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="PriceType" Caption="单价/总价" CellType="ComboBox">
                                    <DataBinding ColumnKey="PriceType" DefaultValue="1" Required="true"/>
                                    <Item Caption="单价" Key="1" Value="1"/>
                                    <Item Caption="总价" Key="2" Value="2"/>
                                    <Item Caption="单价（扣减下限）" Key="3" Value="3"/>
                                </GridCell>
                                <GridCell Key="Price" Caption="价格" CellType="NumberEditor" Precision="15" Scale="3" ShowZero="true">
                                    <DataBinding ColumnKey="Price"/>
                                </GridCell>
                                <GridCell Key="AddPrice" Caption="附加金额" CellType="NumberEditor" Precision="15" Scale="3">
                                    <DataBinding ColumnKey="AddPrice"/>
                                </GridCell>
                                <GridCell Key="MinPrice" Caption="最低金额" CellType="NumberEditor" Precision="15" Scale="3">
                                    <DataBinding ColumnKey="MinPrice"/>
                                </GridCell>
                                <GridCell Key="MaxPrice" Caption="最高金额" CellType="NumberEditor" Precision="15" Scale="3">
                                    <DataBinding ColumnKey="MaxPrice"/>
                                </GridCell>
                            </GridRow>
                        </GridRowCollection>
                    </Grid>
                    <Grid Key="Grid2" Caption="汇总明细" Enable="NeedSummaryApportion==1 &amp;&amp; !ReadOnly()">
                        <GridColumnCollection>
                            <GridColumn Key="column2" Caption="选择" Width="80px" Sortable="true"/>
                            <GridColumn Key="ObjectAttribute_L" Caption="属性" Width="80px" Sortable="true"/>
                        </GridColumnCollection>
                        <GridRowCollection>
                            <GridRow Key="row3" RowHeight="35" TableKey="LRP_O_ExpenseTermSum_L">
                                <GridCell Key="select2" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                <GridCell Key="ObjectAttribute_L" Caption="属性" SourceType="Formula" CellType="ComboBox" ItemsDependency="DataObjectKey">
                                    <DataBinding ColumnKey="ObjectAttribute"/>
                                    <FormulaItems>
                                        <![CDATA[InvokeService("LRP_GetFieldKey", false, false,GetValue("DataObjectKey"),"Head");]]>
                                    </FormulaItems>
                                </GridCell>
                            </GridRow>
                        </GridRowCollection>
                    </Grid>
                </TabPanel>
                <SplitSize Size="360px"/>
                <SplitSize Size="100%"/>
            </SplitPanel>
        </Block>
    </Body>
    <MacroCollection>
        <Macro Key="ConditionSql_Save">
            <![CDATA[
			      //条件匹配明细
					var sql=' ';
					var i=0;
					var count = GetRowCount('Grid0',false);
                       //遍历grid1
                    if(count>0){
						while ( i < count ) {
							//条件匹配明细保存时将明细的内容拼成Where子句放到头挡匹配条件SQL字段中
							if(GetCellValue('Grid0', i, 'LeftBrackets')!=''){
								sql=sql+GetCellValue('Grid0', i, 'LeftBrackets')+' ';
							}
							if(GetCellValue('Grid0', i, 'ObjectAttribute')!=''){
								sql=sql+GetCellValue('Grid0', i, 'ObjectAttribute')+' ';
							}
							if(GetCellValue('Grid0', i, 'Operator')+' '!=''){
								sql=sql+GetCellValue('Grid0', i, 'Operator')+' ';
							}
							if(GetCellValue('Grid0', i, 'Value')+' '!=''){
								sql=sql+"'"+ToString(GetCellValue('Grid0', i, 'Value'))+"' ";
							}
							if(GetCellValue('Grid0', i, 'RightBrackets')+' '!=''){
								sql=sql+GetCellValue('Grid0', i, 'RightBrackets')+' ';
							}
							if(GetCellValue('Grid0', i, 'LogicalOperator')+' '!=''){
								sql=sql+GetCellValue('Grid0', i, 'LogicalOperator')+' ';
							}
							//条件匹配明细保存若不是最后一行，则逻辑运算符不可为空
							 if(i==count-1){
									if(GetCellValue('Grid0', i, 'LogicalOperator')!='')
									{
										Confirm(LocaleString('CHshow','chkey25'),'OK','OK:{}'); 
										break;
									}
								else{
									   if(sql != ''){
											SetValue('ConditionSql', sql);
										    return true;
									   }
									 }
								}else{
									if(GetCellValue('Grid0', i, 'LogicalOperator')==''){
										Confirm(LocaleString('CHshow','chkey26'),'OK','OK:{}'); 
										break;
									}
								}
							   i=i+1;
							}
							}else{
								SetValue('ConditionSql', '');
								return true;
								}
					]]>
        </Macro>
    </MacroCollection>
</Form>
