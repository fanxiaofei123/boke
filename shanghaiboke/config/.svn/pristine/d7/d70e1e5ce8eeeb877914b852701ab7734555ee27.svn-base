<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="V_T_CalculateIncome_LRP" Caption="运输收入计算">
    <Body>
        <Block>
            <FlexFlowLayoutPanel Key="root" Caption="根面板">
                <GridLayoutPanel Key="first_head" Padding="5px" Height="pref" Caption="基本信息">
                    <Dict Key="DispatchOrg" Caption="调度组织" BuddyKey="Lab_DispatchOrg" X="1" Y="0" AllowMultiSelection="true" ItemKey="LRP_DispatchOrg" TabOrder="10" XSpan="3"/>
                    <Label Key="Lab_DispatchOrg" Caption="调度组织" X="0" Y="0"/>
                    <Dict Key="Owner" Caption="货主" BuddyKey="Lab_Owner" X="6" Y="0" AllowMultiSelection="true" ItemKey="LRP_Owner" TabOrder="20" XSpan="3"/>
                    <Label Key="Lab_Owner" Caption="货主" X="5" Y="0"/>
                    <DatePicker Key="StartDate" Caption="日期范围起" BuddyKey="Lab_StartDate" X="1" Y="1" TabOrder="30" XSpan="3"/>
                    <Label Key="Lab_StartDate" Caption="日期范围起" X="0" Y="1"/>
                    <DatePicker Key="EndDate" Caption="至" BuddyKey="Lab_EndDate" X="6" Y="1" TabOrder="40" XSpan="3"/>
                    <Label Key="Lab_EndDate" Caption="至" X="5" Y="1"/>
                    <ComboBox Key="DateField" Caption="日期字段" BuddyKey="Lab_DateField" X="1" Y="2" Enable="false" Clearable="false" XSpan="3">
                        <DataBinding DefaultValue="OrderDateTime"/>
                        <Item Caption="下单日期时间" Key="OrderDateTime" Value="OrderDateTime"/>
                    </ComboBox>
                    <Label Key="Lab_DateField" Caption="日期字段" X="0" Y="2"/>
                    <TextEditor Key="No" Caption="运输订单号" BuddyKey="Lab_No" X="6" Y="2" MaxLength="40" TabOrder="60" XSpan="3" Trim="true"/>
                    <Label Key="Lab_No" Caption="运输订单号" X="5" Y="2"/>
                    <Button Key="Calculate" Caption="计算" X="10" Y="0" TabOrder="100">
                        <OnClick>
                            <![CDATA[//若运输订单号不为空，则可不考虑其它字段
//若运输订单为空，则需要考虑其它必填项

if (IsControlNull("DateField")){
    Confirm(LocaleString('CHshow','chkey3'),'OK');
    return 0;
}

if (IsControlNull("No")) {
    if (IsControlNull("DispatchOrg") || IsControlNull("Owner") || IsControlNull("StartDate") || IsControlNull("EndDate")) {
         Confirm(LocaleString('CHshow','chkey4'),'OK');
         return 0;
    }
}



//后台计算
var r = InvokeService("LRP_T_CalculateIncome", false, false, GetValue("No"),GetJSONValue("DispatchOrg"),GetJSONValue("Owner"),GetValue("StartDate"),GetValue("EndDate"),GetValue("DateField"));
if (r == 1){
    Confirm(LocaleString('CHshow','chkey5'),'OK','OK:{}');
}
]]>
                        </OnClick>
                    </Button>
                    <Button Key="Reset" Caption="重置" X="10" Y="1" TabOrder="120">
                        <OnClick>
                            <![CDATA[//设置各条件字段为空
SetValue("DispatchOrg","");
SetValue("Owner","");
SetValue("StartDate", "");
SetValue("EndDate", "");
SetValue("No", "");
]]>
                        </OnClick>
                    </Button>
                    <RowDefCollection RowGap="8">
                        <RowDef Height="30px"/>
                        <RowDef Height="30px"/>
                        <RowDef Height="30px"/>
                    </RowDefCollection>
                    <ColumnDefCollection ColumnGap="8">
                        <ColumnDef Width="70px"/>
                        <ColumnDef Width="25%"/>
                        <ColumnDef Width="55px"/>
                        <ColumnDef Width="25%"/>
                        <ColumnDef Width="55px"/>
                        <ColumnDef Width="70px"/>
                        <ColumnDef Width="25%"/>
                        <ColumnDef Width="55px"/>
                        <ColumnDef Width="25%"/>
                        <ColumnDef Width="30px"/>
                        <ColumnDef Width="80px"/>
                    </ColumnDefCollection>
                </GridLayoutPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
</Form>
