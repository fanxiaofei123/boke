<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="CHCS_Contract_Warning_View" Caption="合同有效期预警" FormType="View">
    <DataSource RefObjectKey="CHCS_Contract_Warning"/>
    <OperationCollection>
        <Operation Key="export" Caption="导出">
            <Action>
                <![CDATA[ExportExcel(true,{},true);]]>
            </Action>
        </Operation>
        <Operation Key="print" Caption="打印">
            <Action>
                <![CDATA[Print("CHCS_Contract_Warning_Report");]]>
            </Action>
        </Operation>
    </OperationCollection>
    <QueryCollection>
        <Query Key="updateWarningState" Description="修改预警状态">
            <Statement DBType="MySql">
                <![CDATA[update CHCS_Verdor_Contract set Warning_Status=? where Contract_Code=?]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Integer"/>
                <Parameter DataType="Varchar"/>
            </ParameterCollection>
        </Query>
    </QueryCollection>
    <Body>
        <Block>
            <FlexFlowLayoutPanel Key="main" Caption="根面板">
                <ToolBar Key="main_toolbar" Height="pref" Caption="main_toolbar">
                    <ToolBarItemCollection/>
                </ToolBar>
                <SplitPanel Key="SplitPanel1" Orientation="Vertical" Height="100%" Caption="SplitPanel1">
                    <GridLayoutPanel Key="first_head" Padding="5px" Height="pref" Caption="基本信息">
                        <Dict Key="Warning_Level_C" Caption="预警级别" BuddyKey="Lab_Warning_Level_C" X="1" Y="0" ItemKey="CHCS_Warn_Time_Set">
                            <Condition ColumnKey="Warning_Level" TableKey="CHCS_Contract_Warning" CondSign="="/>
                        </Dict>
                        <Label Key="Lab_Warning_Level_C" Caption="预警级别" X="0" Y="0"/>
                        <TextEditor Key="Contract_Code_C" Caption="合同编号" BuddyKey="Lab_Contract_Code_C" X="3" Y="0">
                            <Condition ColumnKey="Contract_Code" TableKey="CHCS_Contract_Warning" CondSign="like"/>
                        </TextEditor>
                        <Label Key="Lab_Contract_Code_C" Caption="合同编号" X="2" Y="0"/>
                        <TextEditor Key="Supplier_NO_C" Caption="供应商编号" BuddyKey="Lab_Supplier_NO_C" X="5" Y="0">
                            <Condition ColumnKey="Supplier_NO" TableKey="CHCS_Contract_Warning" CondSign="like"/>
                        </TextEditor>
                        <Label Key="Lab_Supplier_NO_C" Caption="供应商编号" X="4" Y="0"/>
                        <DatePicker Key="Effective_Date_C" Caption="合同生效日期" BuddyKey="Lab_Effective_Date_C" X="1" Y="1">
                            <Condition ColumnKey="Effective_Date" TableKey="CHCS_Contract_Warning" CondSign="between" Group="Effective_Date" GroupHead="true"/>
                        </DatePicker>
                        <Label Key="Lab_Effective_Date_C" Caption="合同生效日期" X="0" Y="1"/>
                        <DatePicker Key="Expiration_Date_C" Caption="合同到期日期" BuddyKey="Lab_Expiration_Date_C" X="3" Y="1">
                            <Condition ColumnKey="Expiration_Date" TableKey="CHCS_Contract_Warning" CondSign="between" Group="Effective_Date" GroupTail="true"/>
                        </DatePicker>
                        <Label Key="Lab_Expiration_Date_C" Caption="合同到期日期" X="2" Y="1"/>
                        <TextEditor Key="Contract_Unit_C" Caption="供应商名称" BuddyKey="Lab_Contract_Unit_C" X="5" Y="1">
                            <Condition ColumnKey="Contract_Unit" TableKey="CHCS_Contract_Warning" CondSign="like"/>
                        </TextEditor>
                        <Label Key="Lab_Contract_Unit_C" Caption="供应商名称" X="4" Y="1"/>
                        <TextEditor Key="Supplier_Abbr_C" Caption="供应商简称" BuddyKey="Lab_Supplier_Abbr_C" X="1" Y="2">
                            <Condition ColumnKey="Supplier_Abbr" TableKey="CHCS_Contract_Warning" CondSign="like"/>
                        </TextEditor>
                        <Label Key="Lab_Supplier_Abbr_C" Caption="供应商简称" X="0" Y="2"/>
                        <TextEditor Key="Contract_Name_C" Caption="合同名称" BuddyKey="Lab_Contract_Name_C" X="3" Y="2">
                            <Condition ColumnKey="Contract_Name" TableKey="CHCS_Contract_Warning" CondSign="like"/>
                        </TextEditor>
                        <Label Key="Lab_Contract_Name_C" Caption="合同名称" X="2" Y="2"/>
                        <Button Key="Query" Caption="查询" X="4" Y="3">
                            <OnClick>
                                <![CDATA[DealCondition();LoadData();ShowData();]]>
                            </OnClick>
                        </Button>
                        <Button Key="Reset" Caption="重置" X="5" Y="3">
                            <OnClick>
                                <![CDATA[ResetCondition();]]>
                            </OnClick>
                        </Button>
                        <RowDefCollection RowHeight="30" RowGap="6">
                            <RowDef/>
                            <RowDef/>
                            <RowDef/>
                            <RowDef/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="20">
                            <ColumnDef Width="60px"/>
                            <ColumnDef Width="33%"/>
                            <ColumnDef Width="60px"/>
                            <ColumnDef Width="33%"/>
                            <ColumnDef Width="60px"/>
                            <ColumnDef Width="34%"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <Grid Key="Grid1" Caption="Grid1" NewEmptyRow="false" Enable="false" PageLoadType="DB" CanDelete="false" CanInsert="false" CanShift="false" SelectionMode="Cell">
                        <GridColumnCollection>
                            <GridColumn Key="Button_G" Caption="关闭预警" Width="80px"/>
                            <GridColumn Key="Contract_Code" Caption="合同编号" Width="80px"/>
                            <GridColumn Key="Contract_Name" Caption="合同名称" Width="80px"/>
                            <GridColumn Key="Supplier_NO" Caption="供应商编号" Width="80px"/>
                            <GridColumn Key="Contract_Unit" Caption="供应商名称" Width="80px"/>
                            <GridColumn Key="Supplier_Abbr" Caption="供应商简称" Width="80px"/>
                            <GridColumn Key="Effective_Date" Caption="合同生效日期" Width="80px"/>
                            <GridColumn Key="Expiration_Date" Caption="合同到期日期" Width="104px"/>
                            <GridColumn Key="Maturity_Days" Caption="距离到期日天数" Width="103px"/>
                            <GridColumn Key="Warning_Level" Caption="预警级别" Width="80px"/>
                        </GridColumnCollection>
                        <GridRowCollection>
                            <GridRow Key="row1" TableKey="CHCS_Contract_Warning">
                                <GridCell Key="Button_G" Caption="关闭预警" CellType="Button" Enable="GetDictValue(&quot;CHCS_Warn_Time_Set&quot;, Warning_Level, &quot;Code&quot;)=='0'||IsNull(GetDictValue(&quot;CHCS_Warn_Time_Set&quot;, Warning_Level, &quot;Code&quot;))||GetDictValue(&quot;CHCS_Warn_Time_Set&quot;, Warning_Level, &quot;Code&quot;)=='-1'">
                                    <DataBinding DefaultFormulaValue="if(GetDictValue(&quot;CHCS_Warn_Time_Set&quot;, Warning_Level, &quot;Code&quot;)=='-1'){     &quot;开启预警&quot;; }else{     &quot;关闭预警&quot;; }"/>
                                    <OnClick>
                                        <![CDATA[if(GetDictValue("CHCS_Warn_Time_Set", Warning_Level, "Code")=='-1'){
    DBNamedUpdate('updateWarningState',0,Contract_Code);
}else{
    DBNamedUpdate('updateWarningState',1,Contract_Code);
}
LoadData();]]>
                                    </OnClick>
                                </GridCell>
                                <GridCell Key="Contract_Code" Caption="合同编号" CellType="TextEditor">
                                    <DataBinding ColumnKey="Contract_Code"/>
                                </GridCell>
                                <GridCell Key="Contract_Name" Caption="合同名称" CellType="TextEditor">
                                    <DataBinding ColumnKey="Contract_Name"/>
                                </GridCell>
                                <GridCell Key="Supplier_NO" Caption="供应商编号" CellType="TextEditor">
                                    <DataBinding ColumnKey="Supplier_NO"/>
                                </GridCell>
                                <GridCell Key="Contract_Unit" Caption="供应商名称" CellType="TextEditor">
                                    <DataBinding ColumnKey="Contract_Unit"/>
                                </GridCell>
                                <GridCell Key="Supplier_Abbr" Caption="供应商简称" CellType="TextEditor">
                                    <DataBinding ColumnKey="Supplier_Abbr"/>
                                </GridCell>
                                <GridCell Key="Effective_Date" Caption="合同生效日期" CellType="DatePicker">
                                    <DataBinding ColumnKey="Effective_Date"/>
                                </GridCell>
                                <GridCell Key="Expiration_Date" Caption="合同到期日期" CellType="DatePicker">
                                    <DataBinding ColumnKey="Expiration_Date"/>
                                </GridCell>
                                <GridCell Key="Maturity_Days" Caption="距离到期日天数">
                                    <DataBinding ColumnKey="Maturity_Days"/>
                                </GridCell>
                                <GridCell Key="Warning_Level" Caption="预警级别" CellType="Dict" ItemKey="CHCS_Warn_Time_Set">
                                    <DataBinding ColumnKey="Warning_Level"/>
                                </GridCell>
                            </GridRow>
                        </GridRowCollection>
                    </Grid>
                    <SplitSize Size="35%"/>
                    <SplitSize Size="65%"/>
                </SplitPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[LoadData();]]>
    </OnLoad>
    <OnPostShow>
        <![CDATA[var rowCount=GetRowCount('Grid1');
var i=0;
while(i<rowCount){
    if(GetDictValue("CHCS_Warn_Time_Set", GetCellValue('Grid1', i, 'Warning_Level'), "Code")=='0'){SetCellBackColor("Grid1", i, "Warning_Level", "#B22222")};
    if(GetDictValue("CHCS_Warn_Time_Set", GetCellValue('Grid1', i, 'Warning_Level'), "Code")=='1'){SetCellBackColor("Grid1", i, "Warning_Level", "#FF0000")};
    if(GetDictValue("CHCS_Warn_Time_Set", GetCellValue('Grid1', i, 'Warning_Level'), "Code")=='2'){SetCellBackColor("Grid1", i, "Warning_Level", "#FFD700")};
    if(GetDictValue("CHCS_Warn_Time_Set", GetCellValue('Grid1', i, 'Warning_Level'), "Code")=='3'){SetCellBackColor("Grid1", i, "Warning_Level", "#0000FF")};
    i=i+1;
}]]>
    </OnPostShow>
</Form>
