<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="DoPutawayByKitting" Caption="上架输入" Authenticate="false" HasNavigationBar="false">
    <DataSource>
        <DataObject Key="LRP_DoPutawayByKitting" Caption="上架输入" PrimaryTableKey="LRP_WMTx_L">
            <TableCollection>
                <Table Key="LRP_WMTx_L" Caption="待上架明细" TableMode="Detail" SourceType="Query">
                    <Column Caption="通知单OID" DataType="Long" Key="NoticeOID"/>
                    <Column Caption="通知单明细OID" DataType="Long" Key="NoticeDtlOID"/>
                    <Column Key="NoticeNo" Caption="通知单号" DataType="Varchar" Length="200"/>
                    <Column Caption="物料ID" DataType="Long" Key="MaterialId"/>
                    <Column Key="MtlName" Caption="物料名称" DataType="Varchar" Length="200"/>
                    <Column Key="MtlCode" Caption="物料代码" DataType="Varchar" Length="100"/>
                    <Column Key="KittingLocation" Caption="加工区" DataType="Varchar" Length="100"/>
                    <Column Key="LocCode" Caption="存储区储位代码" DataType="Varchar"/>
                    <Column Caption="单位" DataType="Varchar" Key="MaterialUnit" Length="10"/>
                    <Column Key="BatchNo" Caption="批号" DataType="Varchar" Length="200"/>
                    <Column Caption="上架量" DataType="Numeric" Key="Qty" Precision="18" Scale="6"/>
                    <ParameterCollection>
                        <Parameter DataType="Long" Formula="GetPara('OID')"/>
                    </ParameterCollection>
                    <Statement>
                        <![CDATA[ 
SELECT NoticeOID,
  NoticeDtlOID,
  NoticeNo,
  MaterialId,
  MaterialUnit,
  MtlName,
  MtlCode,
  LocCode,
  BatchNo,
  Qty,
  KittingLocation
FROM
  (SELECT q.MaterialId,
    q.OnhandQty AS Qty,
    q.BatchNo,
    m.Name AS MtlName,
    m.Code AS MtlCode,
    null AS LocCode,
    s.code KittingLocation,
    h.NO  AS NoticeNo,
    h.OID AS NoticeOID,
    l.OID AS NoticeDtlOID,
    l.MaterialUnit
  FROM LRP_Quant q
   LEFT JOIN LRP_LOCATION s
  ON q.LocationID = s.oid
  LEFT JOIN LRP_Material m
  ON q.MaterialId = m.oid
  LEFT JOIN LRP_KittingNoticeProduct_L l
  ON q.REFLINEOID = l.OID
  LEFT JOIN LRP_KittingNotice_H h
  ON h.OID        = l.SOID
  )a
WHERE Qty > 0 and NoticeOID = ?
    ]]>
                    </Statement>
                </Table>
                <Table Key="LRP_WMTx_LTX" Caption="本次上架明细" TableMode="Detail" SourceType="Query">
                    <Column Caption="通知单OID" DataType="Long" Key="NoticeOID"/>
                    <Column Caption="通知单明细OID" DataType="Long" Key="NoticeDtlOID"/>
                    <Column Key="NoticeNo" Caption="通知单号" DataType="Varchar" Length="200"/>
                    <Column Caption="物料ID" DataType="Long" Key="MaterialId"/>
                    <Column Key="MtlName" Caption="物料名称" DataType="Varchar" Length="200"/>
                    <Column Key="MtlCode" Caption="物料代码" DataType="Varchar" Length="100"/>
                    <Column Key="LocCode" Caption="存储区储位代码" DataType="Varchar"/>
                    <Column Caption="单位" DataType="Varchar" Key="MaterialUnit" Length="10"/>
                    <Column Key="BatchNo" Caption="批号" DataType="Varchar" Length="200"/>
                    <Column Caption="上架量" DataType="Numeric" Key="Qty" Precision="18" Scale="6"/>
                    <Column Key="KittingLocation" Caption="加工区" DataType="Varchar"/>
                    <Statement>
                        <![CDATA[ 
SELECT NoticeOID,
  NoticeDtlOID,
  NoticeNo,
  MaterialId,
  MaterialUnit,
  MtlName,
  MtlCode,
  LocCode,
  BatchNo,
  Qty,
  KittingLocation
FROM
  (SELECT q.MaterialId,
    q.OnhandQty AS Qty,
    q.BatchNo,
    m.Name AS MtlName,
    m.Code AS MtlCode,
    null AS LocCode,
    s.code KittingLocation,
    h.NO  AS NoticeNo,
    h.OID AS NoticeOID,
    l.OID AS NoticeDtlOID,
    l.MaterialUnit
  FROM LRP_Quant q
  LEFT JOIN LRP_LOCATION s
  ON q.LocationID = s.oid
  LEFT JOIN LRP_Material m
  ON q.MaterialId = m.oid
  LEFT JOIN LRP_KittingNoticeProduct_L l
  ON q.REFLINEOID = l.OID
  LEFT JOIN LRP_KittingNotice_H h
  ON h.OID        = l.SOID
  )a
WHERE 1 = 0
    ]]>
                    </Statement>
                </Table>
            </TableCollection>
        </DataObject>
    </DataSource>
    <QueryCollection>
        <Query Key="SelectLocation" Description="查找存储区储位">
            <Statement>
                <![CDATA[
				select l.Code from LRP_Location l left join LRP_Storearea s on l.Storeareaid=s.oid 
				where s.IsRecvArea=0 and s.IsShipArea=0 and s.IsSampleTestArea=0 and s.IsKittingArea=0 and l.WarehouseCenterId = ? ]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Long"/>
            </ParameterCollection>
        </Query>
    </QueryCollection>
    <Body>
        <Block>
            <GridLayoutPanel Key="root">
                <Format BackColor="#e6e6e6"/>
                <LinearLayoutPanel Caption="Title3" Key="Title" Orientation="Horizontal" X="0" Y="0" Padding="5px">
                    <Format BackColor="#f14c52"/>
                    <Button Key="Cancel" Caption="取消" Height="auto" Width="60px">
                        <Format BackColor="#f14c52" ForeColor="#ffffff" HAlign="Left">
                            <Font Size="16"/>
                        </Format>
                        <OnClick>
                            <![CDATA[
									ShowConfirm('是否放弃本次收货？', 'YES_NO', 
										{
											YES: {
													Back();
												}, 
											NO: {} 
										}
												)
								]]>
                        </OnClick>
                    </Button>
                    <Label Key="OrderTitle3" Caption="上架输入" Height="auto" Weight="1.0">
                        <Format ForeColor="#ffffff" HAlign="Center">
                            <Font Size="20"/>
                        </Format>
                    </Label>
                    <Button Key="Finish" Caption="完成" Height="auto" Width="60px">
                        <Format BackColor="#f14c52" ForeColor="#ffffff" HAlign="Right">
                            <Font Size="16"/>
                        </Format>
                        <OnClick>
                            <![CDATA[
									var count = GetRowCount('list2',false);
									var b = true;
									if(count > 0){
										InvokeService("LRP_PutwayByKittingSave", true, false,GetOperator());
										ShowToast("上架完成");
										Parent.LoadData();
										Back();
									}else{	
										ShowToast("本次上架明细无数据，无法完成。");								
									}
																													
									]]>
                        </OnClick>
                    </Button>
                </LinearLayoutPanel>
                <Label Key="ShowValue" X="0" Y="1" Visible="false"/>
                <TabGroup Caption="上架输入" Key="TabPanel1" IndicatorColor="#ff5000" X="0" Y="1">
                    <TabItem Text="待上架明细">
                        <Action>
                            <![CDATA[SetValue('ShowValue', 0);]]>
                        </Action>
                    </TabItem>
                    <TabItem Text="本次上架明细">
                        <Action>
                            <![CDATA[SetValue('ShowValue', 1);]]>
                        </Action>
                    </TabItem>
                </TabGroup>
                <TableView Key="RouteName_table3" X="0" Y="2" Visible="ShowValue==0">
                    <Format BackColor="#f1f3f8"/>
                    <TableRowCollection>
                        <TableRow Key="r1" SeparatorStyle="none none solid none" SeparatorColor="#cccccc" TopMargin="5px">
                            <LinearLayoutPanel Key="service_center_panel33" Height="pref" Orientation="Horizontal">
                                <TextEditor Key="Material_code" Caption="扫描物料条码" PromptText="扫描物料条码" BorderStyle="none" Weight="0.5" Height="auto">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                    <KeyEnter>
                                        <![CDATA[
										     CheckMaterial();
										
									  ]]>
                                    </KeyEnter>
                                </TextEditor>
                                <Image Key="query_btn" Enable="true" Image="12.png" ImageScaleType="Fit_XY" SourceType="Resource" Stretch="true" Padding="10px" Width="pref" Height="pref">
                                    <OnClick>
                                        <![CDATA[
										CheckMaterial();
									]]>
                                    </OnClick>
                                </Image>
                                <Label Key="Label1" Height="pref" Width="pref"/>
                                <Button Key="AllPutaway" Caption="全部上架" Enable="true" Width="pref" BorderRadius="4" BorderColor="#cccccc" HasBorder="true" Padding="5px" Margin="5px" Height="pref">
                                    <Format BackColor="#f14c52" ForeColor="#ffffff">
                                        <Font Size="13"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
										var rs = DBNamedQuery('SelectLocation',root.GetPara('WarehouseCenterId'));
										 var count = GetRowCount("list");
										 var i = 0;
										 var flag = false;
										 while(i < count){
											if(GetCellValue('list',i,'LocCode')==''){
												ShowToast("第" + (i+1) + "行储位不能为空！");
												return 0;
										   }
										   rs.beforefirst();
										   while(rs.next()){
										   if(GetCellValue('list',i,'LocCode') == rs.Code){
												flag=true;
												break;
											 }
										   }
										   if(flag == false){
											   ShowToast("第" + (i+1) + "行,存储区中不存在储位:" + locCode);
											   return 0;
										   }
										   if(GetCellValue('list',i,'Qty') <= 0){
												ShowToast("第" + (i+1) + "行,上架量要大于0");
												return 0;
										   }
											
											       var mtlCode = GetCellValue('list',i,'Materialcode');
								                   var mtlName = GetCellValue('list',i,'MaterialName');
											       var mtlUnit = GetCellValue('list',i,'MaterialUnit');
											       var batchNo = GetCellValue('list',i,'BatchNo');
												   var qty = GetCellValue('list',i,'Qty');	
                                                   var locCode = GetCellValue('list',i,'LocCode');
												   var noticeOID = GetCellValue('list',i, 'NoticeOID');
												   var noticeDtlOID = GetCellValue('list',i, 'NoticeDtlOID');
												   var materialId = GetCellValue('list',i, 'MaterialId');
										          var kittingLocation = GetCellValue('list', i, 'KittingLocation');
												   
												   var rowIndex = InsertRow('list2');
												   
												   SetCellValue('list2', rowIndex, 'Materialcode2', mtlCode,false);
												   SetCellValue('list2', rowIndex, 'MaterialName2', mtlName,false);
												   SetCellValue('list2', rowIndex, 'MaterialUnit2', mtlUnit,false);
												   SetCellValue('list2', rowIndex, 'Qty2', qty,false);
												   SetCellValue('list2', rowIndex, 'BatchNo2',batchNo,false);
												   SetCellValue('list2', rowIndex, 'LocCode2',locCode,false);
												   SetCellValue('list2', rowIndex, 'NoticeDtlOID2',noticeDtlOID,false);
												   SetCellValue('list2', rowIndex, 'NoticeOID2',noticeOID,false);
												   SetCellValue('list2', rowIndex, 'MaterialId2',materialId,false);
											SetCellValue('list2', rowIndex, 'KittingLocation2',kittingLocation,false);
												      
											       DeleteRow('list',i);

										   i=i+1;
										 }
									]]>
                                    </OnClick>
                                </Button>
                                <Label Key="Label2" Height="pref" Width="5px"/>
                            </LinearLayoutPanel>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
                <TableView Key="RouteName_table" X="0" Y="3" Visible="ShowValue==0" Padding="5px">
                    <Format BackColor="#f1f3f8"/>
                    <TableRowCollection>
                        <TableRow Key="list" SeparatorStyle="none none solid none" RowType="Detail" SeparatorColor="#cccccc" TableKey="LRP_WMTx_L" SelectColor="#dddddd">
                            <GridLayoutPanel Key="GridLayoutPanel3" Caption="GridLayoutPanel3">
                                <Label Key="NoticeDtlOID" X="3" Y="0" Visible="false" LeftPadding="5px">
                                    <DataBinding ColumnKey="NoticeDtlOID"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialId" LeftPadding="5px" X="3" Y="2" Visible="false">
                                    <DataBinding ColumnKey="MaterialId"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="Materialcode" LeftPadding="5px" X="1" Y="0" Caption="无物料代码" XSpan="2">
                                    <DataBinding ColumnKey="MtlCode"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialName" LeftPadding="5px" X="5" Y="0" Caption="无物料名称" XSpan="3">
                                    <DataBinding ColumnKey="MtlName"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialUnit" LeftPadding="5px" X="3" Y="1">
                                    <DataBinding ColumnKey="MaterialUnit"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="BatchNo" Caption="无批号" Enable="false" LeftPadding="5px" X="5" Y="1" XSpan="2">
                                    <DataBinding ColumnKey="BatchNo"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </TextEditor>
                                <Label Key="Qty_lbl" Caption="上架量：" LeftPadding="5px" X="1" Y="1">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <NumberEditor Key="Qty" Precision="18" Scale="3" X="2" Y="1" Caption="上架量" ShowZero="true">
                                    <DataBinding ColumnKey="Qty"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </NumberEditor>
                                <Label Key="Location_lbl" Caption="储位：" LeftPadding="5px" X="1" Y="2">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="LocCode" Caption="储位" X="2" Y="2" OnlyShow="false">
                                    <DataBinding ColumnKey="LocCode"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                    <KeyEnter>
                                        <![CDATA[
										  
										    var index = GetRowIndex('list');
										   var rs = DBNamedQuery('SelectLocation',root.GetPara('WarehouseCenterId'));
										   var locCode = GetCellValue('list',index,'LocCode');
										   var flag = false;	
										   if(locCode == ''){
												ShowToast("储位不能为空！");
												return 0;
										   }
										   rs.beforefirst();
										   while(rs.next()){
										   if(locCode == rs.Code){
												flag=true;
												break;
											 }
										   }
										   if(flag == false){
											   ShowToast("存储区中不存在储位" + locCode);
											   return 0;
										   }
										   if(GetCellValue('list',index,'Qty') <= 0){
												ShowToast("上架量要大于0");
												return 0;
										   }
										   
										   var mtlCode = GetCellValue('list',index, 'Materialcode');
										   var mtlName = GetCellValue('list',index, 'MaterialName');
										   var mtlUnit = GetCellValue('list',index, 'MaterialUnit');
										   var batchNo = GetCellValue('list',index, 'BatchNo');
										   var qty = GetCellValue('list',index, 'Qty');	
										   var locCode = GetCellValue('list',index, 'LocCode');
										   var noticeDtlOID = GetCellValue('list',index, 'NoticeDtlOID');
										   var noticeOID = GetCellValue('list',index, 'NoticeOID');
										   var materialId = GetCellValue('list',index, 'MaterialId');
										   var kittingLocation = GetCellValue('list', index, 'KittingLocation');
										   
										   var rowIndex = InsertRow('list2');

										   SetCellValue('list2', rowIndex, 'Materialcode2', mtlCode,false);
										   SetCellValue('list2', rowIndex, 'MaterialName2', mtlName,false);
										   SetCellValue('list2', rowIndex, 'MaterialUnit2', mtlUnit,false);
										   SetCellValue('list2', rowIndex, 'Qty2', qty,false);
										   SetCellValue('list2', rowIndex, 'BatchNo2',batchNo,false);
										   SetCellValue('list2', rowIndex, 'LocCode2',locCode,false);
										   SetCellValue('list2', rowIndex, 'NoticeDtlOID2',noticeDtlOID,false);
										   SetCellValue('list2', rowIndex, 'NoticeOID2',noticeOID,false);
										   SetCellValue('list2', rowIndex, 'MaterialId2',materialId,false);
										   SetCellValue('list2', rowIndex, 'KittingLocation2',kittingLocation,false);
										   
										   DeleteRow('list',index);
										
										
									  ]]>
                                    </KeyEnter>
                                </TextEditor>
                                <Button Key="Split" Caption="拆分" BorderRadius="4" BorderColor="#cccccc" HasBorder="true" X="9" Y="0" Padding="5px">
                                    <Format BackColor="#f14c52" ForeColor="#ffffff">
                                        <Font Size="13"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
								       var mtlCode = GetCellValue('list', -1, 'Materialcode');
								       var mtlName = GetCellValue('list', -1, 'MaterialName');
									   var mtlUnit = GetCellValue('list', -1, 'MaterialUnit');
									   var batchNo = GetCellValue('list', -1, 'BatchNo');
									   var materialId = GetCellValue('list',-1, 'MaterialId');
									   var noticeDtlOID = GetCellValue('list',-1, 'NoticeDtlOID');
									   var noticeOID = GetCellValue('list',-1, 'NoticeOID');
								       var kittingLocation = GetCellValue('list', -1, 'KittingLocation');
									   
									   var rowIndex= InsertRow('list',GetRowIndex('list')+1);

									   SetCellValue('list', rowIndex, 'Materialcode', mtlCode,false);
									   SetCellValue('list', rowIndex, 'MaterialName', mtlName,false);
									   SetCellValue('list', rowIndex, 'MaterialUnit', mtlUnit,false);
									   SetCellValue('list', rowIndex, 'Qty', 0,false);
									   SetCellValue('list', rowIndex, 'BatchNo',batchNo,false);
									   SetCellValue('list', rowIndex, 'LocCode',"",false);
									   SetCellValue('list', rowIndex, 'MaterialId',materialId,false);
									   SetCellValue('list', rowIndex, 'NoticeOID',noticeOID,false);
                                       SetCellValue('list', rowIndex, 'KittingLocation',kittingLocation,false);

									]]>
                                    </OnClick>
                                </Button>
                                <Button Key="Putaway" Caption="上架" BorderRadius="4" BorderColor="#cccccc" HasBorder="true" X="9" Y="2" Padding="5px">
                                    <Format BackColor="#f14c52" ForeColor="#ffffff">
                                        <Font Size="13"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
										   var index = GetRowIndex('list');
										   var rs = DBNamedQuery('SelectLocation',root.GetPara('WarehouseCenterId'));
										   var locCode = GetCellValue('list',index,'LocCode');
										   var flag = false;	
										   if(locCode == ''){
												ShowToast("储位不能为空！");
												return 0;
										   }
										   rs.beforefirst();
										   while(rs.next()){
										   if(locCode == rs.Code){
												flag=true;
												break;
											 }
										   }
										   if(flag == false){
											   ShowToast("存储区中不存在储位" + locCode);
											   return 0;
										   }
										   if(GetCellValue('list',index,'Qty') <= 0){
												ShowToast("上架量要大于0");
												return 0;
										   }
										   
										   var mtlCode = GetCellValue('list',index, 'Materialcode');
										   var mtlName = GetCellValue('list',index, 'MaterialName');
										   var mtlUnit = GetCellValue('list',index, 'MaterialUnit');
										   var batchNo = GetCellValue('list',index, 'BatchNo');
										   var qty = GetCellValue('list',index, 'Qty');	
										   var locCode = GetCellValue('list',index, 'LocCode');
										   var noticeDtlOID = GetCellValue('list',index, 'NoticeDtlOID');
										   var noticeOID = GetCellValue('list',index, 'NoticeOID');
										   var materialId = GetCellValue('list',index, 'MaterialId');
										   var kittingLocation = GetCellValue('list', index, 'KittingLocation');
										  
										  
										   
										   var rowIndex = InsertRow('list2',-1);

										   SetCellValue('list2', rowIndex, 'Materialcode2', mtlCode,false);
										   SetCellValue('list2', rowIndex, 'MaterialName2', mtlName,false);
										   SetCellValue('list2', rowIndex, 'MaterialUnit2', mtlUnit,false);
										   SetCellValue('list2', rowIndex, 'Qty2', qty,false);
										   SetCellValue('list2', rowIndex, 'BatchNo2',batchNo,false);
										   SetCellValue('list2', rowIndex, 'LocCode2',locCode,false);
										   SetCellValue('list2', rowIndex, 'NoticeDtlOID2',noticeDtlOID,false);
										   SetCellValue('list2', rowIndex, 'NoticeOID2',noticeOID,false);
										   SetCellValue('list2', rowIndex, 'MaterialId2',materialId,false);
										   SetCellValue('list2', rowIndex, 'KittingLocation2',kittingLocation,false);
										   
										  DeleteRow('list');
											
											 
									]]>
                                    </OnClick>
                                </Button>
                                <TextEditor Key="KittingLocation" Caption="加工区" X="6" Y="2" Enable="false">
                                    <DataBinding ColumnKey="KittingLocation"/>
                                </TextEditor>
                                <Label Key="Lab_KittingLocation" Caption="加工区：" X="5" Y="2"/>
                                <Label Key="NoticeOID" X="7" Y="2" Visible="false">
                                    <DataBinding ColumnKey="NoticeOID"/>
                                </Label>
                                <RowDefCollection RowGap="5">
                                    <RowDef Height="35px"/>
                                    <RowDef Height="35px"/>
                                    <RowDef Height="35px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="5">
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="45px"/>
                                    <ColumnDef Width="50%"/>
                                    <ColumnDef Width="20px"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="50px"/>
                                    <ColumnDef Width="50%"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="60px"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                            <RowActionCollection>
                                <RowAction Key="delete" Caption="删除" BackColor="#ff5000" ForeColor="#ffffff">
                                    <![CDATA[
											ShowConfirm('确定删除该条明细吗?', 'YES_NO', 
												{
													YES: {
														DeleteRow('list', GetRowIndex('list'));
														ShowToast('已删除');
													}, 
													NO: {} 
												}
											)
									]]>
                                </RowAction>
                            </RowActionCollection>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
                <TableView Key="RouteName_table2" X="0" Y="2" YSpan="2" Visible="ShowValue==1" Padding="5px">
                    <Format BackColor="#f1f3f8"/>
                    <TableRowCollection>
                        <TableRow Key="list2" SeparatorStyle="none none solid none" RowType="Detail" SeparatorColor="#dde0e7" TableKey="LRP_WMTx_LTX" SelectColor="#dddddd">
                            <GridLayoutPanel Key="GridLayoutPanel4" Caption="GridLayoutPanel4">
                                <Label Key="NoticeDtlOID2" X="5" Y="0" Visible="false" LeftPadding="5px">
                                    <DataBinding ColumnKey="NoticeDtlOID"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialId2" LeftPadding="5px" X="5" Y="1" Visible="false">
                                    <DataBinding ColumnKey="MaterialId"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="Materialcode2" LeftPadding="5px" X="1" Y="0" Caption="无物料代码" XSpan="2">
                                    <DataBinding ColumnKey="MtlCode"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialName2" LeftPadding="5px" X="3" Y="0" Caption="无物料名称" XSpan="2">
                                    <DataBinding ColumnKey="MtlName"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Label Key="MaterialUnit2" LeftPadding="5px" X="4" Y="1" Height="pref">
                                    <DataBinding ColumnKey="MaterialUnit"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="BatchNo2" Caption="无批号" Enable="false" LeftPadding="5px" X="6" Y="0" XSpan="2">
                                    <DataBinding ColumnKey="BatchNo"/>
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </TextEditor>
                                <Label Key="Qty_lbl2" Caption="上架量:" LeftPadding="5px" X="1" Y="1">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <NumberEditor Key="Qty2" Precision="18" Scale="3" X="2" Y="1" Caption="上架量" Height="pref" XSpan="2">
                                    <DataBinding ColumnKey="Qty"/>
                                    <Format HAlign="Center">
                                        <Font Size="13"/>
                                    </Format>
                                </NumberEditor>
                                <Label Key="Location_lbl2" Caption="储位:" LeftPadding="5px" X="6" Y="1">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="LocCode2" Caption="储位" X="7" Y="1">
                                    <DataBinding ColumnKey="LocCode"/>
                                    <Format HAlign="Center">
                                        <Font Size="13"/>
                                    </Format>
                                </TextEditor>
                                <Button Key="Putaway_R" Caption="下架" X="9" Y="0" BorderColor="#dde0e7" BorderRadius="4" HasBorder="true" YSpan="2" Padding="5px">
                                    <Format BackColor="#f14c52" ForeColor="#ffffff">
                                        <Font Size="13"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
								       ShowConfirm('是否将该行明细下架？', 'YES_NO', 
										{
											YES: {
											       var index = GetRowIndex('list2');
												   var mtlCode = GetCellValue('list2',index, 'Materialcode2');
								                   var mtlName = GetCellValue('list2',index, 'MaterialName2');
											       var mtlUnit = GetCellValue('list2',index, 'MaterialUnit2');
											       var batchNo = GetCellValue('list2',index, 'BatchNo2');
												   var qty = GetCellValue('list2',index, 'Qty2');	
                                                   var locCode = GetCellValue('list2',index, 'LocCode2');
												   var noticeDtlOID = GetCellValue('list2',index, 'NoticeDtlOID2');
												   var noticeOID = GetCellValue('list2',index, 'NoticeOID2');
												   var materialId = GetCellValue('list2',index, 'MaterialId2');
												   var kittingLocation = GetCellValue('list2',index,'KittingLocation2');
												   
												   var rowIndex = InsertRow('list',-1);

												   SetCellValue('list', rowIndex, 'Materialcode', mtlCode,false);
												   SetCellValue('list', rowIndex, 'MaterialName', mtlName,false);
												   SetCellValue('list', rowIndex, 'MaterialUnit', mtlUnit,false);
												   SetCellValue('list', rowIndex, 'Qty', qty,false);
												   SetCellValue('list', rowIndex, 'BatchNo',batchNo,false);
												   SetCellValue('list', rowIndex, 'LocCode',locCode,false);
												   SetCellValue('list', rowIndex, 'NoticeDtlOID',noticeDtlOID,false);
												   SetCellValue('list', rowIndex, 'NoticeOID',noticeOID,false);
												   SetCellValue('list', rowIndex, 'MaterialId',materialId,false);
												 SetCellValue('list',rowIndex,'KittingLocation',kittingLocation,false);
												   
												   DeleteRow('list2', index);
												}, 
											NO: {} 
										}
												)
									]]>
                                    </OnClick>
                                </Button>
                                <Label Key="KittingLocation2" X="8" Y="1" Visible="false">
                                    <DataBinding ColumnKey="KittingLocation"/>
                                </Label>
                                <Label Key="NoticeOID2" X="8" Y="0" Visible="false">
                                    <DataBinding ColumnKey="NoticeOID"/>
                                </Label>
                                <RowDefCollection RowGap="5">
                                    <RowDef Height="35px"/>
                                    <RowDef Height="35px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="5">
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="45px"/>
                                    <ColumnDef Width="33%"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="33%"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="30px"/>
                                    <ColumnDef Width="33%"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="60px"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
                <RowDefCollection>
                    <RowDef Height="50px"/>
                    <RowDef Height="60px"/>
                    <RowDef Height="70px"/>
                    <RowDef Height="100%"/>
                </RowDefCollection>
                <ColumnDefCollection>
                    <ColumnDef Width="100%"/>
                </ColumnDefCollection>
            </GridLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[
		    LoadData();
					  
        ]]>
    </OnLoad>
    <MacroCollection>
        <Macro Key="CheckMaterial" Description="根据扫入的物料条码定位对应的物料">
            <![CDATA[                              
				if(Material_code<>''){
					var focusRowIndex=GetFocusRow('list');
					var flag=false;
					var count = GetRowCount('list',false);
					var i=0;
					while(i<count){
						if(GetCellValue('list', i,'Materialcode')==Material_code ){
							SetFocusRow('list',i);
							SetRowIndex('list',i);
							ScrollTo('list',i);
							flag=true;
							break;
								}
								i=i+1;							
					          }
					if(flag==false){
						ShowToast("待上架明细中找不到该条码物料。");
					  }
				}
				SetFocus('Material_code');
			]]>
        </Macro>
    </MacroCollection>
    <FormParaCollection>
        <FormPara Formula="Para('OID')" Key="OID" Type="Formula"/>
    </FormParaCollection>
</Form>
