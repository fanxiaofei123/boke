<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="Tx301_2" Authenticate="True">
    <DataSource>
        <DataObject Key="Tx301_2">
            <TableCollection>
                <Table Caption="移位历史" Key="MoveHistory" SourceType="Query" TableMode="Detail" Persist="false">
                    <Column Caption="OID" DataType="Long" Key="OID"/>
                    <Column Caption="移位单号" DataType="Varchar" Key="No"/>
                    <Column Caption="货主" DataType="Long" Key="OwnerId"/>
                    <Column Caption="移位单完成日期时间" DataType="DateTime" Key="FinishDateTime"/>
                    <Column Caption="货主单号" DataType="Long" Key="OwnerNo"/>
                    <ParameterCollection>
                        <Parameter DataType="Long" Formula="GetUserOperator()"/>
                    </ParameterCollection>
                    <Statement>
                        <![CDATA[
						select OID,No,OwnerId,FinishDateTime,OwnerNo from LRP_WMTx_H where WarehouseKeeperId=? and Status=900 and TxTypeCode='301'
						]]>
                    </Statement>
                </Table>
            </TableCollection>
        </DataObject>
    </DataSource>
    <QueryCollection>
        <Query Key="Querylocation" Description="查找储位是否是存储区储位">
            <Statement>
                <![CDATA[select loc.oid from lrp_location loc join LRP_Storearea store on loc.StoreareaId=store.oid where store.IsRecvArea=0 and IsShipArea=0 and IsSampleTestArea=0 and IsKittingArea=0 and loc.Code=?]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Varchar"/>
            </ParameterCollection>
        </Query>
    </QueryCollection>
    <Body>
        <Block>
            <GridLayoutPanel Key="root">
                <Label Key="ShowValue" X="0" Y="0" Visible="false"/>
                <TabGroup Caption="即时移位" Key="TabPanel1" IndicatorColor="#ff5000" X="0" Y="0">
                    <TabItem Text="即时移位">
                        <Action>
                            <![CDATA[SetValue('ShowValue', 0);]]>
                        </Action>
                    </TabItem>
                    <TabItem Text="移位历史">
                        <Action>
                            <![CDATA[SetValue('ShowValue', 1);]]>
                        </Action>
                    </TabItem>
                </TabGroup>
                <TableView Key="locationquery_table" X="0" Y="1" Visible="ShowValue==0 || Length(ShowValue) == 0">
                    <Format BackColor="#f1f3f8"/>
                    <TableRowCollection>
                        <TableRow Key="r1" SeparatorStyle="solid solid solid none" SeparatorColor="#dde0e7" TopMargin="20px" BottomMargin="20px">
                            <LinearLayoutPanel Key="service_center_panel" Height="50px" Orientation="Horizontal">
                                <TextEditor Key="Location_code" Caption="扫描储位代码" PromptText="扫描储位代码" Weight="1.0" Width="auto" BorderRadius="4" BorderColor="#dde0e7" HasBorder="true" Enable="True" Height="auto"/>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="r2" SeparatorStyle="solid solid solid none" SeparatorColor="#dde0e7" BottomMargin="20px">
                            <LinearLayoutPanel Key="Material_panel" Height="50px" Orientation="Horizontal">
                                <TextEditor Key="Material_code" Caption="扫描物料代码" PromptText="扫描物料代码" Enable="true" Weight="1.0" Width="auto" BorderRadius="4" BorderColor="#dde0e7" HasBorder="true" Height="auto"/>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="r3" SeparatorStyle="solid solid solid none" SeparatorColor="#dde0e7" BottomMargin="20px">
                            <LinearLayoutPanel Key="add_panel" Height="50px" Orientation="Horizontal">
                                <Button Key="add_btn" Caption="新增移位" Enable="true" Width="auto" BorderStyle="none">
                                    <OnClick>
                                        <![CDATA[
											if(Location_code==''){
												ShowToast("储位代码不可为空");
												return true;
											}
											var loc = DBNamedQuery('Querylocation',Location_code);
											loc.beforefirst();
											if(loc.next()){
												PushPara('LocationCode',Location_code);
												PushPara('MaterialCode',Material_code);
												Show('Tx301_2Add');
											}else{
												ShowToast("储位代码在存储区中不存在。");
												return true;
											}
										]]>
                                    </OnClick>
                                </Button>
                            </LinearLayoutPanel>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
				<ListView Key="listFinish" Caption="移位历史" TableKey="MoveHistory" RowHeight="60" ShowHead="false" X="0" Y="1" Visible="ShowValue==1">
                    <ListViewColumnCollection>
                        <ListViewColumn Key="OID" Caption="OID" DataColumnKey="OID" ColumnType="TextEditor" Visible="false"/>
                        <ListViewColumn Key="No" Caption="移位单号" DataColumnKey="No" ColumnType="TextEditor"/>
                        <ListViewColumn Key="OwnerId" Caption="货主" DataColumnKey="OwnerId" ColumnType="Dict" ItemKey="LRP_Owner"/>
                        <ListViewColumn Key="FinishDateTime" Caption="移位完成日期时间" DataColumnKey="FinishDateTime" ColumnType="DatePicker">
                            <Format HAlign="Left"/>
                        </ListViewColumn>
                        <ListViewColumn Key="OwnerNo" Caption="货主单号" DataColumnKey="OwnerNo" ColumnType="TextEditor"/>
                    </ListViewColumnCollection>
                    <RowClick>
                        <![CDATA[
							   Open('Tx301_2HistoryDetail',OID);
						]]>
                    </RowClick>
                </ListView>
                <RowDefCollection>
                    <RowDef Height="50px"/>
                    <RowDef Height="100%"/>
                </RowDefCollection>
                <ColumnDefCollection>
                    <ColumnDef Width="100%"/>
                </ColumnDefCollection>
            </GridLayoutPanel>
        </Block>
        <ViewCollection>
            <View Key="Confirm">
                <ComponentView Key="listFinish">
                    <GridLayout Key="listFinish">
                        <LayoutSpan Key="No" X="0" Y="0"/>
                        <LayoutSpan Key="OwnerId" X="1" Y="0"/>
                        <LayoutSpan Key="FinishDateTime" X="0" Y="1"/>
                        <LayoutSpan Key="OwnerNo" X="1" Y="1"/>
                        <RowDefCollection>
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                        </RowDefCollection>
                        <ColumnDefCollection>
                            <ColumnDef Width="70%"/>
                            <ColumnDef Width="30%"/>
                        </ColumnDefCollection>
                    </GridLayout>
                </ComponentView>
            </View>
        </ViewCollection>
    </Body>
    <OnLoad>
        <![CDATA[
			LoadData();
        ]]>
    </OnLoad>
    <NavigationBar BackColor="#f14c52" Style="Custom">
        <BarItem Key="TitleCenter_bar" Caption="即时移位" Location="Center">
            <Label Key="TitleCenter" Caption="即时移位" Width="100px">
                <Format ForeColor="#ffffff" HAlign="Center">
                    <Font Size="20"/>
                </Format>
            </Label>
        </BarItem>
    </NavigationBar>
</Form>
