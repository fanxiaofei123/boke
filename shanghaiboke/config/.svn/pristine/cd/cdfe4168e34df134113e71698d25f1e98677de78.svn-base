<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Caption="批量调度" Key="V_BatchTransportDispatch">
    <DataSource>
        <DataObject Caption="批量调度" Key="V_BatchTransportDispatch">
            <TableCollection>
                <Table Caption="作业单列表" Key="LRP_TransportJob_H" SourceType="Query" TableMode="Detail">
                    <Column Caption="对象标识" DataType="Long" Key="OID"/>
                    <Column Caption="主对象标识" DataType="Long" Key="SOID"/>
                    <Column Caption="父对象标识" DataType="Long" Key="POID"/>
                    <Column Caption="对象版本" DataType="Integer" Key="VERID"/>
                    <Column Caption="对象明细版本" DataType="Integer" Key="DVERID"/>
                    <Column Caption="状态" DataType="Integer" Key="Status"/>
                    <Column Caption="创建人" DataType="Long" Key="CREATOR"/>
                    <Column Caption="创建时间" DataType="DateTime" Key="CREATETIME"/>
                    <Column Caption="修改人" DataType="Long" Key="MODIFIER"/>
                    <Column Caption="修改时间" DataType="DateTime" Key="MODIFYTIME"/>
                    <Column Key="No" Caption="作业单号" DataType="Varchar" Length="100"/>
                    <Column Key="OrderNo" Caption="运输订单号" DataType="Varchar" Length="100"/>
                    <Column Key="OwnerNo" Caption="货主单号" DataType="Varchar" Length="100"/>
                    <Column Key="OwnerId" Caption="货主id" DataType="Long"/>
                    <Column Key="JobType" Caption="作业单类型" DataType="Varchar" Length="10"/>
                    <Column Key="OrderType" Caption="订单类型" DataType="Varchar" Length="10"/>
                    <Column Key="DispatchOrgId" Caption="调度组织" DataType="Long"/>
                    <Column Key="OrderDateTime" Caption="下单日期时间" DataType="DateTime"/>
                    <Column Key="SendOrg" Caption="发站" DataType="Long"/>
                    <Column Key="DestOrg" Caption="到站" DataType="Long"/>
                    <Column Key="SendCityId" Caption="发货城市" DataType="Long"/>
                    <Column Key="RecvCityId" Caption="收货城市" DataType="Long"/>
                    <Column Key="SumQty" Caption="总数量" DataType="Numeric" Precision="10" Scale="0"/>
                    <Column Key="SumWeight" Caption="总重量" DataType="Numeric" Precision="18" Scale="6"/>
                    <Column Key="SumCubage" Caption="总体积" DataType="Numeric" Precision="18" Scale="6"/>
                    <Column Key="RecvPartyId" Caption="收货方" DataType="Long"/>
                    <Column Key="SendPartyName" Caption="发货方名称" DataType="Varchar" Length="100"/>
                    <Column Key="RecvPartyName" Caption="收货方名称" DataType="Varchar" Length="100"/>
                    <Column Key="SendAddress" Caption="发货方地址" DataType="Varchar" Length="100"/>
                    <Column Key="RecvAddress" Caption="收货方地址" DataType="Varchar" Length="100"/>
                    <Column Key="Requirement" Caption="运输要求" DataType="Varchar" Length="1000"/>
                    <Column Key="AgencyFund" Caption="代收货款" DataType="Numeric" Precision="18" Scale="6"/>
                    <Column Key="PayMethod" Caption="付款方式" DataType="Integer"/>
                    <Statement>
                        <![CDATA[select * from (select h.oid,sum(l.Qty) as SumQty,sum(l.Weight) as SumWeight,sum(l.Cubage) as SumCubage from LRP_TransportJob_H h join LRP_TransportJobMat_L l on l.soid=h.soid where h.Status=200 group by h.oid)a join LRP_TransportJob_H h on a.oid = h.oid]]>
                    </Statement>
                </Table>
                <Table Caption="车辆列表" Key="LRP_Truck" SourceType="Query" TableMode="Detail">
                    <Column Caption="对象标识" DataType="Long" Key="OID"/>
                    <Column Caption="主对象标识" DataType="Long" Key="SOID"/>
                    <Column Caption="父对象标识" DataType="Long" Key="POID"/>
                    <Column Caption="对象版本" DataType="Integer" Key="VERID"/>
                    <Column Caption="对象明细版本" DataType="Integer" Key="DVERID"/>
                    <Column Caption="状态" DataType="Integer" Key="Status"/>
                    <Column Caption="创建人" DataType="Long" Key="CREATOR"/>
                    <Column Caption="创建时间" DataType="DateTime" Key="CREATETIME"/>
                    <Column Caption="修改人" DataType="Long" Key="MODIFIER"/>
                    <Column Caption="修改时间" DataType="DateTime" Key="MODIFYTIME"/>
                    <Column Key="TransportDispatchStatus" Caption="调度状态" DataType="Integer"/>
                    <Column Key="LicenseNo" Caption="车牌号" DataType="Varchar" Length="40"/>
                    <Column Key="Name" Caption="车辆名称" DataType="Varchar" Length="200"/>
                    <Column Key="FleetId" Caption="所属车队" DataType="Long"/>
                    <Column Key="OwnershipType" Caption="所有权" DataType="Integer"/>
                    <Column Key="TruckTypeId" Caption="车辆类型id" DataType="Long"/>
                    <Column Key="BrandModel" Caption="品牌型号" DataType="Varchar" Length="100"/>
                    <Column Key="LoadWeight" Caption="载重" DataType="Numeric" Precision="18" Scale="3"/>
                    <Column Key="LoadCubage" Caption="容积" DataType="Numeric" Precision="18" Scale="3"/>
                    <Column Key="Driver" Caption="司机" DataType="Varchar" Length="40" Cache="true"/>
                    <Column Key="DriverMobile" Caption="司机手机" DataType="Varchar" Length="40" Cache="true"/>
                    <ParameterCollection>
                        <Parameter DataType="Long" Formula="getCurDispatchOrgID()"/>
                    </ParameterCollection>
                    <Statement>
                        <![CDATA[select * from (select t.oid,case max(h.Status) when 100 then 2 when 750 then 3 else 1 end as TransportDispatchStatus from LRP_Truck t left join LRP_TransportDispatch_H h on t.oid=h.TruckId and h.Status < 900 join LRP_TruckDispatchOrg td on t.oid = td.soid and td.DispatchOrgId = ? group by t.oid)b join LRP_Truck t on b.oid = t.oid]]>
                    </Statement>
                </Table>
            </TableCollection>
        </DataObject>
    </DataSource>
    <OperationCollection>
        <Operation Caption="配车" Key="Save">
            <Action>
                <![CDATA[
				var count = GetRowCount('Grid0',false);
				var i=0;
				var bselect = false;
						  
				//遍历表格,是否有被勾选的明细行
				while ( i < count ){
					//设置当前行
					SetRowIndex('Grid0', i);
					if(ToInt(Select)==1){
						bselect = true;
					}
					i=i+1;
				}
				if(!bselect){
					Confirm('请先选择运输作业单','OK','OK:{}');
				}
				else{
					count = GetRowCount('Grid1',false);
					i=0;
					bselect = false;
					var bmore = false;
					//遍历表格,是否有被勾选的明细行
					while ( i < count ){
						//设置当前行
						SetRowIndex('Grid1', i);
						if(ToInt(Select1)==1){
							if(bselect) {bmore = true;}
							bselect = true;
						}
						i=i+1;
					}
					if(!bselect){
						Confirm('请先选择需要配车的车辆','OK','OK:{}');
					}
					else{
						if(bmore){
							Confirm('只允许选择一辆车','OK','OK:{}');
						}
						else{
							SetPara('BatchAdd_para',1);
							New('V_SelfTruckTransportDispatch');
						}
					}
				}
			]]>
            </Action>
        </Operation>
        <Operation Caption="委外和新增" Key="Save1">
            <Action>
                <![CDATA[
				var count = GetRowCount('Grid0',false);
				var i=0;
				var bselect = false;
						  
				//遍历表格,是否有被勾选的明细行
				while ( i < count ){
					//设置当前行
					SetRowIndex('Grid0', i);
					if(ToInt(Select)==1){
						bselect = true;
					}
					i=i+1;
				}
				if(!bselect){
					Confirm('请先选择运输作业单','OK','OK:{}');
				}
				else{
					SetPara('BatchAdd_para',1);
					New('V_CarrierTransportDispatch');
				}
			]]>
            </Action>
        </Operation>
        <Operation Caption="取消" Key="Close">
            <Action>
                <![CDATA[
				Close();
			]]>
            </Action>
        </Operation>
    </OperationCollection>
    <QueryCollection>
        <Query Description="获取运输路线的详细节点信息" Key="GetRouteDetail">
            <Statement>
                <![CDATA[				
				select oid,Sequence,NodeType,NodeId,PickOrSend from LRP_Route_L where SOID =?	order by Sequence			
			]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Long"/>
            </ParameterCollection>
        </Query>
    </QueryCollection>
    <Body PopHeight="80%" PopWidth="80%">
        <Block>
            <FlexFlowLayoutPanel Caption="根面板" Key="root">
                <ToolBar Caption="ToolBar1" Height="pref" Key="ToolBar1">
                    <ToolBarItemCollection/>
                </ToolBar>
                <SplitPanel Key="SplitPanel3" Height="100%" Caption="SplitPanel3">
                    <TabPanel Caption="TabPanel0" Key="TabPanel0" Height="100%">
                        <SplitPanel Caption="作业单列表" Height="100%" Key="SplitPanel1" Orientation="Vertical">
                            <GridLayoutPanel Caption="基本信息" Height="pref" Key="first_head" Padding="5px" Width="100%">
                                <TextEditor Caption="作业单号" Key="No_C" X="1" XSpan="3" Y="0">
                                    <Condition ColumnKey="No" CondSign="like" TableKey="LRP_TransportJob_H"/>
                                </TextEditor>
                                <Label Caption="作业单号" Key="L_No" X="0" Y="0"/>
                                <CheckListBox BuddyKey="Lab_JobType_C" Caption="类型" Key="JobType_C" X="5" XSpan="3" Y="0">
                                    <Condition ColumnKey="JobType" CondSign="in" TableKey="LRP_TransportJob_H"/>
                                    <Item Caption="提货" Key="701" Value="701"/>
                                    <Item Caption="配送" Key="702" Value="702"/>
                                    <Item Caption="中转" Key="703" Value="703"/>
                                    <Item Caption="直发" Key="704" Value="704"/>
                                    <Item Caption="客退" Key="707" Value="707"/>
                                </CheckListBox>
                                <Label Caption="类型" Key="Lab_JobType_C" X="4" Y="0"/>
                                <TextEditor Caption="订单号" Key="OrderNo_C" X="1" XSpan="3" Y="1">
                                    <Condition ColumnKey="OrderNo" CondSign="like" TableKey="LRP_TransportJob_H"/>
                                </TextEditor>
                                <Label Caption="订单号" Key="L_OrderNo" X="0" Y="1"/>
                                <TextEditor Caption="货主单号" Key="OwnerNo_C" X="5" XSpan="3" Y="1">
                                    <Condition ColumnKey="OwnerNo" CondSign="like" TableKey="LRP_TransportJob_H"/>
                                </TextEditor>
                                <Label Caption="货主单号" Key="L_OwnerNo" X="4" Y="1"/>
                                <Dict BuddyKey="Lab_SendOrg" Caption="发站" ItemKey="LRP_WarehouseCenter" Key="SendOrg_C" X="1" XSpan="3" Y="2">
                                    <Condition ColumnKey="SendOrg" CondSign="=" TableKey="LRP_TransportJob_H"/>
                                </Dict>
                                <Label Caption="发站" Key="Lab_SendOrg" X="0" Y="2"/>
                                <Dict BuddyKey="Lab_DestOrg" Caption="到站" ItemKey="LRP_WarehouseCenter" Key="DestOrg_C" X="5" XSpan="3" Y="2">
                                    <Condition ColumnKey="DestOrg" CondSign="=" TableKey="LRP_TransportJob_H"/>
                                </Dict>
                                <Label Caption="到站" Key="Lab_DestOrg" X="4" Y="2"/>
                                <DatePicker Caption="下单日期时间" Key="OrderDateTime_C" OnlyDate="true" X="1" XSpan="3" Y="3" BuddyKey="L_OrderDateTime">
                                    <DataBinding DefaultFormulaValue="Format(ServerDate(),'yyyy-MM-dd')&amp;' 00:00:00'"/>
                                    <Condition ColumnKey="OrderDateTime" CondSign="between" TableKey="LRP_TransportJob_H" Group="OrderDateTime" GroupHead="true"/>
                                </DatePicker>
                                <Label Caption="下单日期时间" Key="L_OrderDateTime" X="0" Y="3"/>
                                <DatePicker Caption="至" Key="OrderDateTime_C_1" OnlyDate="true" X="5" XSpan="3" Y="3" BuddyKey="L_OrderDateTime_1">
                                    <DataBinding DefaultFormulaValue="Format(ServerDate(),'yyyy-MM-dd')&amp;' 23:59:59'"/>
                                    <Condition ColumnKey="OrderDateTime" CondSign="none" TableKey="LRP_TransportJob_H" Group="OrderDateTime" GroupTail="true"/>
                                </DatePicker>
                                <Label Caption="至" Key="L_OrderDateTime_1" X="4" Y="3"/>
                                <TextEditor Caption="发货方" Key="SendPartyName_C" X="1" XSpan="3" Y="4">
                                    <Condition ColumnKey="SendPartyName" CondSign="like" TableKey="LRP_TransportJob_H"/>
                                </TextEditor>
                                <Label Caption="发货方" Key="L_SendPartyName" X="0" Y="4"/>
                                <TextEditor Caption="收货方" Key="RecvPartyName_C" X="5" XSpan="3" Y="4">
                                    <Condition ColumnKey="RecvPartyName" CondSign="like" TableKey="LRP_TransportJob_H"/>
                                </TextEditor>
                                <Label Caption="收货方" Key="L_RecvPartyName" X="4" Y="4"/>
                                <Dict BuddyKey="Lab_RouteId" Caption="运输路线" ItemKey="LRP_Route" Key="RouteId" X="1" XSpan="3" Y="5">
                                    <Condition CondSign="custom" Impl="com.bokesoft.lrp_v3.mid.tms.TransportJobView_RouteConditionBuilder">
                                        <ConditionTarget TableKey="LRP_TransportJob_H" ColumnKey="RouteId"/>
                                    </Condition>
                                </Dict>
                                <Label Caption="运输路线" Key="Lab_RouteId" X="0" Y="5"/>
                                <CheckListBox BuddyKey="Lab_OrderType_C" Caption="订单类型" Key="OrderType_C" X="5" XSpan="3" Y="5">
                                    <Condition ColumnKey="OrderType" CondSign="in" TableKey="LRP_TransportJob_H"/>
                                    <Item Caption="零担" Key="LTL" Value="LTL"/>
                                    <Item Caption="整车" Key="FTL" Value="FTL"/>
                                    <Item Caption="集装箱" Key="FCL" Value="FCL"/>
                                    <Item Caption="仓配" Key="WD" Value="WD"/>
                                    <Item Caption="快递" Key="EX" Value="EX"/>
                                    <Item Caption="水运" Key="WT" Value="WT"/>
                                    <Item Caption="空运" Key="AF" Value="AF"/>
                                    <Item Caption="多式联运" Key="MT" Value="MT"/>
                                </CheckListBox>
                                <Label Caption="订单类型" Key="Lab_OrderType_C" X="4" Y="5"/>
                                <Dict BuddyKey="Lab_SendCityId" Caption="发货城市" ItemKey="LRP_City" Key="SendCityId_C" X="1" XSpan="3" Y="6">
                                    <Condition ColumnKey="SendCityId" CondSign="=" TableKey="LRP_TransportJob_H"/>
                                </Dict>
                                <Label Caption="发货城市" Key="Lab_SendCityId" X="0" Y="6"/>
                                <Dict BuddyKey="Lab_RecvCityId" Caption="收货城市" ItemKey="LRP_City" Key="RecvCityId_C" X="5" XSpan="3" Y="6">
                                    <Condition ColumnKey="RecvCityId" CondSign="=" TableKey="LRP_TransportJob_H"/>
                                </Dict>
                                <Label Caption="收货城市" Key="Lab_RecvCityId" X="4" Y="6"/>
                                <Dict BuddyKey="Lab_DispatchOrgId" Caption="调度组织" ItemKey="LRP_DispatchOrg" Key="DispatchOrgId" Visible="false" X="1" XSpan="3" Y="7"/>
                                <Label Caption="调度组织" Key="Lab_DispatchOrgId" Visible="false" X="0" Y="7"/>
                                <Label Caption="运输路线查询条件" Key="Par_RouteId" Visible="false" X="0" Y="0"/>
                                <Button Caption="查询" Enable="true" Key="Query" X="8" Y="0">
                                    <OnClick>
                                        <![CDATA[
								//获取运输路线相关的查询条件
								var where = "";
								var id = RouteId;
								if(Length(id) > 0){
									var rst = DBNamedQuery('GetRouteDetail',id);									
									rst.beforefirst();
									while(rst.next()){
										//仓储中心
										if(rst.NodeType == "LRP_WarehouseCenter"){
											//配送点
											if(rst.PickOrSend = 1){
												where = where + "DestOrg=" + rst.NodeId + " or ";
											}
											//提货点
											else{
												where = where + "SendOrg=" + rst.NodeId + " or ";
											}
										}
										
										//城市
										if(rst.NodeType == "LRP_City"){
											//配送点
											if(rst.PickOrSend = 1){
												where = where + "RecvCityId=" + rst.NodeId + " or ";
											}
											//提货点
											else{
												where = where + "SendCityId=" + rst.NodeId + " or ";
											}
										}
										
										//区县
										if(rst.NodeType == "LRP_District"){
											//配送点
											if(rst.PickOrSend = 1){
												where = where + "RecvDistrictId=" + rst.NodeId + " or ";
											}
											//提货点
											else{
												where = where + "SendDistrictId=" + rst.NodeId + " or ";
											}
										}
									}
								}
								if(Length(where) == 0){
									where = "1=1";
								}
								else{
									where = Left(where, Length(where)-4);
								}
									
								SetValue("Par_RouteId",where);
								DealCondition();ReloadGrid("Grid0");
								SetValue("SelectSumWeight",0);
								SetValue("SelectSumCubage",0);
								]]>
                                    </OnClick>
                                </Button>
                                <Button Caption="重置" Enable="true" Key="cancle" X="8" Y="1">
                                    <OnClick>
                                        <![CDATA[
								ResetCondition("LRP_TransportJob_H");			
								]]>
                                    </OnClick>
                                </Button>
                                <Button Key="btn_map" Caption="地图显示" X="8" Y="2">
                                    <OnClick>
                                        <![CDATA[//根据列表中的数据显示百度地图轨迹
//先判断列表明细不可为空
if (GetRowCount('Grid0') < 1){
    Confirm('作业单列表不可为空', 'OK','OK:{}');
    return true;
}

var plat = "lat=";
var plong = "long=";
var c = GetRowCount('Grid0');

var i = 0;
while (i < c){
    var address=GetCellValue('Grid0', i, 'RecvAddress');
var returnjson=InvokeService("LRP_getLatAndLngByAddress",true,false,address);

var strlat=returnjson.latitude;
var strlon=returnjson.longitude;

    plat = plat & strlat & "Z";
    plong = plong & strlon & "Z";

    i = i + 1;
}
plat = Left(plat, Length(plat) - 1);
plong = Left(plong, Length(plong) - 1);


//取第一行坐标类型为所有坐标类型
//var ctype = GetCellValue('ListView1', 0, 'CoordinateType');
var pctype = "bdl90";

var url = "LRP_Map/baidumap_batchdispatch.html?" & plat & "&" & plong & "&" & pctype;
SetValue('WebBrowser', url);
OUT(url);
return true;]]>
                                    </OnClick>
                                </Button>
                                <RowDefCollection RowGap="8">
                                    <RowDef Height="25px"/>
                                    <RowDef Height="25px"/>
                                    <RowDef Height="25px"/>
                                    <RowDef Height="25px"/>
                                    <RowDef Height="25px"/>
                                    <RowDef Height="25px"/>
                                    <RowDef Height="25px"/>
                                    <RowDef Height="25px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="20">
                                    <ColumnDef Width="100px"/>
                                    <ColumnDef Width="25%"/>
                                    <ColumnDef Width="55px"/>
                                    <ColumnDef Width="25%"/>
                                    <ColumnDef Width="100px"/>
                                    <ColumnDef Width="25%"/>
                                    <ColumnDef Width="55px"/>
                                    <ColumnDef Width="25%"/>
                                    <ColumnDef Width="80px"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                            <GridLayoutPanel Caption="作业单明细" Height="100%" Key="TransportJobType" Padding="5px">
                                <Grid Caption="Grid0" Height="100%" Key="Grid0" NewEmptyRow="false" ShowRowHead="false" PageLoadType="UI" PageRowCount="10" RowAlterable="false" X="0" XSpan="6" Y="1" CanDelete="false" CanInsert="false" CanShift="false" Width="100%">
                                    <GridColumnCollection>
                                        <GridColumn Caption="选择" Key="Select" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="作业单ID" Key="OID" Visible="false" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="作业单号" Key="No" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="类型" Key="JobType" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="订单号" Key="OrderNo" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="货主单号" Key="OwnerNo" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="订单类型" Key="OrderType" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="下单日期时间" Key="OrderDateTime" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="发站" Key="SendOrg" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="到站" Key="DestOrg" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="发货城市" Key="SendCityId" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="收货城市" Key="RecvCityId" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="总数量" Key="SumQty" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="总重量" Key="SumWeight" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="总体积" Key="SumCubage" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="货主" Key="OwnerId" Visible="false" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="收货方" Key="RecvPartyName" Visible="false" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="收货地址" Key="RecvAddress" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="发货方" Key="SendPartyName" Visible="false" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="发货地址" Key="SendAddress" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="运输要求" Key="Requirement" Visible="false" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="代收货款" Key="AgencyFund" Visible="false" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="付款方式" Key="PayMethod" Visible="false" Width="80px" Sortable="true"/>
                                        <GridColumn Caption="状态" Key="Status" Visible="false" Width="80px" Sortable="true"/>
                                    </GridColumnCollection>
                                    <GridRowCollection>
                                        <GridRow Key="row1" RowHeight="35" TableKey="LRP_TransportJob_H">
                                            <GridCell Caption="选择" CellType="CheckBox" IsSelect="true" Key="Select">
                                                <DataBinding>
                                                    <ValueChanged>
                                                        <![CDATA[SumWeightCubage()]]>
                                                    </ValueChanged>
                                                </DataBinding>
                                            </GridCell>
                                            <GridCell Caption="作业单ID" CellType="TextEditor" Enable="false" Key="OID">
                                                <DataBinding ColumnKey="OID"/>
                                            </GridCell>
                                            <GridCell Caption="作业单号" CellType="HyperLink" Enable="true" Key="No">
                                                <DataBinding ColumnKey="No"/>
                                                <OnClick>
                                                    <![CDATA[	
											if(JobType == "701"){
												Open('V_701', OID);
											}
											if(JobType == "702"){
												Open('V_702', OID);
											}
											if(JobType == "703"){
												Open('V_703', OID);
											}
											if(JobType == "704"){
												Open('V_704', OID);
											}
											if(JobType == "705"){
												Open('V_705', OID);
											}
											if(JobType == "706"){
												Open('V_706', OID);
											}
										]]>
                                                </OnClick>
                                            </GridCell>
                                            <GridCell Caption="类型" CellType="ComboBox" Enable="false" Key="JobType">
                                                <DataBinding ColumnKey="JobType"/>
                                                <Item Caption="提货" Key="701" Value="701"/>
                                                <Item Caption="配送" Key="702" Value="702"/>
                                                <Item Caption="中转" Key="703" Value="703"/>
                                                <Item Caption="直发" Key="704" Value="704"/>
                                                <Item Caption="自送" Key="705" Value="705"/>
                                                <Item Caption="自提" Key="706" Value="706"/>
                                                <Item Caption="客退" Key="707" Value="707"/>
                                            </GridCell>
                                            <GridCell Caption="订单号" CellType="TextEditor" Enable="false" Key="OrderNo">
                                                <DataBinding ColumnKey="OrderNo"/>
                                            </GridCell>
                                            <GridCell Caption="货主单号" CellType="TextEditor" Enable="false" Key="OwnerNo">
                                                <DataBinding ColumnKey="OwnerNo"/>
                                            </GridCell>
                                            <GridCell Caption="订单类型" CellType="ComboBox" Enable="false" Key="OrderType">
                                                <DataBinding ColumnKey="OrderType"/>
                                                <Item Caption="零担 " Key="LTL" Value="LTL"/>
                                                <Item Caption="整车 " Key="FTL" Value="FTL"/>
                                                <Item Caption="集装箱 " Key="FCL" Value="FCL"/>
                                                <Item Caption="仓配 " Key="WD" Value="WD"/>
                                                <Item Caption="快递 " Key="EX" Value="EX"/>
                                                <Item Caption="水运" Key="WT" Value="WT"/>
                                                <Item Caption="空运" Key="AF" Value="AF"/>
                                                <Item Caption="多式联运" Key="MT" Value="MT"/>
                                            </GridCell>
                                            <GridCell Caption="下单日期时间" CellType="DatePicker" Enable="false" Key="OrderDateTime">
                                                <DataBinding ColumnKey="OrderDateTime"/>
                                            </GridCell>
                                            <GridCell Caption="发站" CellType="Dict" Enable="false" Key="SendOrg" ItemKey="LRP_WarehouseCenter">
                                                <DataBinding ColumnKey="SendOrg"/>
                                            </GridCell>
                                            <GridCell Caption="到站" CellType="Dict" Enable="false" Key="DestOrg" ItemKey="LRP_WarehouseCenter">
                                                <DataBinding ColumnKey="DestOrg"/>
                                            </GridCell>
                                            <GridCell Caption="发货城市" CellType="Dict" Enable="false" Key="SendCityId" ItemKey="LRP_City">
                                                <DataBinding ColumnKey="SendCityId"/>
                                            </GridCell>
                                            <GridCell Caption="收货城市" CellType="Dict" Enable="false" Key="RecvCityId" ItemKey="LRP_City">
                                                <DataBinding ColumnKey="RecvCityId"/>
                                            </GridCell>
                                            <GridCell Caption="总数量" CellType="NumberEditor" Enable="false" Key="SumQty">
                                                <DataBinding ColumnKey="SumQty"/>
                                            </GridCell>
                                            <GridCell Caption="总重量" CellType="NumberEditor" Enable="false" Key="SumWeight">
                                                <DataBinding ColumnKey="SumWeight"/>
                                            </GridCell>
                                            <GridCell Caption="总体积" CellType="NumberEditor" Enable="false" Key="SumCubage">
                                                <DataBinding ColumnKey="SumCubage"/>
                                            </GridCell>
                                            <GridCell Caption="货主" CellType="Dict" Enable="false" ItemKey="LRP_Owner" Key="OwnerId">
                                                <DataBinding ColumnKey="OwnerId"/>
                                            </GridCell>
                                            <GridCell Caption="收货方" CellType="TextEditor" Enable="false" Key="RecvPartyName">
                                                <DataBinding ColumnKey="RecvPartyName"/>
                                            </GridCell>
                                            <GridCell Caption="收货地址" CellType="TextEditor" Enable="false" Key="RecvAddress">
                                                <DataBinding ColumnKey="RecvAddress"/>
                                            </GridCell>
                                            <GridCell Caption="发货方" CellType="TextEditor" Enable="false" Key="SendPartyName">
                                                <DataBinding ColumnKey="SendPartyName"/>
                                            </GridCell>
                                            <GridCell Caption="发货地址" CellType="TextEditor" Enable="false" Key="SendAddress">
                                                <DataBinding ColumnKey="SendAddress"/>
                                            </GridCell>
                                            <GridCell Caption="运输要求" CellType="TextEditor" Enable="false" Key="Requirement">
                                                <DataBinding ColumnKey="Requirement"/>
                                            </GridCell>
                                            <GridCell Caption="代收货款" CellType="NumberEditor" Enable="false" Key="AgencyFund">
                                                <DataBinding ColumnKey="AgencyFund"/>
                                            </GridCell>
                                            <GridCell Caption="付款方式" CellType="ComboBox" Enable="false" Key="PayMethod">
                                                <DataBinding ColumnKey="PayMethod"/>
                                                <Item Caption="现付" Key="0" Value="0"/>
                                                <Item Caption="回单付 " Key="1" Value="1"/>
                                                <Item Caption="月结 " Key="2" Value="2"/>
                                                <Item Caption="到付 " Key="3" Value="3"/>
                                                <Item Caption="预付 " Key="4" Value="4"/>
                                                <Item Caption="提付" Key="5" Value="5"/>
                                            </GridCell>
                                            <GridCell Caption="状态" CellType="ComboBox" Enable="false" Key="Status">
                                                <DataBinding ColumnKey="Status"/>
                                            </GridCell>
                                        </GridRow>
                                    </GridRowCollection>
                                </Grid>
                                <NumberEditor BuddyKey="Lab_TotalWeight" Caption="已选择总重量" Enable="false" Key="SelectSumWeight" X="1" Y="0"/>
                                <Label Caption="已选择总重量" Key="Lab_TotalWeight" X="0" Y="0"/>
                                <NumberEditor BuddyKey="Lab_TotalCubage" Caption="已选择总体积" Enable="false" Key="SelectSumCubage" X="4" Y="0"/>
                                <Label Caption="已选择总体积" Key="Lab_TotalCubage" X="3" Y="0"/>
                                <RowDefCollection RowGap="2">
                                    <RowDef Height="25px"/>
                                    <RowDef Height="100%"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="6">
                                    <ColumnDef Width="80px"/>
                                    <ColumnDef Width="100px"/>
                                    <ColumnDef Width="20px"/>
                                    <ColumnDef Width="80px"/>
                                    <ColumnDef Width="100px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                            <SplitSize Size="230px"/>
                            <SplitSize Size="100%"/>
                        </SplitPanel>
                        <SplitPanel Caption="车辆列表" Height="100%" Key="SplitPanel2" Orientation="Vertical">
                            <GridLayoutPanel Caption="基本信息" Height="pref" Key="first_head1" Padding="5px">
                                <TextEditor Caption="车牌号" Key="LicenseNo_C" X="1" XSpan="3" Y="0">
                                    <Condition ColumnKey="LicenseNo" CondSign="like" TableKey="LRP_Truck"/>
                                </TextEditor>
                                <Label Caption="车牌号" Key="L_LicenseNo" X="0" Y="0"/>
                                <Dict BuddyKey="Lab_TruckTypeId" Caption="车型" ItemKey="LRP_TruckType" Key="TruckTypeId_C" X="6" XSpan="3" Y="0">
                                    <Condition ColumnKey="TruckTypeId" CondSign="=" TableKey="LRP_Truck"/>
                                </Dict>
                                <Label Caption="车型" Key="L_TruckTypeId" X="5" Y="0"/>
                                <CheckListBox BuddyKey="L_OwnershipType" Caption="所有权" Key="OwnershipType_C" X="1" XSpan="3" Y="1">
                                    <Condition ColumnKey="OwnershipType" CondSign="in" TableKey="LRP_Truck"/>
                                    <Item Caption="自有" Key="1" Value="1"/>
                                    <Item Caption="挂靠" Key="2" Value="2"/>
                                    <Item Caption="社会" Key="3" Value="3"/>
                                </CheckListBox>
                                <Label Caption="所有权" Key="L_OwnershipType" X="0" Y="1"/>
                                <TextEditor Caption="司机" Key="Driver_C" X="6" XSpan="3" Y="1">
                                    <Condition ColumnKey="Driver" CondSign="like" TableKey="LRP_Truck"/>
                                </TextEditor>
                                <CheckListBox BuddyKey="L_TransportDispatchStatus" Caption="调度状态" Key="TransportDispatchStatus_C" X="1" XSpan="3" Y="2">
                                    <Condition ColumnKey="TransportDispatchStatus" CondSign="in" TableKey="LRP_Truck"/>
                                    <Item Caption="未配载" Key="1" Value="1"/>
                                    <Item Caption="已配载" Key="2" Value="2"/>
                                    <Item Caption="在途" Key="3" Value="3"/>
                                </CheckListBox>
                                <Label Caption="调度状态" Key="L_TransportDispatchStatus" X="0" Y="2"/>
                                <Dict BuddyKey="Lab_DispatchOrgId1" Caption="调度组织" ItemKey="LRP_DispatchOrg" Key="DispatchOrgId1" Visible="false" X="1" XSpan="3" Y="6"/>
                                <Label Caption="调度组织" Key="Lab_DispatchOrgId1" Visible="false" X="0" Y="6"/>
                                <Button Caption="查询" Enable="true" Key="Query1" X="10" Y="0">
                                    <OnClick>
                                        <![CDATA[								
								DealCondition();ReloadGrid("Grid1");	
								]]>
                                    </OnClick>
                                </Button>
                                <Button Caption="重置" Enable="true" Key="cancle1" X="10" Y="1">
                                    <OnClick>
                                        <![CDATA[
								ResetCondition("LRP_Truck");		
								]]>
                                    </OnClick>
                                </Button>
                                <RowDefCollection RowGap="8">
                                    <RowDef Height="25px"/>
                                    <RowDef Height="25px"/>
                                    <RowDef Height="25px"/>
                                    <RowDef Height="25px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="8">
                                    <ColumnDef Width="100px"/>
                                    <ColumnDef Width="25%"/>
                                    <ColumnDef Width="55px"/>
                                    <ColumnDef Width="25%"/>
                                    <ColumnDef Width="55px"/>
                                    <ColumnDef Width="100px"/>
                                    <ColumnDef Width="25%"/>
                                    <ColumnDef Width="55px"/>
                                    <ColumnDef Width="25%"/>
                                    <ColumnDef Width="30px"/>
                                    <ColumnDef Width="80px"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                            <Grid Caption="Grid1" Height="pref" Key="Grid1" NewEmptyRow="false" ShowRowHead="false" PageLoadType="UI" PageRowCount="10" RowAlterable="false" CanDelete="false" CanInsert="false" CanShift="false">
                                <GridColumnCollection>
                                    <GridColumn Caption="选择" Key="Select1" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="车辆ID" Key="OID1" Visible="false" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="调度状态" Key="TransportDispatchStatus" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="车牌号" Key="LicenseNo" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="车辆名称" Key="Name" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="车队" Key="FleetId" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="所有权" Key="OwnershipType" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="车型" Key="TruckTypeId" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="品牌型号" Key="SeBrandModelndOrg" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="载重" Key="LoadWeight" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="容积" Key="LoadCubage" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="司机" Key="Driver" Width="80px" Sortable="true"/>
                                    <GridColumn Caption="司机手机" Key="DriverMobile" Width="80px" Sortable="true"/>
                                </GridColumnCollection>
                                <GridRowCollection>
                                    <GridRow Key="row2" RowHeight="35" TableKey="LRP_Truck">
                                        <GridCell Caption="选择" CellType="CheckBox" IsSelect="true" Key="Select1"/>
                                        <GridCell Caption="车辆ID" CellType="TextEditor" Enable="false" Key="OID1">
                                            <DataBinding ColumnKey="OID"/>
                                        </GridCell>
                                        <GridCell Caption="调度状态" CellType="ComboBox" Enable="false" Key="TransportDispatchStatus">
                                            <DataBinding ColumnKey="TransportDispatchStatus"/>
                                            <Item Caption="未配载" Key="1" Value="1"/>
                                            <Item Caption="已配载" Key="2" Value="2"/>
                                            <Item Caption="在途" Key="3" Value="3"/>
                                        </GridCell>
                                        <GridCell Caption="车牌号" CellType="TextEditor" Enable="false" Key="LicenseNo">
                                            <DataBinding ColumnKey="LicenseNo"/>
                                        </GridCell>
                                        <GridCell Caption="车辆名称" CellType="TextEditor" Enable="false" Key="Name">
                                            <DataBinding ColumnKey="Name"/>
                                        </GridCell>
                                        <GridCell Caption="车队" CellType="Dict" Enable="false" Key="FleetId" ItemKey="LRP_Fleet">
                                            <DataBinding ColumnKey="FleetId"/>
                                        </GridCell>
                                        <GridCell Caption="所有权" CellType="ComboBox" Enable="false" Key="OwnershipType">
                                            <DataBinding ColumnKey="OwnershipType"/>
                                            <Item Caption="自有" Key="1" Value="1"/>
                                            <Item Caption="挂靠" Key="2" Value="2"/>
                                            <Item Caption="社会" Key="3" Value="3"/>
                                        </GridCell>
                                        <GridCell Caption="车型" CellType="Dict" Enable="false" Key="TruckTypeId" ItemKey="LRP_TruckType">
                                            <DataBinding ColumnKey="TruckTypeId"/>
                                        </GridCell>
                                        <GridCell Caption="品牌型号" CellType="TextEditor" Enable="false" Key="BrandModel">
                                            <DataBinding ColumnKey="BrandModel"/>
                                        </GridCell>
                                        <GridCell Caption="载重" CellType="NumberEditor" Enable="false" Key="LoadWeight">
                                            <DataBinding ColumnKey="LoadWeight"/>
                                        </GridCell>
                                        <GridCell Caption="容积" CellType="NumberEditor" Enable="false" Key="LoadCubage">
                                            <DataBinding ColumnKey="LoadCubage"/>
                                        </GridCell>
                                        <GridCell Caption="司机" CellType="TextEditor" Enable="false" Key="Driver">
                                            <DataBinding ColumnKey="Driver"/>
                                        </GridCell>
                                        <GridCell Caption="司机手机" CellType="TextEditor" Enable="false" Key="DriverMobile">
                                            <DataBinding ColumnKey="DriverMobile"/>
                                        </GridCell>
                                    </GridRow>
                                </GridRowCollection>
                            </Grid>
                            <SplitSize Size="100px"/>
                            <SplitSize Size="100%"/>
                        </SplitPanel>
                    </TabPanel>
                    <WebBrowser Caption="WebBrowser" Key="WebBrowser"/>
                    <SplitSize Size="48%"/>
                    <SplitSize Size="55%"/>
                </SplitPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[
	]]>
    </OnLoad>
    <MacroCollection>
        <Macro Key="SumWeightCubage">
            <![CDATA[						
			var Weight = 0.0;
			var Cubage = 0.0;
			var count = GetRowCount('Grid0',false);
			var i=0;
			
			while ( i < count ){
				//设置当前行
				SetRowIndex('Grid0', i);
				if(ToInt(Select)==1){
					Weight = Weight + SumWeight;
					Cubage = Cubage + SumCubage;
				}
				i = i + 1;
			}
			
			SetValue("SelectSumWeight",Weight);
			SetValue("SelectSumCubage",Cubage);
			]]>
        </Macro>
    </MacroCollection>
    <FormParaCollection>
        <FormPara Key="Par_RouteId" Type="Formula" Formula="GetValue({Par_RouteId})"/>
    </FormParaCollection>
</Form>
