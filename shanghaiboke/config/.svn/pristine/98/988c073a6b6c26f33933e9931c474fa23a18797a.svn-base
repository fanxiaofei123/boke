<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form AbbrCaption="费用对账单序事簿" Caption="费用对账单序事簿" FormType="View" Key="V_ExpenseStatementView">
    <DataSource>
        <DataObject Caption="费用对账单序事簿" Key="V_ExpenseStatementView" PrimaryTableKey="LRP_ExpenseStatement_H">
            <TableCollection>
                <Table Key="LRP_ExpenseStatement_H" Persist="false" SourceType="Query" TableMode="Detail">
                    <Column Key="OID" Caption="对象标识" DataType="Long"/>
                    <Column Key="SOID" Caption="主对象标识" DataType="Long"/>
                    <Column Key="POID" Caption="父对象标识" DataType="Long"/>
                    <Column Key="VERID" Caption="对象版本" DataType="Integer"/>
                    <Column Key="DVERID" Caption="对象明细版本" DataType="Integer"/>
                    <Column Key="Status" Caption="状态" DataType="Integer"/>
                    <Column Key="CREATOR" Caption="创建人" DataType="Long"/>
                    <Column Key="CREATETIME" Caption="创建时间" DataType="DateTime"/>
                    <Column Key="MODIFIER" Caption="修改人" DataType="Long"/>
                    <Column Key="MODIFYTIME" Caption="修改时间" DataType="DateTime"/>
                    <Column Key="No" Caption="对账单号" DataType="Varchar" Length="100" SortType="Desc"/>
                    <Column Key="CompanyCodeId" Caption="公司代码id" DataType="Long"/>
                    <Column Key="StatementName" Caption="账单名称" DataType="Varchar" Length="100"/>
                    <Column Key="CarrierId" Caption="承运商id" DataType="Long"/>
                    <Column Key="SettlementId" Caption="结算方id" DataType="Long"/>
                    <Column Key="OrderDate" Caption="账单日期" DataType="Date"/>
                    <Column Key="FinishDate" Caption="完成日期" DataType="Date"/>
                    <Column Key="TotalAmount" Caption="总金额" DataType="Numeric" DefaultValue="0" Precision="18" Scale="6"/>
                    <Column Key="Remark" Caption="备注" DataType="Varchar" Length="1000"/>
                </Table>
            </TableCollection>
            <OIDFilter/>
        </DataObject>
    </DataSource>
    <OperationCollection>
        <Operation Caption="新增" Icon="new.png" Key="New">
            <Action>
                <![CDATA[
				New('V_ExpenseStatement')	
			]]>
            </Action>
        </Operation>
        <Operation Caption="确认" Key="BatchConfirm" RefKey="BatchConfirm"/>
        <Operation Caption="撤销确认" Key="BatchConfirm-R" RefKey="BatchConfirm-R"/>
        <Operation Caption="完成" Key="BatchFinish">
            <Action>
                <![CDATA[
				if(CheckListNoSelect()){
					Confirm(LocaleString('CommonDef','key5'),'OK','OK:{}');
					return true;
				}
				if(!CheckListSelectStatus(',200,')){
					Confirm(LocaleString('OwnerNull','key149'),'OK','OK:{}');
					return true;
				}
				Confirm(LocaleString('CommonDef','key7'),'YES_NO',{YES:{
					loop "ListView0" (true)
					{			
						if(Select == true)
						{ 
							InvokeService("LRP_BillStatusChange", false, false,"LRP_ExpenseStatement",OID,900,-1);							
							LoadData();ShowData();
						}					
					}
				},NO:{}});
				]]>
            </Action>
        </Operation>
        <Operation Caption="撤销完成" Key="BatchFinish-R">
            <Action>
                <![CDATA[
				if(CheckListNoSelect()){
					Confirm(LocaleString('CommonDef','key8'),'OK','OK:{}');
					return true;
				}
				if(!CheckListSelectStatus(',900,')){
					Confirm(LocaleString('CommonDef','key33'),'OK','OK:{}');
					return true;
				}	
				Confirm(LocaleString('CommonDef','key10'),'YES_NO',{YES:{
					loop "ListView0" (true)
					{			
						if(Select == true)
						{ 
							InvokeService("LRP_BillStatusChange", false, false,"LRP_ExpenseStatement",OID,200,-1);
							LoadData();ShowData();
						}					
					}
				},NO:{}});
				]]>
            </Action>
        </Operation>
        <Operation Caption="关闭界面" Key="Close" RefKey="Close"/>
    </OperationCollection>
    <Body>
        <Block>
            <FlexFlowLayoutPanel Key="main">
                <ToolBar Height="pref" Key="main_toolbar">
                    <ToolBarItemCollection/>
                </ToolBar>
                <SplitPanel Height="100%" Key="main_split" Orientation="Vertical">
                    <GridLayoutPanel Caption="GridLayoutPanel0" Key="GridLayoutPanel0" Padding="10px">
                        <TextEditor Caption="DataObjectKey" Enable="false" Key="DataObjectKey" Visible="false" X="0" Y="0">
                            <DataBinding DefaultValue="LRP_ExpenseStatement"/>
                        </TextEditor>
                        <TextEditor Caption="对账单号" Key="No_C" X="1" XSpan="2" Y="0">
                            <Condition CondSign="like">
                                <ConditionTarget TableKey="LRP_ExpenseStatement_H" ColumnKey="No"/>
                            </Condition>
                        </TextEditor>
                        <Label Caption="对账单号" Key="L_No" X="0" Y="0"/>
                        <Dict AllowMultiSelection="true" Caption="公司代码" ItemKey="CompanyCode" Key="CompanyCodeId_C" X="5" XSpan="2" Y="0">
                            <Condition CondSign="in">
                                <ConditionTarget TableKey="LRP_ExpenseStatement_H" ColumnKey="CompanyCodeId"/>
                            </Condition>
                        </Dict>
                        <Label Caption="公司代码" Key="L_CompanyCodeId" X="4" Y="0"/>
                        <TextEditor Caption="账单名称" Key="StatementName_C" X="1" XSpan="2" Y="1">
                            <Condition CondSign="like">
                                <ConditionTarget TableKey="LRP_ExpenseStatement_H" ColumnKey="StatementName"/>
                            </Condition>
                        </TextEditor>
                        <Label Caption="账单名称" Key="L_StatementName" X="0" Y="1"/>
                        <Dict AllowMultiSelection="true" Caption="结算方" ItemKey="Vendor" Key="SettlementId_C" X="5" XSpan="2" Y="1">
                            <Condition CondSign="in">
                                <ConditionTarget TableKey="LRP_ExpenseStatement_H" ColumnKey="SettlementId"/>
                            </Condition>
                        </Dict>
                        <Label Caption="结算方" Key="L_SettlementId" X="4" Y="1"/>
                        <Button Caption="查询" Key="Query" X="8" Y="0">
                            <OnClick>
                                <![CDATA[DealCondition();LoadData();ShowData();]]>
                            </OnClick>
                        </Button>
                        <Button Caption="重置" Key="Reset" X="8" Y="1">
                            <OnClick>
                                <![CDATA[ResetCondition();]]>
                            </OnClick>
                        </Button>
                        <Dict AllowMultiSelection="true" Caption="承运商" ItemKey="LRP_Carrier" Key="CarrierId_C" X="1" XSpan="2" Y="2">
                            <Condition CondSign="in">
                                <ConditionTarget TableKey="LRP_ExpenseStatement_H" ColumnKey="CarrierId"/>
                            </Condition>
                        </Dict>
                        <Label Caption="承运商" Key="L_CarrierId" X="0" Y="2"/>
                        <CheckListBox Caption="状态" Key="Status_C" X="5" XSpan="2" Y="2">
                            <Condition CondSign="in">
                                <ConditionTarget TableKey="LRP_ExpenseStatement_H" ColumnKey="Status"/>
                            </Condition>
                            <Item Caption="已输入" Key="prepared" Value="100"/>
                            <Item Caption="已确认" Key="confirmed" Value="200"/>
                            <Item Caption="已完成" Key="finished" Value="900"/>
                        </CheckListBox>
                        <Label Caption="状态" Key="L_Status" X="4" Y="2"/>
                        <RowDefCollection RowGap="8">
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="8">
                            <ColumnDef Width="77px"/>
                            <ColumnDef Width="100px"/>
                            <ColumnDef Width="50%" MinWidth="50px"/>
                            <ColumnDef Width="30px"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="100px"/>
                            <ColumnDef Width="50%" MinWidth="50px"/>
                            <ColumnDef Width="30px"/>
                            <ColumnDef Width="80px"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <ListView Caption="ListView0" Key="ListView0" TableKey="LRP_ExpenseStatement_H" PageLoadType="DB">
                        <ListViewColumnCollection>
                            <ListViewColumn Caption="对象标识" ColumnType="TextEditor" DataColumnKey="OID" Key="OID" Visible="false"/>
                            <ListViewColumn Caption="选择" ColumnType="CheckBox" Enable="true" IsSelect="true" Key="Select" ValueChanged="RefreshOperation();"/>
                            <ListViewColumn Caption="状态" ColumnType="ComboBox" DataColumnKey="Status" Key="Status" SourceType="Status"/>
                            <ListViewColumn Caption="对账单号" ColumnType="HyperLink" DataColumnKey="No" Key="No">
                                <OnClick>
                                    <![CDATA[
									
									Open('V_ExpenseStatement', OID);
									]]>
                                </OnClick>
                            </ListViewColumn>
                            <ListViewColumn Caption="账单名称" ColumnType="TextEditor" DataColumnKey="StatementName" Key="StatementName"/>
                            <ListViewColumn Caption="公司代码" ColumnType="Dict" DataColumnKey="CompanyCodeId" ItemKey="CompanyCode" Key="CompanyCodeId"/>
                            <ListViewColumn Caption="承运商" ColumnType="Dict" DataColumnKey="CarrierId" ItemKey="LRP_Carrier" Key="CarrierId"/>
                            <ListViewColumn Caption="结算方" ColumnType="Dict" DataColumnKey="SettlementId" ItemKey="Vendor" Key="SettlementId"/>
                            <ListViewColumn Caption="账单日期" ColumnType="DatePicker" DataColumnKey="OrderDate" Key="OrderDate" OnlyDate="true"/>
                            <ListViewColumn Caption="完成日期" ColumnType="DatePicker" DataColumnKey="FinishDate" Key="FinishDate" OnlyDate="true"/>
                            <ListViewColumn Caption="总金额" ColumnType="TextEditor" DataColumnKey="TotalAmount" Key="TotalAmount"/>
                        </ListViewColumnCollection>
                        <RowDblClick>
                            <![CDATA[
								Open('V_ExpenseStatement', OID);
						]]>
                        </RowDblClick>
                    </ListView>
                    <SplitSize Size="130px"/>
                    <SplitSize Size="100%"/>
                </SplitPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[
        
    ]]>
    </OnLoad>
</Form>
