<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Caption="引入对账单" FormType="View" Key="V_QuoteStatement">
    <DataSource RefObjectKey="LRP_QuoteStatement"/>
    <Body PopHeight="80%" PopWidth="80%">
        <Block>
            <FlexFlowLayoutPanel Caption="根面板" Key="root">
                <SplitPanel Caption="SplitPanel1" Height="100%" Key="SplitPanel1" Orientation="Vertical">
                    <GridLayoutPanel Caption="基本信息" Height="pref" Key="first_head" Padding="10px">
                        <Button Caption="查询" Enable="true" Key="Query" X="10" Y="0">
                            <OnClick>
                                <![CDATA[
								DealCondition();LoadData();ShowData();	
								]]>
                            </OnClick>
                        </Button>
                        <Button Caption="重置" Enable="true" Key="cancle" X="10" Y="1">
                            <OnClick>
                                <![CDATA[ResetCondition(); 
								SetValue("CompanyCodeId1",GetPara('CompanyCode_para'));
								SetValue("SettlementId1",GetPara('SettlementId_para'));	]]>
                            </OnClick>
                        </Button>
                        <Dict Key="CompanyCodeId1" Caption="公司" BuddyKey="Lab_CompanyCodeId1" X="1" Y="0" Enable="false" ItemKey="CompanyCode" XSpan="3">
                            <DataBinding DefaultFormulaValue="GetPara('CompanyCode_para')"/>
                            <Condition ColumnKey="CompanyCodeId" CondSign="=" TableKey="LRP_QuoteStatement"/>
                        </Dict>
                        <Label Key="Lab_CompanyCodeId1" Caption="公司" X="0" Y="0"/>
                        <Dict Key="SettlementId1" Caption="结算方" BuddyKey="Lab_SettlementId1" X="6" Y="0" Enable="false" ItemKey="Customer" XSpan="3">
                            <DataBinding DefaultFormulaValue="GetPara('SettlementId_para')"/>
                            <Condition ColumnKey="SettlementId" CondSign="=" TableKey="LRP_QuoteStatement"/>
                        </Dict>
                        <Label Key="Lab_SettlementId1" Caption="结算方" X="5" Y="0"/>
                        <DatePicker Key="OrderDate1" Caption="对账单日期" BuddyKey="Lab_OrderDate1" X="1" Y="1" XSpan="3">
                            <Condition ColumnKey="OrderDate" CondSign="between" TableKey="LRP_QuoteStatement" GroupHead="true"/>
                        </DatePicker>
                        <Label Key="Lab_OrderDate1" Caption="对账单日期" X="0" Y="1"/>
                        <DatePicker Key="OrderDate2" Caption="到" BuddyKey="Lab_OrderDate2" X="6" Y="1" XSpan="3">
                            <Condition ColumnKey="OrderDate" CondSign="in" TableKey="LRP_QuoteStatement" GroupTail="true"/>
                        </DatePicker>
                        <Label Key="Lab_OrderDate2" Caption="到" X="5" Y="1"/>
                        <TextEditor Key="No1" Caption="对账单号" BuddyKey="Lab_No1" X="1" Y="2" XSpan="3">
                            <Condition ColumnKey="No" CondSign="like" TableKey="LRP_QuoteStatement"/>
                        </TextEditor>
                        <Label Key="Lab_No1" Caption="对账单号" X="0" Y="2"/>
                        <Dict Key="IncomeId1" Caption="收入名称" BuddyKey="Lab_IncomeId1" X="6" Y="2" ItemKey="LRP_Income" XSpan="3">
                            <Condition ColumnKey="IncomeId" CondSign="=" TableKey="LRP_QuoteStatement"/>
                        </Dict>
                        <Label Key="Lab_IncomeId1" Caption="收入名称" X="5" Y="2"/>
                        <RowDefCollection RowGap="8">
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="8">
                            <ColumnDef Width="77px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="30px"/>
                            <ColumnDef Width="80px"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <Grid Caption="Grid0" Height="pref" Key="Grid0" NewEmptyRow="false" PageLoadType="DB" CanDelete="false" CanInsert="false" CanShift="false">
                        <GridColumnCollection>
                            <GridColumn Caption="选择" Key="Select" Width="100px"/>
                            <GridColumn Key="No" Caption="对账单号" Width="150px"/>
                            <GridColumn Key="OrderDate" Caption="对账单日期" Width="150px"/>
                            <GridColumn Key="Status" Caption="对账单状态" Width="100px" Visible="false"/>
                            <GridColumn Key="CompanyCodeId" Caption="公司" Width="100px" Visible="false"/>
                            <GridColumn Key="SettlementId" Caption="结算方" Width="100px" Visible="false"/>
                            <GridColumn Key="WarehouseCenterId" Caption="仓储中心" Width="100px"/>
                            <GridColumn Key="DispatchOrgId" Caption="调度组织" Width="100px"/>
                            <GridColumn Key="IncomeId" Caption="收入名称" Width="100px"/>
                            <GridColumn Key="CalculationAmount" Caption="计算金额" Width="100px"/>
                            <GridColumn Key="AdjustAmount" Caption="实际金额" Width="100px"/>
                        </GridColumnCollection>
                        <GridRowCollection>
                            <GridRow Key="row1" RowHeight="35" TableKey="LRP_QuoteStatement">
                                <GridCell Caption="选择" CellType="CheckBox" IsSelect="true" Key="Select">
                                    <DataBinding/>
                                </GridCell>
                                <GridCell Key="No" Caption="对账单号" CellType="TextEditor">
                                    <DataBinding ColumnKey="No"/>
                                </GridCell>
                                <GridCell Key="OrderDate" Caption="对账单日期" CellType="DatePicker">
                                    <DataBinding ColumnKey="OrderDate"/>
                                </GridCell>
                                <GridCell Key="Status" Caption="对账单状态" CellType="ComboBox" Enable="false" SourceType="Status" IntegerValue="true">
                                    <DataBinding ColumnKey="Status"/>
                                </GridCell>
                                <GridCell Key="CompanyCodeId" Caption="公司" CellType="Dict" Enable="false" ItemKey="CompanyCode">
                                    <DataBinding ColumnKey="CompanyCodeId"/>
                                </GridCell>
                                <GridCell Key="SettlementId" Caption="结算方" CellType="Dict" ItemKey="Customer">
                                    <DataBinding ColumnKey="SettlementId"/>
                                </GridCell>
                                <GridCell Key="WarehouseCenterId" Caption="仓储中心" CellType="Dict" ItemKey="LRP_WarehouseCenter">
                                    <DataBinding ColumnKey="WarehouseCenterId"/>
                                </GridCell>
                                <GridCell Key="DispatchOrgId" Caption="调度组织" CellType="Dict" ItemKey="LRP_DispatchOrg">
                                    <DataBinding ColumnKey="DispatchOrgId"/>
                                </GridCell>
                                <GridCell Key="IncomeId" Caption="收入名称" CellType="Dict" ItemKey="LRP_Income">
                                    <DataBinding ColumnKey="IncomeId"/>
                                </GridCell>
                                <GridCell Key="CalculationAmount" Caption="计算金额" CellType="NumberEditor" Precision="18" Scale="6">
                                    <DataBinding ColumnKey="CalculationAmount"/>
                                </GridCell>
                                <GridCell Key="AdjustAmount" Caption="实际金额" CellType="NumberEditor" Precision="18" Scale="6">
                                    <DataBinding ColumnKey="AdjustAmount"/>
                                </GridCell>
                            </GridRow>
                        </GridRowCollection>
                    </Grid>
                    <GridLayoutPanel Caption="GridLayoutPanel1" Key="GridLayoutPanel1">
                        <Button Caption="确定" Key="OK" X="1" Y="0">
                            <OnClick>
                                <![CDATA[var count = GetRowCount('Grid0',false);
											var flag=0;
											var i=0;
											  
											//遍历表格,是否有被勾选的明细行,有:flag=1
											while ( i < count ) {
												if(ToInt(GetCellValue('Grid0',i,'Select'))==1){
												  flag=1;
												  break;
												}
												i=i+1;
											  }
											  
											//没有被勾选的明细行,弹出警告
											if(flag==0){
												Confirm(LocaleString('ReceivableAnd','key21'),'OK','OK:{}');
											  }
											  
											//有被勾选的明细行,下推明细行
											if(flag==1){
												//字符串需要加Parent
												IIFS(
					GetPara("pFormKey")=="V_InvoiceReceiveable",ViewMap('Statement-InvoiceReceiveable',false),
				    GetPara("pFormKey")=="V_ReceiptByStatement",ViewMap('Statement-Receipt',false)
												     
												);
								
											Close();
			       }]]>
                            </OnClick>
                        </Button>
                        <Button Caption="取消" Key="Cancle" X="2" Y="0">
                            <OnClick>
                                <![CDATA[Close();]]>
                            </OnClick>
                        </Button>
                        <RowDefCollection RowGap="5">
                            <RowDef Height="30px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="5">
                            <ColumnDef Width="100%"/>
                            <ColumnDef Width="80px"/>
                            <ColumnDef Width="80px"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <SplitSize Size="150px"/>
                    <SplitSize Size="100%"/>
                    <SplitSize Size="50px"/>
                </SplitPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[
	]]>
    </OnLoad>
</Form>
