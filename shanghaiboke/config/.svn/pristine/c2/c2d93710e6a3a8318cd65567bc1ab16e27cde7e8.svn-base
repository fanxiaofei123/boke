<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Caption="审批记录" FormType="Normal" Key="WFLog" PreferSize="1000px,600px">
<DataSource>
		<DataObject Key="BPM_Log" NoPrefix="STIN" Caption="审批记录" PrimaryTableKey="BPM_Log" PrimaryType="Entity" SecondaryType="Normal">
			<TableCollection>
				<Table Key="BPM_Log" Caption="基本信息" DBTableName="BPM_Log" TableMode="Head" SourceType="Query" Persist="True">
					<TableFilter>
						<![CDATA[
workItemID in(select workitemID from BPM_WorkitemInfo where instanceID=(select instanceID from BPM_Instance where OID=?))
						]]>
					</TableFilter>
					<ParameterCollection>
						<Parameter Key="OID"  Caption="标识" TargetColumn="workItemID" Formula="Para('POID')" />
					</ParameterCollection>
					<Statement>
						<![CDATA[select workItemID,workItemName,creatTime,finishTime,operatorID,auditResult,userInfo from BPM_Log]]>
					</Statement>
					<Column Key="workItemID" Caption="工作项标识" Persist="True" DataType="Long" DBColumnName="workItemID" />
					<Column Key="workItemName" Caption="父对象标识" Persist="True" DataType="Varchar" Length="200" DBColumnName="workItemName"/>
					<Column Key="creatTime" Caption="创建时间" Persist="True" DataType="DateTime" DBColumnName="creatTime"/>
					<Column Key="finishTime" Caption="提交时间" Persist="True" DataType="DateTime" DBColumnName="finishTime"/>
					<Column Key="operatorID" Caption="人员" Persist="True" DataType="Integer" DBColumnName="operatorID"/>
					<Column Key="userInfo"  Caption="审批意见" Persist="True" DataType="Varchar" Length="200" DBColumnName="userInfo"/>
					<Column Key="auditResult" Caption="审批结果" Persist="True" DataType="Integer" DBColumnName="auditResult"/>
				</Table>
			</TableCollection> 
		</DataObject>
	</DataSource>
	<OperationCollection>
	</OperationCollection>
	<OnLoad type="Formula">
		<![CDATA[LoadData();
  ]]>
	</OnLoad>
	<FormParaCollection>
		<FormPara Key="POID" Type="Formula" Formula="GetParentOID()"/>
	</FormParaCollection>
    <Body HAlign="Left" OverflowX="Visible" OverflowY="Visible" PopWidth="700px" PopHeight="500px">
        <Block>
			<GridLayoutPanel Key="main">
				<RowDefCollection RowHeight="30" RowGap="3">
					<RowDef Height="30%"/>
					<RowDef Height="70%"/>
				</RowDefCollection>
				<ColumnDefCollection>
					<ColumnDef Width="100%"/>
				</ColumnDefCollection>
				<Grid Key="detail_grid" Caption="入库单明细" PageLoadType="UI" PageRowCount="6" ShowRowHead="true" Enable="False" X="0" XSpan="1" Y="0" YSpan="1">
					<GridColumnCollection> 
						<GridColumn Key="workItemID" Caption="工作项标识" Width="79px" ColumnExpand="false" ColumnType="Detail"/>
						<GridColumn Key="workItemName" Caption="父对象标识" Width="79px" ColumnExpand="false" ColumnType="Detail"/>
						<GridColumn Key="creatTime" Caption="创建时间" Width="160px" ColumnExpand="false" ColumnType="Detail"/>
						<GridColumn Key="finishTime" Caption="提交时间" Width="160px" ColumnExpand="false" ColumnType="Detail"/>
						<GridColumn Key="operatorID" Caption="人员" Width="50px" ColumnExpand="false" ColumnType="Detail"/>
						<GridColumn Key="auditResult" Caption="审批结果" Width="65px" ColumnExpand="false" ColumnType="Detail"/>
						<GridColumn Key="userInfo" Caption="审批意见" Width="79px" ColumnExpand="false" ColumnType="Detail"/>
						<GridColumn Key="Rollback" Caption="撤销" Width="79px" ColumnExpand="false" ColumnType="Detail" Enable="true"/>
					</GridColumnCollection>
					<GridRowCollection>
						<GridRow Key="R1" RowType="Detail"  TableKey="BPM_Log" GroupKey="Area">  
							<GridCell Key="workItemID" Caption="工作项标识" CellType="NumberEditor">
								<DataBinding ColumnKey="workItemID"/>
							</GridCell>
							<GridCell Key="workItemName" Caption="父对象标识" CellType="LABEL">
								<DataBinding ColumnKey="workItemName"/>
							</GridCell>
							<GridCell Key="creatTime" Caption="创建时间" CellType="DatePicker">
								<DataBinding ColumnKey="creatTime"/>
							</GridCell>
							<GridCell Key="finishTime" Caption="提交时间" CellType="DatePicker" >
								<DataBinding ColumnKey="finishTime"/>
							</GridCell>
							<GridCell Key="operatorID" Caption="人员" CellType="NumberEditor">
								<DataBinding ColumnKey="operatorID"/>
							</GridCell>
							<GridCell Key="auditResult" Caption="审批结果" CellType="ComboBox"  >
								<DataBinding ColumnKey="auditResult"/>
								<Item Caption="通过" Key="1" Value="1"/>
								<Item Caption="驳回" Key="0" Value="0"/>
							</GridCell>
							<GridCell Key="userInfo" Caption="审批意见" CellType="LABEL">
								<DataBinding ColumnKey="userInfo"/>
							</GridCell>
							<GridCell Key="Rollback" Caption="撤销" CellType="Button" ShowText="撤销a"  Enable="true">
								<OnClick>
									<![CDATA[RollbackToWorkitem(workItemID);]]>
								</OnClick>
							</GridCell>
							
						</GridRow>   
					</GridRowCollection>
				</Grid>
				<BPMGraph Key="graph" Caption="流程图" ProcessKey="parent.GetProcessKey()" ProcessVer="parent.GetProcessVer()" X="0" XSpan="1" Y="1" YSpan="1">
				</BPMGraph>
			</GridLayoutPanel>
        </Block>
    </Body>
</Form>
