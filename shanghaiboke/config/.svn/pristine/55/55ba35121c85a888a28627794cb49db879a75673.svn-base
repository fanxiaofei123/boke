<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Caption="引入出库订单" FormType="View" Key="V_QuoteOutboundNoticeView">
    <DataSource>
        <DataObject Caption="引入出库订单" Key="V_QuoteOutboundNoticeView" PrimaryTableKey="LRP_OutboundNotice_H">
            <TableCollection>
                <Table Caption="引入库存" Key="LRP_OutboundNotice_H" SourceType="Query" TableMode="Detail">
                    <Column Caption="对象标识" DataType="Long" Key="OID"/>
                    <Column Caption="主对象标识" DataType="Long" Key="SOID"/>
                    <Column Caption="父对象标识" DataType="Long" Key="POID"/>
                    <Column Caption="对象版本" DataType="Integer" Key="VERID"/>
                    <Column Caption="对象明细版本" DataType="Integer" Key="DVERID"/>
                    <Column Caption="状态" DataType="Integer" Key="Status"/>
                    <Column Caption="创建人" DataType="Long" Key="CREATOR"/>
                    <Column Caption="创建时间" DataType="DateTime" Key="CREATETIME"/>
                    <Column Caption="修改人" DataType="Long" Key="MODIFIER"/>
                    <Column Caption="修改时间" DataType="DateTime" Key="MODIFYTIME"/>
                    <Column Caption="通知单号" DataType="Varchar" Key="No" Length="100"/>
                    <Column Caption="货主单号" DataType="Varchar" Key="OwnerNo" Length="100"/>
                    <Column Caption="仓储中心id" DataType="Long" Key="WarehouseCenterId"/>
                    <Column Caption="货主id" DataType="Long" Key="OwnerId"/>
                    <Column Caption="预计发货日期时间起" DataType="DateTime" Key="ExpectDateTimeFrom"/>
                    <Column Caption="预计发货日期时间至" DataType="DateTime" Key="ExpectDateTimeTo"/>
                    <Column Caption="收货方" DataType="Long" Key="RecvPartyId"/>
                    <Column Caption="收货方名称" DataType="Varchar" Key="RecvPartyName" Length="100"/>
                    <Column Caption="省" DataType="Long" Key="ProvinceId"/>
                    <Column Caption="市" DataType="Long" Key="CityId"/>
                    <Column Caption="区" DataType="Long" Key="DistrictId"/>
                    <Column Caption="地址" DataType="Varchar" Key="Address" Length="100"/>
                    <Column Caption="联系人" DataType="Varchar" Key="Contactor" Length="100"/>
                    <Column Caption="联系人电话" DataType="Varchar" Key="ContactTel" Length="100"/>
                    <Column Caption="联系人电邮" DataType="Varchar" Key="ContactEmail" Length="100"/>
                    <Column Caption="承运方" DataType="Long" Key="CarrierId"/>
                    <Column Caption="承运方联系人" DataType="Varchar" Key="CarrierContactor" Length="100"/>
                    <Column Caption="承运方联系电话" DataType="Varchar" Key="CarrierTel" Length="100"/>
                    <Column Caption="运单号" DataType="Varchar" Key="WaybillNo" Length="100"/>
                    <Column Caption="电商订单类型" DataType="Integer" Key="ECOrderType"/>
                    <Column Caption="面单打印方式" DataType="Integer" Key="ECPrintType"/>
                    <Column Caption="电商开票类型" DataType="Integer" Key="ECInvoiceType"/>
                    <Column Caption="总重量" DataType="Numeric" Key="TotalWeight" Precision="18" Scale="6"/>
                    <Column Caption="总体积" DataType="Numeric" Key="TotalCubage" Precision="18" Scale="6"/>
                    <Column Caption="换货" DataType="Integer" Key="IsExchange"/>
                    <Column Caption="退货通知单号" DataType="Varchar" Key="ReturnNoticeNo" Length="100"/>
                    <Column Caption="分配库存允许缺货" DataType="Integer" DefaultValue="1" Key="PickAllowLack"/>
                    <Column Caption="备注" DataType="Varchar" Key="Remark" Length="1000"/>
                    <Column Caption="订单生成方式" DataType="Integer" DefaultValue="1" Key="GenMethod"/>
                    <Statement>
                        <![CDATA[select * from (select * from LRP_OutboundNotice_H where Status=200)a]]>
                    </Statement>
                </Table>
            </TableCollection>
            <OIDFilter/>
        </DataObject>
    </DataSource>
    <Body PopHeight="80%" PopWidth="80%">
        <Block>
            <FlexFlowLayoutPanel Caption="根面板" Key="root">
                <ToolBar Caption="ToolBar1" Height="pref" Key="ToolBar1">
                    <ToolBarItemCollection/>
                </ToolBar>
                <SplitPanel Caption="SplitPanel1" Height="100%" Key="SplitPanel1" Orientation="Vertical">
                    <GridLayoutPanel Caption="基本信息" Height="pref" Key="first_head" Padding="5px">
                        <DatePicker Caption="创建日期时间" Key="CREATETIME_C" X="1" XSpan="3" Y="0" BuddyKey="L_CREATETIME">
                            <DataBinding DefaultFormulaValue="Format(ServerDate(),'yyyy-MM-dd')&amp;' 00:00:00'"/>
                            <Condition ColumnKey="CREATETIME" CondSign="between" TableKey="LRP_OutboundNotice_H" Group="CREATETIME" GroupHead="true">
                                <ConditionTarget TableKey="LRP_OutboundNotice_H" ColumnKey="CREATETIME"/>
                            </Condition>
                        </DatePicker>
                        <Label Caption="创建日期时间" Key="L_CREATETIME" X="0" Y="0"/>
                        <DatePicker Caption="至" Key="CREATETIME_C_1" X="6" XSpan="3" Y="0" BuddyKey="L_CREATETIME_1">
                            <DataBinding DefaultFormulaValue="Format(ServerDate(),'yyyy-MM-dd')&amp;' 23:59:59'"/>
                            <Condition CondSign="none" Group="CREATETIME" GroupTail="true">
                                <ConditionTarget TableKey="LRP_OutboundNotice_H" ColumnKey="CREATETIME"/>
                            </Condition>
                        </DatePicker>
                        <Label Caption="至" Key="L_CREATETIME_1" X="5" Y="0"/>
                        <CheckListBox BuddyKey="Lab_ECOrderType_C" Caption="电商订单类型" Key="ECOrderType_C" X="1" XSpan="3" Y="2">
                            <Condition ColumnKey="ECOrderType" CondSign="in" TableKey="LRP_OutboundNotice_H"/>
                            <Item Caption="单品单件" Key="1" Value="1"/>
                            <Item Caption="单品多件" Key="2" Value="2"/>
                            <Item Caption="多品多件" Key="3" Value="3"/>
                        </CheckListBox>
                        <Label Caption="电商订单类型" Key="Lab_ECOrderType_C" X="0" Y="2"/>
                        <CheckListBox BuddyKey="Lab_ECPrintType_C" Caption="面单打印方式" Key="ECPrintType_C" X="6" XSpan="3" Y="2">
                            <Condition ColumnKey="ECPrintType" CondSign="in" TableKey="LRP_OutboundNotice_H"/>
                            <Item Caption="pre 前置 " Key="1" Value="1"/>
                            <Item Caption="post 后置" Key="2" Value="2"/>
                        </CheckListBox>
                        <Label Caption="面单打印方式" Key="Lab_ECPrintType_C" X="5" Y="2"/>
                        <CheckListBox BuddyKey="Lab_ECInvoiceType_C" Caption="开票类型" Key="ECInvoiceType_C" X="1" XSpan="3" Y="3">
                            <Condition ColumnKey="ECInvoiceType" CondSign="in" TableKey="LRP_OutboundNotice_H"/>
                            <Item Caption="不开票 " Key="0" Value="0"/>
                            <Item Caption="普通发票 " Key="1" Value="1"/>
                            <Item Caption="增值税发票 " Key="2" Value="2"/>
                            <Item Caption="电子发票 " Key="3" Value="3"/>
                            <Item Caption="促销 " Key="4" Value="4"/>
                            <Item Caption="秒杀" Key="5" Value="5"/>
                        </CheckListBox>
                        <Label Caption="开票类型" Key="Lab_ECInvoiceType_C" X="0" Y="3"/>
                        <Dict BuddyKey="Lab_WarehouseCenterId" Caption="仓储中心" ItemKey="LRP_WarehouseCenter" Key="WarehouseCenterId" Visible="false" X="1" XSpan="3" Y="4">
                            <Condition ColumnKey="WarehouseCenterId" CondSign="=" TableKey="LRP_OutboundNotice_H"/>
                        </Dict>
                        <Label Caption="仓储中心" Key="Lab_WarehouseCenterId" Visible="false" X="0" Y="4"/>
                        <Dict BuddyKey="Lab_OwnerId" Caption="货主" ItemKey="LRP_Owner" Key="OwnerId" Visible="false" X="6" XSpan="3" Y="4">
                            <Condition ColumnKey="OwnerId" CondSign="=" TableKey="LRP_OutboundNotice_H"/>
                        </Dict>
                        <Label Caption="货主" Key="Lab_OwnerId" X="5" Y="4"/>
                        <Dict Key="CarrierId_C" Caption="承运方" BuddyKey="Lab_CarrierId_C" X="6" Y="1" ItemKey="LRP_Carrier" XSpan="3">
                            <Condition ColumnKey="CarrierId" CondSign="=" TableKey="LRP_OutboundNotice_H"/>
                        </Dict>
                        <Label Key="Lab_CarrierId_C" Caption="承运方" X="5" Y="1"/>
                        <GridLayoutPanel Caption="收货方地址" Key="RecvAddr" X="0" XSpan="4" Y="1">
                            <Dict BuddyKey="Lab_ProvinceId_C" Caption="省" ItemKey="LRP_Province" Key="ProvinceId_C" X="1" Y="0">
                                <Condition ColumnKey="ProvinceId" CondSign="=" TableKey="LRP_OutboundNotice_H"/>
                            </Dict>
                            <Label Caption="省" Key="Lab_ProvinceId_C" X="0" Y="0"/>
                            <Dict Key="CityId_C" Caption="市" BuddyKey="Lab_CityId_C" X="3" Y="0" ItemKey="LRP_City">
                                <Condition ColumnKey="CityId" CondSign="=" TableKey="LRP_OutboundNotice_H"/>
                            </Dict>
                            <Label Caption="市" Key="Lab_CityId_C" X="2" Y="0"/>
                            <Dict BuddyKey="Lab_DistrictId_C" Caption="区" ItemKey="LRP_District" Key="DistrictId_C" X="5" Y="0">
                                <Condition ColumnKey="DistrictId" CondSign="=" TableKey="LRP_OutboundNotice_H"/>
                            </Dict>
                            <Label Caption="区" Key="Lab_DistrictId_C" X="4" Y="0"/>
                            <RowDefCollection RowGap="1">
                                <RowDef Height="100%"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="8">
                                <ColumnDef Width="20px"/>
                                <ColumnDef Width="33%" MinWidth="20px"/>
                                <ColumnDef Width="20px"/>
                                <ColumnDef Width="33%" MinWidth="20px"/>
                                <ColumnDef Width="40px"/>
                                <ColumnDef Width="33%" MinWidth="20px"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                        <Button Caption="查询" Enable="true" Key="Query" X="10" Y="0">
                            <OnClick>
                                <![CDATA[
								DealCondition();LoadData();ShowData();	
								]]>
                            </OnClick>
                        </Button>
                        <Button Caption="重置" Enable="true" Key="cancle" X="10" Y="1">
                            <OnClick>
                                <![CDATA[
								ResetCondition(); 
								SetValue("WarehouseCenterId",GetPara('WarehouseCenterId_para'));
								SetValue("OwnerId",GetPara('OwnerId_para'));			
								]]>
                            </OnClick>
                        </Button>
                        <RowDefCollection RowGap="8">
                            <RowDef Height="25px"/>
                            <RowDef Height="25px"/>
                            <RowDef Height="25px"/>
                            <RowDef Height="25px"/>
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="8">
                            <ColumnDef Width="100px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="100px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="30px"/>
                            <ColumnDef Width="80px"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <Grid Caption="Grid0" Height="pref" Key="Grid0" NewEmptyRow="false" PageLoadType="UI" PageRowCount="10" RowAlterable="false">
                        <GridColumnCollection>
                            <GridColumn Caption="选择" Key="Select" Width="80px" Sortable="true"/>
                            <GridColumn Caption="出库订单ID" Key="OID" Visible="false" Width="80px" Sortable="true"/>
                            <GridColumn Caption="出库订单号" Key="No" Width="80px" Sortable="true"/>
                            <GridColumn Caption="货主单号" Key="OwnerNo" Width="80px" Sortable="true"/>
                            <GridColumn Caption="创建日期" Key="CREATETIME" Width="80px" Sortable="true"/>
                            <GridColumn Caption="省" Key="ProvinceId" Width="80px" Sortable="true"/>
                            <GridColumn Caption="市" Key="CityId" Width="80px" Sortable="true"/>
                            <GridColumn Caption="区" Key="DistrictId" Width="80px" Sortable="true"/>
                            <GridColumn Caption="收货方" Key="RecvPartyName" Width="80px" Sortable="true"/>
                            <GridColumn Caption="电商订单类型" Key="ECOrderType" Width="80px" Sortable="true"/>
                            <GridColumn Caption="面单打印方式" Key="ECPrintType" Width="80px" Sortable="true"/>
                            <GridColumn Caption="开票类型" Key="ECInvoiceType" Width="80px" Sortable="true"/>
                        </GridColumnCollection>
                        <GridRowCollection>
                            <GridRow Key="row1" RowHeight="35" TableKey="LRP_OutboundNotice_H">
                                <GridCell Caption="选择" CellType="CheckBox" IsSelect="true" Key="Select"/>
                                <GridCell Caption="出库订单ID" CellType="TextEditor" Enable="false" Key="OID">
                                    <DataBinding ColumnKey="OID"/>
                                </GridCell>
                                <GridCell Caption="出库订单号" CellType="TextEditor" Enable="false" Key="No">
                                    <DataBinding ColumnKey="No"/>
                                </GridCell>
                                <GridCell Caption="货主单号" CellType="TextEditor" Enable="false" Key="OwnerNo">
                                    <DataBinding ColumnKey="OwnerNo"/>
                                </GridCell>
                                <GridCell Caption="创建日期" CellType="DatePicker" Enable="false" Key="CREATETIME">
                                    <DataBinding ColumnKey="CREATETIME"/>
                                </GridCell>
                                <GridCell Caption="省" CellType="Dict" Enable="false" Key="ProvinceId" ItemKey="LRP_Province">
                                    <DataBinding ColumnKey="ProvinceId"/>
                                </GridCell>
                                <GridCell Caption="市" CellType="Dict" Enable="false" Key="CityId" ItemKey="LRP_City">
                                    <DataBinding ColumnKey="CityId"/>
                                </GridCell>
                                <GridCell Caption="区" CellType="Dict" Enable="false" Key="DistrictId" ItemKey="LRP_District">
                                    <DataBinding ColumnKey="DistrictId"/>
                                </GridCell>
                                <GridCell Caption="收货方" CellType="TextEditor" Enable="false" Key="RecvPartyName">
                                    <DataBinding ColumnKey="RecvPartyName"/>
                                </GridCell>
                                <GridCell Caption="电商订单类型" CellType="ComboBox" Enable="false" Key="ECOrderType">
                                    <DataBinding ColumnKey="ECOrderType"/>
                                    <Item Caption="单品单件" Key="1" Value="1"/>
                                    <Item Caption="单品多件" Key="2" Value="2"/>
                                    <Item Caption="多品多件" Key="3" Value="3"/>
                                </GridCell>
                                <GridCell Caption="面单打印方式" CellType="ComboBox" Enable="false" Key="ECPrintType">
                                    <DataBinding ColumnKey="ECPrintType"/>
                                    <Item Caption="pre 前置 " Key="1" Value="1"/>
                                    <Item Caption="post 后置" Key="2" Value="2"/>
                                </GridCell>
                                <GridCell Caption="开票类型" CellType="ComboBox" Enable="false" Key="ECInvoiceType">
                                    <DataBinding ColumnKey="ECInvoiceType"/>
                                    <Item Caption="不开票 " Key="0" Value="0"/>
                                    <Item Caption="普通发票 " Key="1" Value="1"/>
                                    <Item Caption="增值税发票 " Key="2" Value="2"/>
                                    <Item Caption="电子发票 " Key="3" Value="3"/>
                                    <Item Caption="促销 " Key="4" Value="4"/>
                                    <Item Caption="秒杀" Key="5" Value="5"/>
                                </GridCell>
                            </GridRow>
                        </GridRowCollection>
                    </Grid>
                    <GridLayoutPanel Caption="GridLayoutPanel1" Key="GridLayoutPanel1">
                        <Button Caption="确定" Key="OK" X="1" Y="0">
                            <OnClick>
                                <![CDATA[
									var count = GetRowCount('Grid0',false);
									var parentGridCount = Parent.GetRowCount('Grid1',false);
									var i=0;
									var b = false;
									var bselect = false;
											  
									//遍历表格,是否有被勾选的明细行
									while ( i < count ){
										//设置当前行
										SetRowIndex('Grid0', i);
										if(ToInt(Select)==1){
											bselect = true;
											var j=0;	
											var noexist = true;
											//检查父窗口是否已经有引用该单据
											while ( j < parentGridCount ){
												if(ToString(OID)==ToString(parent.GetCellValue('Grid1', j,'NoticeLineSOID'))){
													noexist = false;
													j = parentGridCount;
												}
												j = j+1;
											}
											if(noexist==true){
												//在父窗口插入一条记录
												b = true;
												var index = parent.InsertRow('Grid1',-1);
												parent.SetCellValue('Grid1', index,'NoticeLineSOID',OID);
												parent.SetCellValue('Grid1', index,'NoticeLineNo',No);
												parent.SetCellValue('Grid1', index,'OwnerNo',OwnerNo);
												parent.SetCellValue('Grid1', index,'CREATETIME',CREATETIME);
												parent.SetCellValue('Grid1', index,'ProvinceId',ProvinceId);
												parent.SetCellValue('Grid1', index,'CityId',CityId);
												parent.SetCellValue('Grid1', index,'DistrictId',DistrictId);
												parent.SetCellValue('Grid1', index,'RecvPartyName',RecvPartyName);
												parent.SetCellValue('Grid1', index,'ECOrderType',ECOrderType);
												parent.SetCellValue('Grid1', index,'ECPrintType',ECPrintType);
												parent.SetCellValue('Grid1', index,'ECInvoiceType',ECInvoiceType);
											}
										}
										i=i+1;
									}
									if(b){
										parent.RefreshOutboundNoticeQuantDetails();
									}
									if(!bselect){
										Confirm(LocaleString('OwnerNull','key120'),'OK','OK:{}');
									}
									else{
										Close();
									}
								]]>
                            </OnClick>
                        </Button>
                        <Button Caption="取消" Key="Cancle" X="2" Y="0">
                            <OnClick>
                                <![CDATA[Close();]]>
                            </OnClick>
                        </Button>
                        <RowDefCollection RowGap="5">
                            <RowDef Height="30px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="5">
                            <ColumnDef Width="100%"/>
                            <ColumnDef Width="80px"/>
                            <ColumnDef Width="80px"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <SplitSize Size="150px"/>
                    <SplitSize Size="100%"/>
                    <SplitSize Size="50px"/>
                </SplitPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[
		SetValue("WarehouseCenterId",GetPara('WarehouseCenterId_para'));
		SetValue("OwnerId",GetPara('OwnerId_para'));
	]]>
    </OnLoad>
</Form>
