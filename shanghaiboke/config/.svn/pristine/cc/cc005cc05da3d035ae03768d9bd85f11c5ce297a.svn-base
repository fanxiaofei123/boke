<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="MyRoute">
    <DataSource>
        <DataObject Caption="用户常用路线" Key="LRP_OwnerUserRouteView" PrimaryTableKey="LRP_OwnerUserRoute_H">
            <TableCollection>
                <Table Caption="用户常用路线头" Key="LRP_OwnerUserRoute_H" DBTableName="LRP_OwnerUserRoute_H" SourceType="Query" Persist="false">
                    <Column Caption="对象标识" DataType="Long" Key="OID"/>
                    <Column Caption="主对象标识" DataType="Long" Key="SOID"/>
                    <Column Caption="父对象标识" DataType="Long" Key="POID"/>
                    <Column Caption="对象版本" DataType="Integer" Key="VERID"/>
                    <Column Caption="对象明细版本" DataType="Integer" Key="DVERID"/>
                    <Column Caption="状态" DataType="Integer" Key="Status"/>
                    <Column Caption="创建人" DataType="Long" Key="CREATOR"/>
                    <Column Caption="创建时间" DataType="DateTime" Key="CREATETIME"/>
                    <Column Caption="修改人" DataType="Long" Key="MODIFIER"/>
                    <Column Caption="修改时间" DataType="DateTime" Key="MODIFYTIME"/>
                    <Column Caption="货主用户" DataType="Long" Key="OwnerUserId"/>
                    <Column Caption="单号" DataType="Varchar" Key="No" Length="100"/>
                    <Column Caption="路线名称" DataType="Varchar" Key="RouteName" Length="40"/>
                    <Column Caption="起点名称" DataType="Varchar" Key="StartName" Length="100"/>
                    <Column Caption="起运省" DataType="Long" Key="StartProvinceId"/>
                    <Column Caption="起运市" DataType="Long" Key="StartCityId"/>
                    <Column Caption="起运区县" DataType="Long" Key="StartDistrictId"/>
                    <Column Caption="起运地址" Key="StartAddress" DataType="Varchar" Length="100"/>
                    <Column Caption="起运联系人" Key="StartContactor" DataType="Varchar" Length="100"/>
                    <Column Caption="起运联系人手机" Key="StartContactMobile" DataType="Varchar" Length="100"/>
                    <Column Caption="终点名称" DataType="Varchar" Key="DestName" Length="100"/>
                    <Column Caption="终点省" DataType="Long" Key="DestProvinceId"/>
                    <Column Caption="终点市" DataType="Long" Key="DestCityId"/>
                    <Column Caption="终点区县" DataType="Long" Key="DestDistrictId"/>
                    <Column Caption="终点地址" Key="DestAddress" DataType="Varchar" Length="100"/>
                    <Column Caption="终点联系人" Key="DestContactor" DataType="Varchar" Length="100"/>
                    <Column Caption="终点联系人手机" Key="DestContactMobile" DataType="Varchar" Length="100"/>
                    <TableFilter>
                        <![CDATA[LRP_OwnerUserRoute_H.OwnerUserId=?]]>
                    </TableFilter>
                    <ParameterCollection>
                        <Parameter DataType="Long" Formula="GetUserOperator()"/>
                    </ParameterCollection>
                </Table>
            </TableCollection>
            <OIDFilter/>
        </DataObject>
    </DataSource>
    <QueryCollection>
        <Query Key="DeleteUserRouteH" Description="删除选中的路线头">
            <Statement>
                <![CDATA[
					delete from LRP_OwnerUserRoute_H where OID=?
				]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Long"/>
            </ParameterCollection>
        </Query>
        <Query Key="DeleteUserRouteL" Description="删除选中的路线明细">
            <Statement>
                <![CDATA[
					delete from LRP_OwnerUserRoute_L where SOID=?
				]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Long"/>
            </ParameterCollection>
        </Query>
    </QueryCollection>
    <Body>
        <Block>
            <GridLayoutPanel Key="root">
                <Format BackColor="#f1f3f8"/>
                <TableView Key="RouteName_table" X="0" Y="0">
                    <Format BackColor="#f1f3f8"/>
                    <TableRowCollection>
                        <TableRow Key="Routelist" SeparatorStyle="none none none none" RowType="Detail" SeparatorColor="#dde0e7" TableKey="LRP_OwnerUserRoute_H">
                            <GridLayoutPanel Key="GridLayoutPanel3" Caption="GridLayoutPanel1">
                                <Label Key="OID" Width="80px" Height="auto" X="0" Y="0" Visible="false">
                                    <DataBinding ColumnKey="OID"/>
                                </Label>
                                <Label Key="RouteName" Width="80px" Height="auto" X="1" Y="0" XSpan="2">
                                    <DataBinding ColumnKey="RouteName"/>
                                    <Format ForeColor="#969696" HAlign="Left">
                                        <Font Size="20"/>
                                    </Format>
                                </Label>
                                <Label Key="StartName" Caption="地址名称" Width="80px" Visible="false" Height="auto" X="1" Y="0">
                                    <DataBinding ColumnKey="StartName"/>
                                </Label>
                                <Label Key="StartAddress" Caption="起始地址" Width="80px" Visible="false" Height="auto" X="1" Y="0">
                                    <DataBinding ColumnKey="StartAddress"/>
                                </Label>
                                <Label Key="Address" Width="80px" Height="auto" X="1" Y="1" XSpan="4">
                                    <DataBinding DefaultFormulaValue="'始发地：'&amp;IIF(StartAddress=='',StartName,StartName&amp;'('&amp;StartAddress&amp;')')"/>
                                    <Format ForeColor="#dde0e7" HAlign="Left">
                                        <Font Size="16"/>
                                    </Format>
                                </Label>
                                <Label Key="lbl" Width="80px" Height="auto" X="0" Y="2" XSpan="6">
                                    <Format BackColor="#f1f3f8"/>
                                </Label>
                                <RowDefCollection>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="10px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="20px"/>
                                    <ColumnDef Width="20px"/>
                                    <ColumnDef Width="50%"/>
                                    <ColumnDef Width="20px"/>
                                    <ColumnDef Width="50%"/>
                                    <ColumnDef Width="20px"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                            <RowClick>
                                <![CDATA[Open('MyModifyRoute', OID)]]>
                            </RowClick>
                            <RowActionCollection>
                                <RowAction Key="delete" Caption="删除" BackColor="#f1f3f8" ForeColor="#ffffff">
                                    <![CDATA[
											ShowConfirm('确定删除这条常用路线么？', 'YES_NO', 
												{
													YES: {
														var oid = GetCellValue('Routelist',GetRowIndex('Routelist'),'OID');
														DBNamedUpdate('DeleteUserRouteH',oid);
														DBNamedUpdate('DeleteUserRouteL',oid);
														LoadData();
														ShowToast("已删除");
													}, 
													NO: {} 
												}
											)
									]]>
                                </RowAction>
                            </RowActionCollection>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
                <HyperLink Caption="您还没有常用路线哦，点击添加一个吧" Key="HyperLink3" InitVisible="false"  X="0" Y="0" Visible="GetRowCount('Routelist')==0">
                    <Format ForeColor="#969696" HAlign="Center">
                        <Font Size="20"/>
                    </Format>
                    <OnClick>
                        <![CDATA[New('MyNewRoute');]]>
                    </OnClick>
                </HyperLink>
                <GridLayoutPanel Key="opt_panel" X="0" Y="1">
                    <Format BackColor="#f1f3f8"/>
                    <Button Key="order" Caption="新增一个常用路线" Enable="True" Height="auto" BorderStyle="none" X="1" Y="0">
                        <Format ForeColor="#ffffff" BackColor="#f14c52">
                            <Font Size="16"/>
                        </Format>
                        <OnClick>
                            <![CDATA[New('MyNewRoute')]]>
                        </OnClick>
                    </Button>
                    <RowDefCollection>
                        <RowDef Height="45px"/>
                        <RowDef Height="10px"/>
                    </RowDefCollection>
                    <ColumnDefCollection>
                        <ColumnDef Width="20px"/>
                        <ColumnDef Width="100%"/>
                        <ColumnDef Width="20px"/>
                    </ColumnDefCollection>
                </GridLayoutPanel>
                <RowDefCollection>
                    <RowDef Height="100%"/>
                    <RowDef Height="45px"/>
                </RowDefCollection>
                <ColumnDefCollection>
                    <ColumnDef Width="100%"/>
                </ColumnDefCollection>
            </GridLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[
			LoadData()
		]]>
    </OnLoad>
    <EventHandlerCollection>
        <EventHandler Key="RouteChanged" Trigger="Show" MergeEvent="true">
            <![CDATA[LoadData()]]>
        </EventHandler>
    </EventHandlerCollection>
    <NavigationBar BackColor="#f14c52" Style="Custom">
        <BarItem Key="OrderTitle_bar" Caption="管理常用路线" Location="Center">
            <Label Key="OrderTitle" Caption="管理常用路线" Height="auto" Weight="1.0" Stretch="true">
                <Format ForeColor="#ffffff" HAlign="Center">
                    <Font Size="20"/>
                </Format>
            </Label>
        </BarItem>
    </NavigationBar>
</Form>
