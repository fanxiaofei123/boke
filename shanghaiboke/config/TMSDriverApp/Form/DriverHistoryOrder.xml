<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="DriverHistoryOrder" Authenticate="false">
    <DataSource>
        <DataObject Key="DriverHistoryOrder" Caption="历史订单" Authenticate="false">
            <TableCollection>
                <Table Caption="历史订单" Key="DriverHistoryOrder" SourceType="Query" TableMode="Detail">
                    <Column Key="OID" Caption="调度单id" DataType="Long"/>
                    <Column Key="TJHOID" Caption="作业单id" DataType="Long"/>
                    <Column Key="Status" Caption="作业单状态" DataType="Integer"/>
                    <Column Key="TJHNo" Caption="作业单号" DataType="Varchar"/>
                    <Column Key="ExpectArriveTime" Caption="预计送达时间" DataType="DateTime"/>
                    <Column Key="SendPartyName" Caption="发货方名称" DataType="Varchar" Length="100"/>
                    <Column Key="SendAddress" Caption="发货方地址" DataType="Varchar" Length="100"/>
                    <Column Key="SendContactor" Caption="发货方联系人" DataType="Varchar" Length="100"/>
                    <Column Key="SendContactMobile" Caption="发货方联系人电话" DataType="Varchar" Length="100"/>
                    <Column Key="RecvPartyName" Caption="收货方名称" DataType="Varchar" Length="100"/>
                    <Column Key="RecvAddress" Caption="收货方地址" DataType="Varchar" Length="100"/>
                    <Column Key="RecvContactor" Caption="收货方联系人" DataType="Varchar" Length="100"/>
                    <Column Key="PayMethod" Caption="付款方式" DataType="Integer"/>
                    <Column Key="TruckTypeId" Caption="车型id" DataType="Long"/>
                    <Column Key="TruckTypeName" Caption="车型名称" DataType="Varchar" Length="200" Cache="true"/>
                    <Column Key="TruckLicenseNo" Caption="车牌号" DataType="Varchar" Length="100"/>
                    <Column Key="Weight" Caption="重量" DataType="Numeric" Precision="18" Scale="2" DefaultValue="0"/>
                    <Column Key="Cubage" Caption="体积" DataType="Numeric" Precision="18" Scale="2" DefaultValue="0"/>
                    <Column Key="Amount" Caption="服务费" DataType="Numeric" Precision="18" Scale="2" DefaultValue="0"/>
                    <Column Key="Freight" Caption="运费" DataType="Numeric" Precision="18" Scale="2" DefaultValue="0"/>
                    <ParameterCollection>
                        <Parameter DataType="Long" Formula="GetPara('TJHOID')"/>
                    </ParameterCollection>
                    <Statement>
                        <![CDATA[select 
    TJHOID,
    TOHOID,
    Status,
	TJHNo,
    ExpectArriveTime,
    RecvPartyName,
    RecvAddress,
    RecvContactor,
    SendPartyName,
    SendAddress,
    SendContactor,
    SendContactMobile,
    PayMethod,
    TruckTypeId,
    TruckTypeName,
    TruckLicenseNo,
    Weight,
    Cubage,
    Freight,
    Amount
from
    (select 
        TDH.oid,
            TJH.oid as TJHOID,
            TOH.oid as TOHOID,
            TJH.Status,
			TJH.No TJHNo,
            TOH.ExpectArriveTime,
            TOH.RecvPartyName,
            TOH.RecvAddress,
            TOH.RecvContactor,
            TOH.SendPartyName,
            TOH.SendAddress,
            TOH.SendContactor,
            TOH.SendContactMobile,
            TOH.PayMethod,
            TDH.TruckTypeId,
            TT.Name as TruckTypeName,
            TDH.TruckLicenseNo,
            sum(TJML.Weight) as Weight,
            sum(TJML.Cubage) as Cubage,
            sum(TOML.Freight) as Freight
    from
        LRP_TransportDispatch_H TDH
    join LRP_TransportDJ_L TDL ON TDH.oid = TDL.soid
    join LRP_TransportJob_H TJH ON TJH.oid = TDL.TJId
    join LRP_TransportOrder_H TOH ON TJH.OrderNo = TOH.No
    join LRP_TransportJobMat_L TJML ON TJH.oid = TJML.soid
    join LRP_TransportMaterial_L TOML ON TOH.oid = TOML.soid
    left join LRP_TruckType TT ON TDH.TruckTypeId = TT.oid
    where
        TJH.oid = ?
    group by TDH.oid , TJH.oid , TOH.oid, TJH.Status , TJH.No, TOH.ExpectArriveTime , TOH.RecvPartyName , TOH.RecvAddress , TOH.RecvContactor , TOH.SendPartyName , TOH.SendAddress , TOH.SendContactor , TOH.SendContactMobile , TOH.PayMethod , TDH.TruckTypeId , TT.Name , TDH.TruckLicenseNo) a
        Left join
    (select 
        TOSL.SOID, sum(TOSL.ServiceAmount) as Amount
    from
        LRP_TransportOrderService_L TOSL
    group by TOSL.SOID) b ON a.TOHOID = b.SOID
]]>
                    </Statement>
                </Table>
                <Table Key="TransportOrderRoute" Caption="途径信息" TableMode="Detail" SourceType="Query">
                    <Column Key="OID" Caption="对象标识" DataType="Long"/>
                    <Column Key="AddressName" Caption="地址名称" DataType="Varchar" Length="40"/>
                    <Column Key="Address" Caption="详细地址" DataType="Varchar" Length="100"/>
                    <ParameterCollection>
                        <Parameter DataType="Long" Formula="GetPara('TJHOID')"/>
                    </ParameterCollection>
                    <Statement>
                        <![CDATA[select TORL.OID,TORL.AddressName,TORL.Address 
						from LRP_TransportJob_H TJH 
						join LRP_TransportOrder_H TOH on TJH.OrderNo=TOH.No
						join LRP_TransportOrderRoute_L TORL on TORL.Soid = TOH.Soid
						where AddressType = 50 and TJH.oid = ?]]>
                    </Statement>
                </Table>
                <Table Key="TransportOrderService" Caption="物流服务" TableMode="Detail" SourceType="Query">
                    <Column Key="OID" Caption="对象标识" DataType="Long"/>
                    <Column Key="SOID" Caption="主对象标识" DataType="Long"/>
                    <Column Key="POID" Caption="父对象标识" DataType="Long"/>
                    <Column Key="VERID" Caption="对象版本" DataType="Integer"/>
                    <Column Key="DVERID" Caption="对象明细版本" DataType="Integer"/>
                    <Column Key="ServiceName" Caption="服务名" DataType="Varchar"/>
                    <ParameterCollection>
                        <Parameter DataType="Long" Formula="GetPara('TJHOID')"/>
                    </ParameterCollection>
                    <Statement>
                        <![CDATA[select LS.name as ServiceName,
                        TOSL.ServiceId,sum(TOSL.ServiceAmount) as Amount
						from LRP_TransportJob_H TJH 
						join LRP_TransportOrder_H TOH on TJH.OrderNo=TOH.No 
						left join LRP_TransportOrderService_L TOSL on TOH.oid=TOSL.soid 
						left join LRP_LogisticsService LS on ls.oid=TOSL.ServiceId
						where TJH.oid = ?
						group by LS.name,TOSL.ServiceId]]>
                    </Statement>
                </Table>
            </TableCollection>
        </DataObject>
    </DataSource>
    <Body>
        <Block>
            <GridLayoutPanel Key="root">
                <TableView Key="info_table" X="0" Y="0">
                    <TableRowCollection>
                        <TableRow Key="r1" TableKey="DriverHistoryOrder" TopMargin="10px">
                            <GridLayoutPanel Key="detail_panel1" Height="pref" LeftMargin="5px">
                                <Label Key="OrderMessage" Caption="订单信息" X="3" Y="2" XSpan="5">
                                    <Format ForeColor="#cc3333">
                                        <Font Size="15" Bold="true"/>
                                    </Format>
                                </Label>
                                <Label Key="SendContactor" X="5" Y="4" Enable="false">
                                    <DataBinding ColumnKey="SendContactor" TableKey="DriverHistoryOrder"/>
                                </Label>
                                <Label Key="Lab_SendContactor" Caption="发货人" X="3" Y="4"/>
                                <Label Key="SendContactMobile" X="5" Y="5" Enable="false">
                                    <DataBinding ColumnKey="SendContactMobile" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left"/>
                                </Label>
                                <Label Key="Lab_SendContactMobile" Caption="联系电话" X="3" Y="5"/>
                                <DatePicker Key="ExpectArriveTime" X="5" Y="6" Enable="false" Format="MM月dd日 HH:mm">
                                    <DataBinding ColumnKey="ExpectArriveTime" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left" BackColor="#ffffff"/>
                                </DatePicker>
                                <Label Key="Lab_ExpectArriveTime" Caption="服务时间" X="3" Y="6"/>
                                <Image Key="Image5" Caption="Image5" X="6" Y="4" YSpan="2" Image="37.png" ImageScaleType="Fit_XY" SourceType="Resource" Stretch="true" Margin="5px">
                                    <OnClick>
                                        <![CDATA[CallPhone(SendContactMobile);]]>
                                    </OnClick>
                                </Image>
                                <Label Key="TJHNo" Caption="订单号" BuddyKey="Lab_TJHNo" X="5" Y="3">
                                    <DataBinding ColumnKey="TJHNo" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left"/>
                                </Label>
                                <Label Key="Lab_TJHNo" Caption="订单号" X="3" Y="3"/>
                                <Label Key="Label1" X="0" Y="0" XSpan="8">
                                    <Format BackColor="#e6e6e6"/>
                                </Label>
                                <Image Key="Image6" X="1" Y="2" Image="3-1.png" ImageScaleType="Fit_XY" SourceType="Resource" Stretch="true"/>
                                <RowDefCollection>
                                    <RowDef Height="10px"/>
                                    <RowDef Height="10px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="30px"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                    <ColumnDef Width="60px"/>
                                    <ColumnDef Width="10px"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                        <TableRow Key="r3" TableKey="DriverHistoryOrder" TopMargin="10px">
                            <GridLayoutPanel Key="detail_panel2" Height="pref" LeftMargin="5px">
                                <Label Key="AddressMessage" Caption="地址信息" X="3" Y="2" XSpan="3">
                                    <Format ForeColor="#cc3333">
                                        <Font Size="15" Bold="true"/>
                                    </Format>
                                </Label>
                                <Label Key="SendPartyName" X="5" Y="3" Enable="false">
                                    <DataBinding ColumnKey="SendPartyName" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left">
                                        <Font Size="14"/>
                                    </Format>
                                </Label>
                                <Label Key="SendAddress" X="5" Y="4" Enable="false">
                                    <DataBinding ColumnKey="SendAddress" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left">
                                        <Font Size="10"/>
                                    </Format>
                                </Label>
                                <Label Key="Lab_SendParty" Caption="始发地" X="3" Y="3" YSpan="2"/>
                                <Label Key="Label2" X="0" Y="0" XSpan="6">
                                    <Format BackColor="#e6e6e6"/>
                                </Label>
                                <Image Key="Image7" BuddyKey="Lab_Image7" X="1" Y="2" Image="3-1.png" ImageScaleType="Fit_XY" SourceType="Resource" Stretch="true"/>
                                <Label Key="Lab_Image7" X="0" Y="2"/>
                                <RowDefCollection>
                                    <RowDef Height="10px"/>
                                    <RowDef Height="10px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="20px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="30px"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                        <TableRow Key="row5" RowType="Detail" TableKey="TransportOrderRoute">
                            <GridLayoutPanel Key="GridLayoutPanel3" Caption="GridLayoutPanel3" LeftMargin="5px">
                                <Label Key="AddressName" X="5" Y="0" Enable="false">
                                    <DataBinding ColumnKey="AddressName" TableKey="TransportOrderRoute"/>
                                    <Format HAlign="Left">
                                        <Font Size="14"/>
                                    </Format>
                                </Label>
                                <Label Key="Address" X="5" Y="1" Enable="false">
                                    <DataBinding ColumnKey="Address" TableKey="TransportOrderRoute"/>
                                    <Format HAlign="Left">
                                        <Font Size="10"/>
                                    </Format>
                                </Label>
                                <Label Key="Lab_RouteAddressName" Caption="途径地" X="3" Y="0" YSpan="2"/>
                                <RowDefCollection>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="20px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="30px"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                        <TableRow Key="r4" TableKey="DriverHistoryOrder" TopMargin="10px">
                            <GridLayoutPanel Key="detail_panel4" Height="pref" LeftMargin="5px">
                                <Label Key="RecvPartyName" X="5" Y="0" Enable="false">
                                    <DataBinding ColumnKey="RecvPartyName" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left">
                                        <Font Size="14"/>
                                    </Format>
                                </Label>
                                <Label Key="RecvAddress" X="5" Y="1" Enable="false">
                                    <DataBinding ColumnKey="RecvAddress" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left">
                                        <Font Size="10"/>
                                    </Format>
                                </Label>
                                <Label Key="Lab_RecvParty" Caption="目的地" X="3" Y="0" YSpan="2"/>
                                <RowDefCollection>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="20px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="30px"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                        <TableRow Key="r5" TableKey="DriverHistoryOrder" TopMargin="10px">
                            <GridLayoutPanel Key="detail_panel5" Height="pref" Margin="5px">
                                <Label Key="MaterialMessage" Caption="货物信息" X="3" Y="2" XSpan="3">
                                    <Format ForeColor="#cc3333">
                                        <Font Size="15" Bold="true"/>
                                    </Format>
                                </Label>
                                <NumberEditor Key="Weight" Enable="false" Precision="18" BorderStyle="none" X="5" Y="3">
                                    <DataBinding ColumnKey="Weight" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left" BackColor="transparent"/>
                                </NumberEditor>
                                <Label Key="Lab_Weight" Caption="重量" X="3" Y="3"/>
                                <NumberEditor Key="Cubage" Enable="false" Precision="18" BorderStyle="none" X="5" Y="4">
                                    <DataBinding ColumnKey="Cubage" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left" BackColor="transparent"/>
                                </NumberEditor>
                                <Label Key="Lab_Cubage" Caption="体积" X="3" Y="4"/>
                                <Image Key="Image8" X="1" Y="2" Image="3-1.png" ImageScaleType="Fit_XY" SourceType="Resource" Stretch="true"/>
                                <Label Key="Label3" X="0" Y="0" XSpan="6">
                                    <Format BackColor="#e6e6e6"/>
                                </Label>
                                <RowDefCollection>
                                    <RowDef Height="10px"/>
                                    <RowDef Height="10px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="40px"/>
                                    <RowDef Height="40px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="30px"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                        <TableRow Key="row7" RowType="Detail" TableKey="TransportOrderService">
                            <GridLayoutPanel Key="GridLayoutPanel4" Caption="GridLayoutPanel4" Margin="5px">
                                <Label Key="ServiceName" X="5" Y="0" Enable="false">
                                    <DataBinding ColumnKey="ServiceName"/>
                                    <Format HAlign="Left"/>
                                </Label>
                                <Label Key="Lab_ServiceName" Caption="额外服务" X="3" Y="0"/>
                                <RowDefCollection>
                                    <RowDef Height="30px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="30px"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                        <TableRow Key="r6" TableKey="DriverHistoryOrder" TopMargin="10px">
                            <GridLayoutPanel Key="detail_panel6" Height="pref" Margin="5px">
                                <Label Key="TruckMessage" Caption="车辆信息" X="3" Y="2" XSpan="3">
                                    <Format ForeColor="#cc3333">
                                        <Font Size="15" Bold="true"/>
                                    </Format>
                                </Label>
                                <Label Key="TruckTypeName" X="5" Y="3" Enable="false">
                                    <DataBinding ColumnKey="TruckTypeName" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left"/>
                                </Label>
                                <Label Key="Lab_TruckTypeName" Caption="车型" X="3" Y="3"/>
                                <Label Key="TruckLicenseNo" X="5" Y="4" Enable="false">
                                    <DataBinding ColumnKey="TruckLicenseNo" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left"/>
                                </Label>
                                <Label Key="Lab_TruckLicenseNo" Caption="车牌号" X="3" Y="4"/>
                                <NumberEditor Key="Freight" Enable="false" Precision="18" BorderStyle="none" X="5" Y="5">
                                    <DataBinding ColumnKey="Freight" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left" BackColor="transparent"/>
                                </NumberEditor>
                                <Label Key="Lab_Amount" Caption="收入" X="3" Y="6"/>
                                <NumberEditor Key="Amount" Enable="false" Precision="18" BorderStyle="none" X="5" Y="6">
                                    <DataBinding ColumnKey="Amount" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left" BackColor="transparent"/>
                                </NumberEditor>
                                <Label Key="Lab_Freight" Caption="运费" X="3" Y="5"/>
                                <ComboBox Key="PayMethod" Caption="付款方式" X="5" Y="7" Visible="false">
                                    <DataBinding ColumnKey="PayMethod" TableKey="DriverHistoryOrder"/>
                                    <Format HAlign="Left"/>
                                    <Item Caption="现付" Key="0" Value="0"/>
                                    <Item Caption="回单付" Key="1" Value="1"/>
                                    <Item Caption="月结" Key="2" Value="2"/>
                                    <Item Caption="到付" Key="3" Value="3"/>
                                    <Item Caption="预付" Key="4" Value="4"/>
                                    <Item Caption="提付" Key="5" Value="5"/>
                                </ComboBox>
                                <Label Key="Label4" X="0" Y="0" XSpan="6">
                                    <Format BackColor="#e6e6e6"/>
                                </Label>
                                <Image Key="Image9" X="1" Y="2" Image="3-1.png" ImageScaleType="Fit_XY" SourceType="Resource" Stretch="true"/>
                                <RowDefCollection>
                                    <RowDef Height="10px"/>
                                    <RowDef Height="10px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="40px"/>
                                    <RowDef Height="40px"/>
                                    <RowDef Height="30px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="30px"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
                <RowDefCollection>
                    <RowDef Height="100%"/>
                </RowDefCollection>
                <ColumnDefCollection>
                    <ColumnDef Width="100%"/>
                </ColumnDefCollection>
            </GridLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[
		LoadData();
		]]>
    </OnLoad>
    <FormParaCollection>
        <FormPara Formula="Para('TJHOID')" Key="TJHOID" Type="Formula"/>
    </FormParaCollection>
    <NavigationBar BackColor="#f14c52" Style="Custom">
        <BarItem Key="Centertitle" Caption="历史订单信息" Location="Center">
            <Label Key="TitleCenter" Caption="历史订单信息" Width="pref">
                <Format ForeColor="#ffffff" HAlign="Center">
                    <Font Size="20"/>
                </Format>
            </Label>
        </BarItem>
    </NavigationBar>
</Form>
