<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="DriverReceiveOrder">
    <DataSource>
        <DataObject Key="DriverReceiveOrder" Caption="接单列表">
            <TableCollection>
                <Table Caption="接单列表" Key="DriverReceiveOrder" SourceType="Query" TableMode="Detail">
                    <Column Key="TDHOID" Caption="调度单id" DataType="Long"/>
                    <Column Key="TJHOID" Caption="作业单id" DataType="Long"/>
                    <Column Key="Status" Caption="作业单状态" DataType="Integer"/>
                    <Column Key="ExpectArriveTime" Caption="预计送达时间" DataType="DateTime"/>
                    <Column Key="SendPartyName" Caption="发货方名称" DataType="Varchar" Length="100"/>
                    <Column Key="SendAddress" Caption="发货方地址" DataType="Varchar" Length="100"/>
                    <Column Key="SendContactor" Caption="发货方联系人" DataType="Varchar" Length="100"/>
                    <Column Key="SendContactMobile" Caption="发货方联系人电话" DataType="Varchar" Length="100"/>
                    <Column Key="RecvPartyName" Caption="收货方名称" DataType="Varchar" Length="100"/>
                    <Column Key="RecvAddress" Caption="收货方地址" DataType="Varchar" Length="100"/>
                    <Column Key="RecvContactor" Caption="收货方联系人" DataType="Varchar" Length="100"/>
                    <Column Key="PayMethod" Caption="付款方式" DataType="Integer"/>
                    <Column Key="ServiceId" Caption="物流服务" DataType="Long"/>
                    <Column Key="ServiceName" Caption="物流服务名称" DataType="Varchar" Length="200"/>
                    <Column Key="TruckTypeId" Caption="车型id" DataType="Long"/>
                    <Column Key="TruckTypeName" Caption="车型名称" DataType="Varchar" Length="200"/>
                    <Column Key="TruckLicenseNo" Caption="车牌号" DataType="Varchar" Length="100"/>
                    <Column Key="Weight" Caption="重量" DataType="Numeric" Precision="18" Scale="2"/>
                    <Column Key="Cubage" Caption="体积" DataType="Numeric" Precision="18" Scale="2"/>
                    <Column Key="Amount" Caption="服务费" DataType="Numeric" Precision="18" Scale="2"/>
                    <Column Key="Freight" Caption="运费" DataType="Numeric" Precision="18" Scale="2"/>
                    <ParameterCollection>
                        <Parameter DataType="Long" Formula="GetPara('TJHOID')"/>
                    </ParameterCollection>
                    <Statement>
                        <![CDATA[select 
	TDHOID,
    TJHOID,
    TOHOID,
    Status,
	TJHNo,
	DispatchOrgId,
    ExpectArriveTime,
    RecvPartyName,
    RecvAddress,
    RecvContactor,
    SendPartyName,
    SendAddress,
    SendContactor,
    SendContactMobile,
    PayMethod,
	PayStatus,
    TruckTypeId,
    TruckTypeName,
    TruckLicenseNo,
    Weight,
    Cubage,
    Freight,
    Amount
from
    (select 
        TDH.oid TDHOID,
            TJH.oid as TJHOID,
            TOH.oid as TOHOID,
            TJH.Status,
			TJH.No as TJHNo,
			TOH.DispatchOrgId,
            TOH.ExpectArriveTime,
            TOH.RecvPartyName,
            TOH.RecvAddress,
            TOH.RecvContactor,
            TOH.SendPartyName,
            TOH.SendAddress,
            TOH.SendContactor,
            TOH.SendContactMobile,
            TOH.PayMethod,
			TOH.PayStatus,
            TDH.TruckTypeId,
            TT.Name as TruckTypeName,
            TDH.TruckLicenseNo,
            sum(TJML.Weight) as Weight,
            sum(TJML.Cubage) as Cubage,
            sum(TOML.Freight) as Freight
    from
        LRP_TransportDispatch_H TDH
    join LRP_TransportDJ_L TDL ON TDH.oid = TDL.soid
    join LRP_TransportJob_H TJH ON TJH.oid = TDL.TJId
    join LRP_TransportOrder_H TOH ON TJH.OrderNo = TOH.No
    join LRP_TransportJobMat_L TJML ON TJH.oid = TJML.soid
    join LRP_TransportMaterial_L TOML ON TOH.oid = TOML.soid
    left join LRP_TruckType TT ON TDH.TruckTypeId = TT.oid
	where TJH.oid = ?
    group by TDH.oid , TOH.oid, TJH.oid , TJH.Status , TJH.No, DispatchOrgId, TOH.ExpectArriveTime , TOH.RecvPartyName , TOH.RecvAddress , TOH.RecvContactor , TOH.SendPartyName , TOH.SendAddress , TOH.SendContactor , TOH.SendContactMobile , TOH.PayMethod , TOH.PayStatus,TDH.TruckTypeId , TT.Name , TDH.TruckLicenseNo) a
        Left join
    (select 
        TOSL.SOID, sum(TOSL.ServiceAmount) as Amount
    from
        LRP_TransportOrderService_L TOSL
    group by TOSL.SOID) b ON a.TOHOID = b.SOID]]>
                    </Statement>
                </Table>
                <Table Key="TransportOrderRoute" Caption="途径信息" TableMode="Detail" SourceType="Query">
                    <Column Key="OID" Caption="对象标识" DataType="Long"/>
                    <Column Key="AddressName" Caption="地址名称" DataType="Varchar" Length="40"/>
                    <Column Key="Address" Caption="详细地址" DataType="Varchar" Length="100"/>
                    <ParameterCollection>
                        <Parameter DataType="Long" Formula="GetPara('TJHOID')"/>
                    </ParameterCollection>
                    <Statement>
                        <![CDATA[select TORL.OID,TORL.AddressName,TORL.Address 
						from LRP_TransportJob_H TJH 
						join LRP_TransportOrder_H TOH on TJH.OrderNo=TOH.No
						join LRP_TransportOrderRoute_L TORL on TORL.Soid = TOH.Soid
						where AddressType = 50 and TJH.oid = ?]]>
                    </Statement>
                </Table>
            </TableCollection>
        </DataObject>
    </DataSource>
    <Body>
        <Block>
            <GridLayoutPanel Key="root">
                <Format BackColor="#ffffff"/>
                <TableView Key="info_table" X="0" Y="0">
                    <TableRowCollection>
                        <TableRow Key="s9" RowType="Detail" TopMargin="10px" TableKey="DriverReceiveOrder">
                            <GridLayoutPanel Key="detail_panel1" Height="auto" LeftMargin="5px">
                                <Label Key="OrderMessage" Caption="订单信息" X="2" Y="0" XSpan="4">
                                    <Format BackColor="#e6e6e6">
                                        <Font Size="15" Bold="true"/>
                                    </Format>
                                </Label>
                                <LinearLayoutPanel BorderColor="#ffffff" BorderStyle="solid none" Key="opt_panel1" Orientation="Horizontal" X="5" Y="1" YSpan="2">
                                    <Format BackColor="Transparent"/>
                                    <Button Key="CallPhone" Enable="True" BorderStyle="none" Height="auto" Icon="37.png" OnlyIcon="True" Weight="1.0" Width="pref">
                                        <Format BackColor="Transparent"/>
                                        <OnClick>
                                            <![CDATA[
													CallPhone(SendContactMobile);
													]]>
                                        </OnClick>
                                    </Button>
                                </LinearLayoutPanel>
                                <Label Key="SendContactor" X="4" Y="1" Enable="false">
                                    <DataBinding ColumnKey="SendContactor"/>
                                </Label>
                                <Label Key="Lab_SendContactor" Caption="发货人" X="2" Y="1"/>
                                <Label Key="SendContactMobile" X="4" Y="2" Enable="false">
                                    <DataBinding ColumnKey="SendContactMobile"/>
                                </Label>
                                <Label Key="Lab_SendContactMobile" Caption="联系电话" X="2" Y="2"/>
                                <DatePicker Key="ExpectArriveTime" X="4" Y="3" Enable="false" Format="MM月dd日 HH:mm">
                                    <DataBinding ColumnKey="ExpectArriveTime"/>
                                    <Format HAlign="Left" BackColor="#ffffff"/>
                                </DatePicker>
                                <Label Key="Lab_ExpectArriveTime" Caption="服务时间" X="2" Y="3"/>
                                <RowDefCollection>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="1px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                    <ColumnDef Width="55px"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                        <TableRow Key="s10" RowType="Detail" TopMargin="10px" TableKey="DriverReceiveOrder">
                            <GridLayoutPanel Key="detail_panel2" Height="auto" LeftMargin="5px">
                                <Label Key="AddressMessage" Caption="地址信息" X="2" Y="0" XSpan="3">
                                    <Format BackColor="#e6e6e6">
                                        <Font Size="15" Bold="true"/>
                                    </Format>
                                </Label>
                                <Label Key="SendPartyName" X="4" Y="1" Enable="false">
                                    <DataBinding ColumnKey="SendPartyName"/>
                                    <Format>
                                        <Font Size="14"/>
                                    </Format>
                                </Label>
                                <Label Key="SendAddress" X="4" Y="2" Enable="false">
                                    <DataBinding ColumnKey="SendAddress"/>
                                    <Format>
                                        <Font Size="10"/>
                                    </Format>
                                </Label>
                                <Label Key="Lab_SendParty" Caption="始发地" X="2" Y="1" YSpan="2"/>
                                <RowDefCollection>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="20px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="1px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                        <TableRow Key="row5" RowType="Detail" TableKey="TransportOrderRoute">
                            <GridLayoutPanel Key="GridLayoutPanel3" Caption="GridLayoutPanel3" LeftMargin="5px">
                                <Label Key="AddressName" X="4" Y="0" Enable="false">
                                    <DataBinding ColumnKey="AddressName" TableKey="TransportOrderRoute"/>
                                    <Format>
                                        <Font Size="14"/>
                                    </Format>
                                </Label>
                                <Label Key="Address" X="4" Y="1" Enable="false">
                                    <DataBinding ColumnKey="Address" TableKey="TransportOrderRoute"/>
                                    <Format>
                                        <Font Size="10"/>
                                    </Format>
                                </Label>
                                <Label Key="Lab_RouteAddressName" Caption="途径地" X="2" Y="0" YSpan="2"/>
                                <RowDefCollection>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="20px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="1px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                        <TableRow Key="S11" RowType="Detail" TopMargin="10px" TableKey="DriverReceiveOrder">
                            <GridLayoutPanel Key="detail_panel4" Height="auto" LeftMargin="5px">
                                <Label Key="RecvPartyName" X="4" Y="0" Enable="false">
                                    <DataBinding ColumnKey="RecvPartyName"/>
                                    <Format>
                                        <Font Size="14"/>
                                    </Format>
                                </Label>
                                <Label Key="RecvAddress" X="4" Y="1" Enable="false">
                                    <DataBinding ColumnKey="RecvAddress"/>
                                    <Format>
                                        <Font Size="10"/>
                                    </Format>
                                </Label>
                                <Label Key="Lab_RecvParty" Caption="目的地" X="2" Y="0" YSpan="2"/>
                                <RowDefCollection>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="20px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="1px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                        <TableRow Key="s12" RowType="Detail" TopMargin="10px" TableKey="DriverReceiveOrder">
                            <GridLayoutPanel Key="detail_panel5" Height="auto" Margin="5px">
                                <Label Key="MaterialMessage" Caption="货物信息" X="2" Y="0" XSpan="3">
                                    <Format BackColor="#e6e6e6">
                                        <Font Size="15" Bold="true"/>
                                    </Format>
                                </Label>
                                <NumberEditor Key="Weight" Enable="false" Precision="18" Scale="0" BorderStyle="none" X="4" Y="1">
                                    <DataBinding ColumnKey="Weight"/>
                                    <Format BackColor="transparent"/>
                                </NumberEditor>
                                <Label Key="Lab_Weight" Caption="重量" X="2" Y="1"/>
                                <NumberEditor Key="Cubage" Enable="false" Precision="18" Scale="0" BorderStyle="none" X="4" Y="2">
                                    <DataBinding ColumnKey="Cubage"/>
                                    <Format BackColor="transparent"/>
                                </NumberEditor>
                                <Label Key="Lab_Cubage" Caption="体积" X="2" Y="2"/>
                                <Label Key="ServiceName" X="4" Y="3" Enable="false">
                                    <DataBinding ColumnKey="ServiceName"/>
                                </Label>
                                <Label Key="Lab_ServiceName" Caption="额外服务" X="2" Y="3"/>
                                <RowDefCollection>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="1px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                        <TableRow Key="s13" TableKey="DriverReceiveOrder" TopMargin="10px" RowType="Detail">
                            <GridLayoutPanel Key="detail_panel6" Height="auto" Margin="5px">
                                <Label Key="TruckMessage" Caption="车辆信息" X="2" Y="0" XSpan="3">
                                    <Format BackColor="#e6e6e6">
                                        <Font Size="15" Bold="true"/>
                                    </Format>
                                </Label>
                                <Label Key="TruckTypeName" X="4" Y="1" Enable="false">
                                    <DataBinding ColumnKey="TruckTypeName"/>
                                </Label>
                                <Label Key="Lab_TruckTypeName" Caption="车型" X="2" Y="1"/>
                                <Label Key="TruckLicenseNo" X="4" Y="2" Enable="false">
                                    <DataBinding ColumnKey="TruckLicenseNo"/>
                                </Label>
                                <Label Key="Lab_TruckLicenseNo" Caption="车牌号" X="2" Y="2"/>
                                <NumberEditor Key="Freight" Enable="false" Precision="18" Scale="0" BorderStyle="none" X="4" Y="3">
                                    <DataBinding ColumnKey="Freight"/>
                                    <Format BackColor="transparent"/>
                                </NumberEditor>
                                <Label Key="Lab_Freight" Caption="运费" X="2" Y="3"/>
                                <NumberEditor Key="Amount" Enable="false" Precision="18" Scale="0" BorderStyle="none" X="4" Y="4">
                                    <DataBinding ColumnKey="Amount"/>
                                    <Format BackColor="transparent"/>
                                </NumberEditor>
                                <Label Key="Lab_Amount" Caption="收入" X="2" Y="4"/>
                                <TextEditor Key="TDHOID" X="4" Y="4" Visible="false">
                                    <DataBinding ColumnKey="TDHOID"/>
                                </TextEditor>
                                <RowDefCollection>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                    <RowDef Height="30px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="1px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="70px"/>
                                    <ColumnDef Width="5px"/>
                                    <ColumnDef Width="100%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
                <LinearLayoutPanel Key="opt_panel2" X="0" Y="1" Orientation="Horizontal" BorderStyle="solid none">
                    <Button Key="DriverReceive" Caption="接单" Enable="True" Width="pref" Height="auto" Weight="1.0" BorderStyle="none">
                        <Format ForeColor="#ffffff" BackColor="#00b676"/>
                        <OnClick>
                            <![CDATA[InvokeService('LRP_DriverReceiveOrder', false, false, ToLong(GetCellValue('s13', 0, 'TDHOID')));
SendSignal('OrderChanged');
SendSignal('Receipt');
Close();
				]]>
                        </OnClick>
                    </Button>
                </LinearLayoutPanel>
                <LinearLayoutPanel Key="opt_panel3" X="0" Y="2" Orientation="Horizontal" BorderStyle="solid none">
                    <Button Key="RefuseReceive" Caption="拒接" Enable="True" Width="pref" Height="auto" Weight="1.0" BorderStyle="none">
                        <Format ForeColor="#ffffff" BackColor="#f14c52"/>
                        <OnClick>
                            <![CDATA[
								PushPara('OID',ToLong(GetCellValue('s13', 0, 'TDHOID')));
								Show('GetRejectCause');
							]]>
                        </OnClick>
                    </Button>
                </LinearLayoutPanel>
                <RowDefCollection>
                    <RowDef Height="100%"/>
                    <RowDef Height="45px"/>
                    <RowDef Height="45px"/>
                </RowDefCollection>
                <ColumnDefCollection>
                    <ColumnDef Width="100%"/>
                </ColumnDefCollection>
            </GridLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[
		LoadData();
		]]>
    </OnLoad>
    <FormParaCollection>
        <FormPara Formula="Para('TJHOID')" Key="TJHOID" Type="Formula"/>
    </FormParaCollection>
    <NavigationBar BackColor="#f14c52" Style="Custom">
        <BarItem Key="Centertitle" Caption="确认接单" Location="Center">
            <Label Key="TitleCenter" Caption="确认接单" Width="100%">
                <Format ForeColor="#ffffff" HAlign="Center">
                    <Font Size="20"/>
                </Format>
            </Label>
        </BarItem>
    </NavigationBar>
</Form>
