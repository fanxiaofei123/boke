<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Caption="承运商竞价" FormType="View" Key="V_CarrierBidding">
	<QueryCollection>
		<Query Description="根据当前用户查找用户所属承运商" Key="SelectCarrierId">
            <Statement>
                <![CDATA[select CarrierId from SYS_Operator where OID=?]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Varchar"/>
            </ParameterCollection>
        </Query>
		<Query Description="查找竞价明细中此承运商竞价明细" Key="SelectBidding">
            <Statement>
                <![CDATA[select l.BidingPrice,l.Remark from LRP_TransportOrderBiding_L l join LRP_TransportOrder_H h on h.oid=l.soid join SYS_Operator sys on l.CarrierId=sys.CarrierId where sys.oid=? and h.oid=?]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Varchar"/>
				<Parameter DataType="Long"/>
            </ParameterCollection>
        </Query>
    </QueryCollection>
    <Body PopHeight="40%" PopWidth="50%">
        <Block>
            <FlexFlowLayoutPanel Caption="根面板" Key="root">
                <ToolBar Caption="ToolBar1" Height="pref" Key="ToolBar1">
                    <ToolBarItemCollection/>
                </ToolBar>
                <SplitPanel Caption="SplitPanel1" Height="100%" Key="SplitPanel1" Orientation="Vertical">
                    <GridLayoutPanel Caption="基本信息" Height="pref" Key="first_head" Padding="10px">
                        <NumberEditor Key="BiddingPrice" Caption="价格" BuddyKey="Lab_BiddingPrice" X="1" Y="0" XSpan="3"/>
                        <Label Key="Lab_BiddingPrice" Caption="价格" X="0" Y="0"/>
                        <TextEditor Key="Remark" Caption="备注" BuddyKey="Lab_Remark" X="6" Y="0" XSpan="3"/>
                        <Label Key="Lab_Remark" Caption="备注" X="5" Y="0"/>
                        <RowDefCollection RowGap="8">
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="8">
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="55px"/>
                            <ColumnDef Width="25%"/>
                            <ColumnDef Width="10px"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <GridLayoutPanel Caption="GridLayoutPanel1" Key="GridLayoutPanel1">
                        <Button Caption="确定" Key="OK" X="1" Y="0">
                            <OnClick>
                                <![CDATA[
									Confirm('确定竞价吗?','YES_NO',{YES:{
										var carrierId=DBNamedQueryValue('SelectCarrierId',GetOperator());
										InvokeService('LRP_Bidding',true,false,carrierId,GetPara('OID_para'),BiddingPrice,Remark);
										Close();
									},NO:{}});
									]]>
                            </OnClick>
                        </Button>
                        <Button Caption="取消" Key="Cancle" X="2" Y="0">
                            <OnClick>
                                <![CDATA[Close();]]>
                            </OnClick>
                        </Button>
                        <RowDefCollection RowGap="5">
                            <RowDef Height="30px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="5">
                            <ColumnDef Width="100%"/>
                            <ColumnDef Width="80px"/>
                            <ColumnDef Width="80px"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <SplitSize Size="100%"/>
                    <SplitSize Size="100px"/>
                </SplitPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
	<OnPostShow>
        <![CDATA[
			var dt=DBNamedQuery('SelectBidding',GetOperator(),GetPara('OID_para'));
			if(dt.size()>0)
			{
				dt.beforefirst();
				dt.next();
				SetValue('BiddingPrice',dt.BidingPrice);
				SetValue('Remark',dt.Remark);
			}
	]]>
    </OnPostShow>
</Form>
