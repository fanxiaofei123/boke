<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="V_PutawayStrategy" Caption="上架策略" FormType="Entity" ViewKey="V_PutawayStrategyView">
    <DataSource RefObjectKey="LRP_PutawayStrategy"/>
    <OperationCollection>
        <Operation Key="Save" Caption="保存" Visible="!ReadOnly()">
            <Action>
                <![CDATA[
                       if(GetValue('StrategyType') == 0){
					     if(GetRowCount('Grid1', false)<=0){
						 Confirm(LocaleString('OwnerNull','key103'), 'OK','OK:{}');
					     return true;
					   }
					   }
                       if(GetValue('StrategyType') == 1 || GetValue('StrategyType') == 2 || GetValue('StrategyType') == 3 || GetValue('StrategyType') == 4){				   
				       if(GetRowCount('Grid2', false)<=0 || GetRowCount('Grid3', false)<=0 || GetRowCount('Grid4', false)<=0){
					    Confirm(LocaleString('OwnerNull','key103'), 'OK','OK:{}');
					    return true;
					   }
					   } 
		             if(MatchWhereSql_Save()&&LocWhereSql_Save()&&LocSortSql_Save()){
						SaveData(); UpdateView();
					}
                    					
                     					
                       						
                 ]]>
            </Action>
        </Operation>
        <Operation Caption="编辑" Key="Edit" RefKey="Edit" ShortCuts="Ctrl+E"/>
        <Operation Caption="确认" Key="Confirm" RefKey="Confirm"/>
        <Operation Key="Confirm-R" Caption="撤销确认" Visible="ReadOnly()&amp;&amp;Status==StatusValue('confirmed')">
            <Action>
                <![CDATA[	//查询选中的上架策略是否被物料引用
				var count=DBNamedQueryValue("SMaStrategy",OID);
				if(count==0){
					Status=StatusValue('prepared');SaveData();UpdateView();
				}else{
					Confirm(LocaleString('STshow','stkey10'),'OK','OK{}');
				}
				]]>
            </Action>
        </Operation>
        <Operation Caption="删除" Key="Delete" RefKey="Delete" ShortCuts="Ctrl+D"/>
        <Operation Caption="取消" Key="Cancel" RefKey="Cancel"/>
        <Operation Caption="关闭界面" Key="Close" RefKey="Close"/>
    </OperationCollection>
    <ScriptCollection>
        <Script Key="Load" Caption="载入" Range="Action" Verb="Load">
            <![CDATA[LoadData();]]>
        </Script>
    </ScriptCollection>
    <QueryCollection>
        <Query Key="SMaStrategy" Description="查找物料-仓储策略中策略是本策略的个数">
            <Statement>
                <![CDATA[select count(*) as count from LRP_MaterialStrategy where StrategyId= ?]]>
            </Statement>
            <ParameterCollection>
                <Parameter DataType="Long"/>
            </ParameterCollection>
        </Query>
    </QueryCollection>
    <Body>
        <Block>
            <FlexFlowLayoutPanel Key="root" Caption="根面板">
                <ToolBar Key="ToolBar1" Height="pref" Caption="ToolBar1">
                    <ToolBarItemCollection/>
                </ToolBar>
                <SplitPanel Key="main" Orientation="Vertical" Height="100%" Caption="主面板">
                    <TabPanel Caption="TabPanel1" Key="TabPanel1">
                        <GridLayoutPanel Key="first_head" Height="pref" Padding="5px" Caption="基本信息">
                            <TextEditor Key="No" Caption="上架策略号" BuddyKey="Lab_No" X="1" Y="0" Enable="false">
                                <DataBinding ColumnKey="No" TableKey="LRP_PutawayStrategy_H"/>
                            </TextEditor>
                            <Label Key="Lab_No" Caption="上架策略号" X="0" Y="0"/>
                            <TextEditor Key="Name" Caption="策略名称" BuddyKey="Lab_Name" X="4" Y="0" Enable="!ReadOnly()">
                                <DataBinding ColumnKey="Name" TableKey="LRP_PutawayStrategy_H" Required="true"/>
                            </TextEditor>
                            <Label Key="Lab_Name" Caption="策略名称" X="3" Y="0"/>
                            <ComboBox Key="StrategyType" Caption="策略类型" BuddyKey="Lab_StrategyType" X="7" Y="0" Enable="!ReadOnly()">
                                <DataBinding ColumnKey="StrategyType" TableKey="LRP_PutawayStrategy_H">
                                    <ValueChanging>
                                        <![CDATA[  	
												 Confirm(LocaleString('STshow','stkey11'),
												'YES_NO',  {YES:    
												 {       
												ClearAllRows('Grid2');
												ClearAllRows('Grid3');
												ClearAllRows('Grid4');  												
												CommitValue('StrategyType');  
												},         
												 NO:{RollbackValue('StrategyType');}});  
										]]>
                                    </ValueChanging>
                                    <ValueValidation>
                                        <![CDATA[GetValue('StrategyType') !=0 || (GetRowCount('Grid2')<=1 && GetRowCount('Grid3')<=1 && GetRowCount('Grid4')<=1)]]>
                                    </ValueValidation>
                                </DataBinding>
                                <Item Caption="人工指定" Key="StrategyType0" Value="0"/>
                                <Item Caption="固定储位" Key="StrategyType1" Value="1"/>
                                <Item Caption="附加于现有库存" Key="StrategyType2" Value="2"/>
                                <Item Caption="空储位（按储位类型）" Key="StrategyType3" Value="3"/>
                                <Item Caption="空储位（按托盘）" Key="StrategyType4" Value="4"/>
                            </ComboBox>
                            <Label Key="Lab_StrategyType" Caption="策略类型" X="6" Y="0"/>
                            <ComboBox Key="Status" Caption="状态" BuddyKey="Lab_Status" X="7" Y="1" SourceType="Status" Enable="false">
                                <DataBinding ColumnKey="Status" TableKey="LRP_PutawayStrategy_H" DefaultValue="100"/>
                            </ComboBox>
                            <Label Key="Lab_Status" Caption="状态" X="6" Y="1"/>
                            <TextEditor Key="Remarks" Caption="备注" BuddyKey="Lab_Remarks" X="1" Y="1" Enable="!ReadOnly()" XSpan="4">
                                <DataBinding ColumnKey="Remarks" TableKey="LRP_PutawayStrategy_H"/>
                            </TextEditor>
                            <Label Key="Lab_Remarks" Caption="备注" X="0" Y="1"/>
                            <Dict Key="WarehouseCenterId" Caption="仓储中心" BuddyKey="Lab_WarehouseCenterId" X="1" Y="2" Visible="false" ItemKey="LRP_WarehouseCenter">
                                <DataBinding ColumnKey="WarehouseCenterId" DefaultFormulaValue="getCurOrgID()" TableKey="LRP_PutawayStrategy_H"/>
                            </Dict>
                            <Label Key="Lab_WarehouseCenterId" Caption="仓储中心" X="0" Y="2"/>
                            <TextEditor Key="OID" Caption="OID" BuddyKey="Lab_OID" Visible="false" X="4" Y="3">
                                <DataBinding ColumnKey="OID" TableKey="LRP_PutawayStrategy_H"/>
                            </TextEditor>
                            <Label Key="Lab_OID" Caption="OID" X="3" Y="3" Visible="false"/>
                            <RowDefCollection RowGap="8">
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="8">
                                <ColumnDef Width="77px"/>
                                <ColumnDef Width="33%"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="33%"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="33%"/>
                                <ColumnDef Width="55px"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                        <GridLayoutPanel Key="GridLayoutPanel1" Caption="检查SQL" Padding="5px">
                            <TextEditor Key="MatchCheckSql" Caption="匹配条件检查SQL" BuddyKey="Lab_MatchCheckSql" X="1" Y="0" Enable="false" XSpan="7">
                                <DataBinding ColumnKey="MatchCheckSql" TableKey="LRP_PutawayStrategy_H" DefaultValue="select H.OID from LRP_WMTx_H H join LRP_WMTx_L L on H.SOID = L.SOID join LRP_Material M on L.MaterialId = M.OID"/>
                            </TextEditor>
                            <Label Key="Lab_MatchCheckSql" Caption="匹配条件检查SQL" X="0" Y="0"/>
                            <TextEditor Key="MatchWhereSql" Caption="匹配条件SQL" BuddyKey="Lab_MatchWhereSql" X="1" Y="1" Enable="false" XSpan="7">
                                <DataBinding ColumnKey="MatchWhereSql" TableKey="LRP_PutawayStrategy_H"/>
                            </TextEditor>
                            <Label Key="Lab_MatchWhereSql" Caption="匹配条件SQL" X="0" Y="1"/>
                            <TextEditor Key="LocCheckSql" Caption="储位检查SQL" BuddyKey="Lab_LocCheckSql" X="1" Y="2" Enable="false" XSpan="7">
                                <DataBinding ColumnKey="LocCheckSql" TableKey="LRP_PutawayStrategy_H" DefaultValue="select L.OID, T.AllowPallet, T.CubageLimit, T.WeightLimit, T.DefaultPalletTypeId, T.PalletQtyLimit from LRP_Location L join LRP_Storearea A on L.StoreareaId = A.OID join LRP_Storeroom R on L.StoreroomId = R.OID join LRP_LocType T on L.LocTypeId = T.OID"/>
                            </TextEditor>
                            <Label Key="Lab_LocCheckSql" Caption="储位检查SQL" X="0" Y="2"/>
                            <TextEditor Key="LocWhereSql" Caption="储位匹配SQL" BuddyKey="Lab_LocWhereSql" X="1" Y="3" Enable="false" XSpan="4">
                                <DataBinding ColumnKey="LocWhereSql" TableKey="LRP_PutawayStrategy_H"/>
                            </TextEditor>
                            <Label Key="Lab_LocWhereSql" Caption="储位匹配SQL" X="0" Y="3"/>
                            <TextEditor Key="LocSortSql" Caption="储位排序SQL" BuddyKey="Lab_LocSortSql" X="7" Y="3" Enable="false">
                                <DataBinding ColumnKey="LocSortSql" TableKey="LRP_PutawayStrategy_H"/>
                            </TextEditor>
                            <Label Key="Lab_LocSortSql" Caption="储位排序SQL" X="6" Y="3"/>
                            <RowDefCollection RowGap="8">
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="8">
                                <ColumnDef Width="99px"/>
                                <ColumnDef Width="33%"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="33%"/>
                                <ColumnDef Width="55px"/>
                                <ColumnDef Width="77px"/>
                                <ColumnDef Width="33%"/>
                                <ColumnDef Width="55px"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                        <GridLayoutPanel Caption="系统信息" Height="pref" Key="second_head" Padding="5px">
                            <Dict BuddyKey="Lab_CREATOR" Caption="创建用户" ItemKey="Operator" Key="CREATOR" X="1" Y="0">
                                <DataBinding ColumnKey="CREATOR" DefaultFormulaValue="GetOperator();" TableKey="LRP_PutawayStrategy_H"/>
                            </Dict>
                            <Label Caption="创建用户" Key="Lab_CREATOR" X="0" Y="0"/>
                            <DatePicker BuddyKey="Lab_CREATETIME" Caption="创建时间" Key="CREATETIME" X="3" Y="0">
                                <DataBinding ColumnKey="CREATETIME" DefaultFormulaValue="ServerDate();" TableKey="LRP_PutawayStrategy_H"/>
                            </DatePicker>
                            <Label Caption="创建时间" Key="Lab_CREATETIME" X="2" Y="0"/>
                            <Dict BuddyKey="Lab_MODIFIER" Caption="修改用户" ItemKey="Operator" Key="MODIFIER" X="1" Y="1">
                                <DataBinding ColumnKey="MODIFIER" DefaultFormulaValue="GetOperator();" TableKey="LRP_PutawayStrategy_H"/>
                            </Dict>
                            <Label Caption="修改用户" Key="Lab_MODIFIER" X="0" Y="1"/>
                            <DatePicker BuddyKey="Lab_MODIFYTIME" Caption="修改时间" Key="MODIFYTIME" X="3" Y="1">
                                <DataBinding ColumnKey="MODIFYTIME" DefaultFormulaValue="ServerDate();" TableKey="LRP_PutawayStrategy_H"/>
                            </DatePicker>
                            <Label Caption="修改时间" Key="Lab_MODIFYTIME" X="2" Y="1"/>
                            <RowDefCollection RowGap="8">
                                <RowDef Height="30px"/>
                                <RowDef Height="30px"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="8">
                                <ColumnDef Width="80px"/>
                                <ColumnDef Width="50%"/>
                                <ColumnDef Width="80px"/>
                                <ColumnDef Width="50%"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                    </TabPanel>
                    <TabPanel Height="100%" Key="DetailTab">
                        <Grid Key="Grid1" Caption="条件匹配明细" Enable="!ReadOnly()">
                            <GridColumnCollection>
                                <GridColumn Key="LeftBrackets" Caption="左括号" Width="80px" Sortable="true"/>
                                <GridColumn Key="ObjectAttrib" Caption="属性" Width="80px" Sortable="true"/>
                                <GridColumn Key="Operator" Caption="操作符" Width="80px" Sortable="true"/>
                                <GridColumn Key="Value" Caption="值" Width="80px" Sortable="true"/>
                                <GridColumn Key="RightBrackets" Caption="右括号" Width="80px" Sortable="true"/>
                                <GridColumn Key="LogicalOperator" Caption="逻辑运算符" Width="80px" Sortable="true"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="row1" RowHeight="35" TableKey="LRP_PutawayStrategy_CM_L">
                                    <GridCell Key="LeftBrackets" Caption="左括号" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="LeftBrackets"/>
                                        <Item Caption="(" Key="ParenthesesLeft1" Value="("/>
                                        <Item Caption="((" Key="ParenthesesLeft2" Value="(("/>
                                        <Item Caption="(((" Key="ParenthesesLeft3" Value="((("/>
                                    </GridCell>
                                    <GridCell Key="ObjectAttrib" Caption="属性" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="ObjectAttrib" Required="true"/>
                                        <Item Caption="仓储中心" Key="H.WarehouseCenterId" Value="H.WarehouseCenterId"/>
                                        <Item Caption="货主" Key="H.OwnerId" Value="H.OwnerId"/>
                                        <Item Caption="通知单号" Key="H.NoticeNo" Value="H.NoticeNo"/>
                                        <Item Caption="物料状态" Key="L.DestMaterialStatusId" Value="L.DestMaterialStatusId"/>
                                    </GridCell>
                                    <GridCell Key="Operator" Caption="操作符" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="Operator" Required="true"/>
                                        <Item Caption="等于" Key="Option1" Value="="/>
                                        <Item Caption="不等于" Key="Option2" Value="&lt;&gt;"/>
                                        <Item Caption="大于" Key="Option3" Value="&gt;"/>
                                        <Item Caption="大于等于" Key="Option4" Value="&gt;="/>
                                        <Item Caption="小于" Key="Option5" Value="&lt;"/>
                                        <Item Caption="小于等于" Key="Option6" Value="&lt;="/>
                                        <Item Caption="包含" Key="Option7" Value="like"/>
                                    </GridCell>
                                    <GridCell Key="Value" Caption="值" CellType="Dynamic" TypeFormula="GetCellValue('Grid1',-1,'ObjectAttrib')" TypeDependency="ObjectAttrib" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="Value" Required="true"/>
                                    </GridCell>
                                    <GridCell Key="RightBrackets" Caption="右括号" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="RightBrackets"/>
                                        <Item Caption=")" Key="ParenthesesRight1" Value=")"/>
                                        <Item Caption="))" Key="ParenthesesRight2" Value="))"/>
                                        <Item Caption=")))" Key="ParenthesesRight3" Value=")))"/>
                                    </GridCell>
                                    <GridCell Key="LogicalOperator" Caption="逻辑运算符" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="LogicalOperator"/>
                                        <Item Caption="并且" Key="And" Value="and"/>
                                        <Item Caption="或者" Key="Or" Value="or"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                        </Grid>
                        <Grid Key="Grid2" Caption="不可混放明细" Enable="!ReadOnly() &amp;&amp; (StrategyType==1||StrategyType==2||StrategyType==3||StrategyType==4)">
                            <GridColumnCollection>
                                <GridColumn Key="ObjectAttrib_02" Caption="属性" Width="80px" Sortable="true"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="row1" RowHeight="35" TableKey="LRP_PutawayStrategy_NoMix_L">
                                    <GridCell Key="ObjectAttrib_02" Caption="属性" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="ObjectAttrib" Required="true"/>
                                        <Item Caption="物料" Key="MaterialId" Value="MaterialId"/>
                                        <Item Caption="批号" Key="DestBatchNo" Value="DestBatchNo"/>
                                        <Item Caption="物料状态" Key="DestMaterialStatusId" Value="DestMaterialStatusId"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                        </Grid>
                        <Grid Key="Grid3" Caption="储位匹配明细" Enable="!ReadOnly() &amp;&amp; (StrategyType==1||StrategyType==2||StrategyType==3||StrategyType==4)">
                            <GridColumnCollection>
                                <GridColumn Key="LeftBrackets_03" Caption="左括号" Width="80px" Sortable="true"/>
                                <GridColumn Key="ObjectAttrib_03" Caption="属性" Width="80px" Sortable="true"/>
                                <GridColumn Key="Operator_03" Caption="操作符" Width="80px" Sortable="true"/>
                                <GridColumn Key="Value_03" Caption="值" Width="80px" Sortable="true"/>
                                <GridColumn Key="RightBrackets_03" Caption="右括号" Width="80px" Sortable="true"/>
                                <GridColumn Key="LogicalOperator_03" Caption="逻辑运算符" Width="80px" Sortable="true"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="row1" RowHeight="35" TableKey="LRP_PutawayStrategy_Loc_L">
                                    <GridCell Key="LeftBrackets_03" Caption="左括号" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="LeftBrackets"/>
                                        <Item Caption="(" Key="ParenthesesLeft1_03" Value="("/>
                                        <Item Caption="((" Key="ParenthesesLeft2_03" Value="(("/>
                                        <Item Caption="(((" Key="ParenthesesLeft3_03" Value="((("/>
                                    </GridCell>
                                    <GridCell Key="ObjectAttrib_03" Caption="属性" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="ObjectAttrib"/>
                                        <Item Caption="仓间代码" Key="R.Code" Value="R.Code"/>
                                        <Item Caption="库区代码" Key="A.Code" Value="A.Code"/>
                                        <Item Caption="储位代码" Key="L.Code" Value="L.Code"/>
                                        <Item Caption="是拣货位" Key="L.IsPick" Value="L.IsPick"/>
                                        <Item Caption="储位类型" Key="L.LocTypeId" Value="L.LocTypeId"/>
                                        <Item Caption="储位ABC分类" Key="L.ABCType" Value="L.ABCType"/>
                                    </GridCell>
                                    <GridCell Key="Operator_03" Caption="操作符" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="Operator"/>
                                        <Item Caption="等于" Key="Option1" Value="="/>
                                        <Item Caption="不等于" Key="Option2" Value="&lt;&gt;"/>
                                        <Item Caption="大于" Key="Option3" Value="&gt;"/>
                                        <Item Caption="大于等于" Key="Option4" Value="&gt;="/>
                                        <Item Caption="小于" Key="Option5" Value="&lt;"/>
                                        <Item Caption="小于等于" Key="Option6" Value="&lt;="/>
                                        <Item Caption="包含" Key="Option7" Value="like"/>
                                    </GridCell>
                                    <GridCell Key="Value_03" Caption="值" CellType="Dynamic" TypeFormula="GetCellValue('Grid3',-1,'ObjectAttrib_03')" TypeDependency="ObjectAttrib" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="Value" Required="true"/>
                                    </GridCell>
                                    <GridCell Key="RightBrackets_03" Caption="右括号" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="RightBrackets"/>
                                        <Item Caption=")" Key="ParenthesesRight1" Value=")"/>
                                        <Item Caption="))" Key="ParenthesesRight2" Value="))"/>
                                        <Item Caption=")))" Key="ParenthesesRight3" Value=")))"/>
                                    </GridCell>
                                    <GridCell Key="LogicalOperator_03" Caption="逻辑运算符" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="LogicalOperator"/>
                                        <Item Caption="并且" Key="And" Value="and"/>
                                        <Item Caption="或者" Key="Or" Value="or"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                        </Grid>
                        <Grid Key="Grid4" Caption="储位排序明细" Enable="!ReadOnly() &amp;&amp; (StrategyType==1||StrategyType==2||StrategyType==3||StrategyType==4)">
                            <GridColumnCollection>
                                <GridColumn Key="ObjectAttrib_04" Caption="属性" Width="80px" Sortable="true"/>
                                <GridColumn Key="AscDesc_04" Caption="排序方向" Width="80px" Sortable="true"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="row1" RowHeight="35" TableKey="LRP_PutawayStrategy_LS_L">
                                    <GridCell Key="ObjectAttrib_04" Caption="属性" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="ObjectAttrib" Required="true"/>
                                        <Item Caption="储位代码" Key="L.Code" Value="L.Code"/>
                                        <Item Caption="储位ABC分类" Key="L.ABCType" Value="L.ABCType"/>
                                        <Item Caption="排序" Key="L.SortOrder" Value="L.SortOrder"/>
                                    </GridCell>
                                    <GridCell Key="AscDesc_04" Caption="排序方向" CellType="ComboBox" Enable="!ReadOnly()">
                                        <DataBinding ColumnKey="AscDesc" Required="true"/>
                                        <Item Caption="升序" Key="ASC" Value="ASC"/>
                                        <Item Caption="降序" Key="DESC" Value="DESC"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                        </Grid>
                    </TabPanel>
                    <SplitSize Size="190px"/>
                    <SplitSize Size="100%"/>
                </SplitPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
    <MacroCollection>
        <Macro Key="MatchWhereSql_Save">
            <![CDATA[
			      //条件匹配明细
					var sql=' ';
					var i=0;
					var count = GetRowCount('Grid1',false);
                       //遍历grid1
                    if(count>0){
						while ( i < count ) {
							//条件匹配明细保存时将明细的内容拼成Where子句放到头挡匹配条件SQL字段中
							if(GetCellValue('Grid1', i, 'LeftBrackets')!=''){
								sql=sql+GetCellValue('Grid1', i, 'LeftBrackets')+' ';
							}
							if(GetCellValue('Grid1', i, 'ObjectAttrib')!=''){
								sql=sql+GetCellValue('Grid1', i, 'ObjectAttrib')+' ';
							}
							if(GetCellValue('Grid1', i, 'Operator')+' '!=''){
								sql=sql+GetCellValue('Grid1', i, 'Operator')+' ';
							}
							if(GetCellValue('Grid1', i, 'Value')+' '!=''){
								sql=sql+"'"+ToString(GetCellValue('Grid1', i, 'Value'))+"' ";
							}
							if(GetCellValue('Grid1', i, 'RightBrackets')+' '!=''){
								sql=sql+GetCellValue('Grid1', i, 'RightBrackets')+' ';
							}
							if(GetCellValue('Grid1', i, 'LogicalOperator')+' '!=''){
								sql=sql+GetCellValue('Grid1', i, 'LogicalOperator')+' ';
							}
							//条件匹配明细保存若不是最后一行，则逻辑运算符不可为空
							 if(i==count-1){
									if(GetCellValue('Grid1', i, 'LogicalOperator')!='')
									{
										Confirm(LocaleString('CHshow','chkey25'),'OK','OK:{}'); 
										break;
									}
								else{
									   if(sql != ''){
											SetValue('MatchWhereSql', sql);
											var ErrorMassage = LocaleString('STshow','stkey8');
											InvokeService("LRP_StategySqlCheck", true, true,MatchCheckSql,MatchWhereSql,ErrorMassage);
											return true;
									   }
									 }
								}else{
									if(GetCellValue('Grid1', i, 'LogicalOperator')==''){
										Confirm(LocaleString('CHshow','chkey26'),'OK','OK:{}'); 
										break;
									}
								}
							   i=i+1;
							}
							}else{
								SetValue('MatchWhereSql', '');
								return true;
								}
					]]>
        </Macro>
        <Macro Key="LocWhereSql_Save">
            <![CDATA[
			     //储位匹配明细保存时将明细的内容拼成子句放到头挡储位匹配SQL字段中
					var sql2=' ';
					var j=0;
					var count1 = GetRowCount('Grid3',false);
                      //遍历grid3
                    if(count1>0){
						while ( j < count1 ) {
							//储位匹配明细保存时将明细的内容拼成Where子句放到头挡库存储位匹配SQL字段中
							if(GetCellValue('Grid3', j, 'LeftBrackets_03')!=''){
								sql2=sql2+GetCellValue('Grid3', j, 'LeftBrackets_03')+' ';
							}
							if(GetCellValue('Grid3', j, 'ObjectAttrib_03')!=''){
								sql2=sql2+GetCellValue('Grid3', j, 'ObjectAttrib_03')+' ';
							}
							if(GetCellValue('Grid3', j, 'Operator_03')+' '!=''){
								sql2=sql2+GetCellValue('Grid3', j, 'Operator_03')+' ';
							}
							if(GetCellValue('Grid3', j, 'Value_03')+' '!=''){
								sql2=sql2+"'"+ToString(GetCellValue('Grid3', j, 'Value_03'))+"' ";
							}
							if(GetCellValue('Grid3', j, 'RightBrackets_03')+' '!=''){
								sql2=sql2+GetCellValue('Grid3', j, 'RightBrackets_03')+' ';
							}
							if(GetCellValue('Grid3', j, 'LogicalOperator_03')+' '!=''){
								sql2=sql2+GetCellValue('Grid3', j, 'LogicalOperator_03')+' ';
							}
							//储位匹配明细保存若不是最后一行，则逻辑运算符不可为空
                          if(j==count1-1){
									if(GetCellValue('Grid3', j, 'LogicalOperator_03')!='')
									{
										Confirm(LocaleString('CHshow','chkey25'),'OK','OK:{}'); 
										break;
									}
								else{
									   if(sql2 != ''){
											SetValue('LocWhereSql', sql2);
											var LocWhereSql=GetValue('LocWhereSql');
											var ErrorMassage = LocaleString('STshow','stkey12');
											InvokeService("LRP_StategySqlCheck", true, true,LocCheckSql,LocWhereSql,ErrorMassage);
											return true;
									   }
									 }
								}else{
									if(GetCellValue('Grid3', j, 'LogicalOperator_03')==''){
										Confirm(LocaleString('CHshow','chkey25'),'OK','OK:{}'); 
										break;
									}
								}
							   j=j+1;
							}
							}else{
								SetValue('LocWhereSql', '');
								return true;
								}
                    ]]>
        </Macro>
        <Macro Key="LocSortSql_Save">
            <![CDATA[
			        //储位排序明细保存时将明细的内容拼成排序子句放到头挡储位排序SQL字段中
					var count2 = GetRowCount('Grid4',false);
					var k=0;
					var orderStr1='  ';
					if(count2>0){
					while(k<count2){
						if(k==count2-1){
							orderStr1=orderStr1+GetCellValue('Grid4', k, 'ObjectAttrib_04')+' '+GetCellValue('Grid4', k, 'AscDesc_04');
							if(orderStr1 != ''){
							SetValue('LocSortSql', orderStr1);
                          return true;
		}
						}else{
							orderStr1=orderStr1+GetCellValue('Grid4', k, 'ObjectAttrib_04')+' '+GetCellValue('Grid4', k, 'AscDesc_04')+',';
						}
						k=k+1;
					}
					}
					else
						{
						SetValue('LocSortSql', '');
						return true;  
					}]]>
        </Macro>
    </MacroCollection>
</Form>
