<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="MyRegister"  FormType="Entity" Authenticate="false">
    <QueryCollection>
        <Query Key="QueryOrgItemList">
            <Statement>
                <![CDATA[select OID as k,name as n from LRP_DispatchOrg]]>
            </Statement>
        </Query>
    </QueryCollection>
    <Body>
        <Block>
            <GridLayoutPanel Key="root_pnl">
                <TableView Key="root" X="0" Y="0">
                    <Format BackColor="#f1f3f8"/>
                    <TableRowCollection>
                        <TableRow Key="r2" SeparatorStyle="solid none" SeparatorColor="#dde0e7" TopMargin="10px">
                            <LinearLayoutPanel Key="Nickname_panel" Orientation="Horizontal" Height="50px" LeftPadding="20px">
                                <Label Key="lbl_Nickname" Caption="用户名" Width="100px" Height="auto">
                                    <Format ForeColor="#969696">
                                        <Font Size="16"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="Nickname" Caption="用户名" PromptText="用户名" BorderStyle="none" Width="0px" Weight="1.0" Height="auto">
                                    <Format ForeColor="#dde0e7">
                                        <Font Size="16"/>
                                    </Format>
                                </TextEditor>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="r2_attention" SeparatorStyle="none none solid none" SeparatorColor="#dde0e7">
                            <LinearLayoutPanel Key="attention_panel" Orientation="Horizontal" Height="30px" LeftPadding="20px">
                                <Label Key="lbl_attention" Caption="*用户名不可输入汉字，至少包含一个非数字字符" Weight="1.0" Height="auto">
                                    <Format ForeColor="#f14c52">
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="r3" SeparatorStyle="solid none" SeparatorColor="#dde0e7" TopMargin="10px">
                            <LinearLayoutPanel Key="RealName_panel" Orientation="Horizontal" Height="50px" LeftPadding="20px">
                                <Label Key="lbl_RealName" Caption="真实姓名" Width="100px" Height="auto">
                                    <Format ForeColor="#969696">
                                        <Font Size="16"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="RealName" Caption="真实姓名" PromptText="真实姓名" BorderStyle="none" Width="0px" Weight="1.0" Height="auto">
                                    <Format ForeColor="#dde0e7">
                                        <Font Size="16"/>
                                    </Format>
                                </TextEditor>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="rOrg" SeparatorStyle="solid none" SeparatorColor="#dde0e7" TopMargin="10px">
                            <LinearLayoutPanel Key="rOrg_panel" Orientation="Horizontal" Height="50px" LeftPadding="20px">
                                <Label Key="lbl_DefaultDispatchOrgId" Caption="默认调度组织" Height="auto" Width="100px">
                                    <Format ForeColor="#969696">
                                        <Font Size="16"/>
                                    </Format>
                                </Label>
                                <ComboBox Key="DefaultDispatchOrgId" Caption="默认调度组织" PromptText="默认调度组织" BorderStyle="none" Width="auto" Weight="1.0" Height="auto" DynamicItems="True" SourceType="Formula">
                                    <Format ForeColor="#dde0e7">
                                        <Font Size="16"/>
                                    </Format>
                                    <FormulaItems>
                                        <![CDATA[DBNamedQuery('QueryOrgItemList')]]>
                                    </FormulaItems>
                                </ComboBox>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="BeInvitedCode1" SeparatorStyle="solid none" SeparatorColor="#dde0e7" TopMargin="10px">
                            <LinearLayoutPanel Key="BeInvitedCode_panel" Orientation="Horizontal" Height="50px" LeftPadding="20px">
                                <Label Key="lbl_BeInvitedCode" Caption="邀请码" Height="auto" Width="100px">
                                    <Format ForeColor="#969696">
                                        <Font Size="16"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="BeInvitedCode" Caption="邀请码" PromptText="请输入邀请码" BorderStyle="none" Width="0px" Weight="1.0" Height="auto" MaxLength="11">
                                    <Format ForeColor="#dde0e7">
                                        <Font Size="16"/>
                                    </Format>
                                </TextEditor>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="r4" SeparatorStyle="solid none" SeparatorColor="#dde0e7" TopMargin="10px">
                            <LinearLayoutPanel Key="Mobile_panel" Orientation="Horizontal" Height="50px" LeftPadding="20px">
                                <Label Key="lbl_Mobile" Caption="手机" Width="100px" Height="auto">
                                    <Format ForeColor="#969696">
                                        <Font Size="16"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="Mobile" Caption="手机" PromptText="手机" BorderStyle="none" Width="0px" Weight="1.0" Height="auto">
                                    <Format ForeColor="#dde0e7">
                                        <Font Size="16"/>
                                    </Format>
                                </TextEditor>
                                <Button Key="Mobile_btn" Caption="发送验证码" Enable="True" Width="100px" Height="auto" BorderStyle="none">
                                    <Format BackColor="#f14c52" ForeColor="#ffffff">
                                        <Font Size="13"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
										if(IsNull(Mobile) || Length(Mobile) == 0){
											ShowToast("请输入手机号");
											return true;
										}
										InvokeUnsafeService('LRP_VerificationCodeSave', false, false , Mobile);
										ShowToast("验证码已发送");
										SetValue('Mobile_btn',90);
									]]>
                                    </OnClick>
                                </Button>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="Code_tablerow" SeparatorStyle="solid none" SeparatorColor="#dde0e7" TopMargin="10px">
                            <LinearLayoutPanel Key="Code_panel" Orientation="Horizontal" Height="50px" LeftPadding="20px">
                                <Label Key="lbl_Code" Caption="手机验证码" Width="100px" Height="auto">
                                    <Format ForeColor="#969696">
                                        <Font Size="16"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="Code" Caption="手机验证码" PromptText="手机验证码" BorderStyle="none" Width="0px" Weight="1.0" Height="auto">
                                    <Format ForeColor="#dde0e7">
                                        <Font Size="16"/>
                                    </Format>
                                </TextEditor>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="r5" SeparatorStyle="solid none" SeparatorColor="#dde0e7" TopMargin="10px">
                            <LinearLayoutPanel Key="password_panel" Orientation="Horizontal" Height="50px" LeftPadding="20px">
                                <Label Key="lbl_password" Caption="密码" Width="100px" Height="auto">
                                    <Format ForeColor="#969696">
                                        <Font Size="16"/>
                                    </Format>
                                </Label>
                                <PasswordEditor Key="password" Caption="密码" PromptText="请输入密码" BorderStyle="none" Width="0px" Weight="1.0" Height="auto">
                                    <Format ForeColor="#dde0e7">
                                        <Font Size="16"/>
                                    </Format>
                                </PasswordEditor>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="r6" SeparatorStyle="solid none" SeparatorColor="#dde0e7" TopMargin="10px">
                            <LinearLayoutPanel Key="confirm_password_panel" Orientation="Horizontal" Height="50px" LeftPadding="20px">
                                <Label Key="lbl_confirm_password" Caption="确认密码" Width="100px" Height="auto">
                                    <Format ForeColor="#969696">
                                        <Font Size="16"/>
                                    </Format>
                                </Label>
                                <PasswordEditor Key="confirm_password" Caption="确认密码" PromptText="请再次输入密码" BorderStyle="none" Width="0px" Weight="1.0" Height="auto">
                                    <Format ForeColor="#dde0e7">
                                        <Font Size="16"/>
                                    </Format>
                                </PasswordEditor>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="r7" TopMargin="30px">
                            <GridLayoutPanel Key="header" Height="50px">
                                <Format BackColor="#f1f3f8"/>
                                <Button Key="order" Caption="注册" Enable="True" Width="pref" Height="auto" Weight="1.0" BorderStyle="none" X="1" Y="0">
                                    <Format BackColor="#f14c52" ForeColor="#ffffff">
                                        <Font Size="20"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[
										InvokeUnsafeService('LRP_AppRegister', false, false , Nickname , RealName ,Mobile ,  EncryptPassword(password),EncryptPassword(confirm_password),DefaultDispatchOrgId,BeInvitedCode,Code);
															Close();
									]]>
                                    </OnClick>
                                </Button>
                                <RowDefCollection>
                                    <RowDef Height="50px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="30px"/>
                                    <ColumnDef Width="100%"/>
                                    <ColumnDef Width="30px"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
                <RowDefCollection>
                    <RowDef Height="100%"/>
                </RowDefCollection>
                <ColumnDefCollection>
                    <ColumnDef Width="100%"/>
                </ColumnDefCollection>
            </GridLayoutPanel>
        </Block>
    </Body>
    <OnLoad>
        <![CDATA[ 
			var table = GetBDLocation();
			 if(table==null){
				ShowToast("定位调度组织失败，请自己选择");
				return true;
			}
			var latitude = table.get('latitude');
			var longitude = table.get('longitude');
			var dispatchOrgId = InvokeUnsafeService('LRP_GetCurrentDispatchOrgId',false,false,latitude,longitude);
			if(dispatchOrgId==0){
				ShowToast("定位调度组织失败，请自己选择");
			}else{
				SetValue('DefaultDispatchOrgId',dispatchOrgId);
			}
		]]>
    </OnLoad>
    <TimerTaskCollection>
        <TimerTask Key="MessageNotice" Period="1000" Repeat="true" Enable="True">
            <![CDATA[
				if(Mobile_btn>0&&Mobile_btn<=90){
					SetValue('Mobile_btn',Mobile_btn-1);
					SetEnable('Mobile_btn',false);
				}
				if(Mobile_btn==1){
					SetValue('Mobile_btn','发送验证码');
					SetEnable('Mobile_btn',true);
					return true;
				}
            ]]>
        </TimerTask>
    </TimerTaskCollection>
    <NavigationBar BackColor="#f14c52" Style="Custom">
        <BarItem Key="TitleCenter_bar" Caption="用户注册" Location="Center">
            <Label Key="TitleCenter" Caption="用户注册" Width="100%">
                <Format ForeColor="#ffffff" HAlign="Center">
                    <Font Size="16"/>
                </Format>
            </Label>
        </BarItem>
    </NavigationBar>
</Form>
