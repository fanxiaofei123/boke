<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="ExtraService" Authenticate="false">
    <DataSource>
        <DataObject Key="ExtraService1" Caption="额外服务" Authenticate="false">
            <TableCollection>
                <Table Key="ExtraService" Caption="ExtraService" SourceType="Query">
                    <Column Key="OID" Caption="对象标识" DataType="Long"/>
                    <Column Key="Name" Caption="名称" DataType="Varchar"/>
                    <Column Key="Code" Caption="code" DataType="Varchar"/>
                    <Column Key="ServiceAmount" Caption="金额" DataType="Numeric" Precision="18" Scale="6"/>
                    <Column Key="sel" Caption="状态" DataType="Integer"/>
                    <Statement>
                        <![CDATA[select t.oid,t.code,t.name,null as ServiceAmount,0 as sel from lrp_logisticsservice t]]>
                    </Statement>
                </Table>
            </TableCollection>
        </DataObject>
    </DataSource>
    <Body>
        <Block>
            <GridLayoutPanel Key="root">
                <Format BackColor="#ffffff"/>
                <TableView Key="main" X="0" Y="0">
                    <TableRowCollection>
                        <TableRow Key="r1">
                            <Label Key="LogisticsService_title" Caption="服务标题" Width="auto" Height="50px" Padding="10px">
                                <DataBinding DefaultValue="基础服务"/>
                                <Format HAlign="Left" BackColor="#ffffff">
                                    <Font Size="20"/>
                                </Format>
                            </Label>
                        </TableRow>
                        <TableRow Key="r2" RowType="Detail" TableKey="ExtraService" Style="Tiled">
                            <GridLayoutPanel Key="LogisticsServiceList" Height="80px">
                                <Format BackColor="#ffffff"/>
                                <GridLayoutPanel Key="LogisticsService" Height="60px" X="1" Y="1">
                                    <Format BackColor="#ffffff"/>
                                    <CheckBox Key="LogisticsService_sel" Width="auto" X="0" Y="0" YSpan="4" Icon="19-1.png" SelectedIcon="19.png" ImageScaleType="Fit_XY" Stretch="true" Visible="false">
                                        <DataBinding ColumnKey="sel" DefaultValue="0"/>
                                    </CheckBox>
                                    <Image Key="LogisticsServiceimage" X="0" Y="0" ImageScaleType="Fit_XY" PromptImage="002.png" Stretch="true" YSpan="3">
                                        <Format BackColor="#ffffff"/>
                                    </Image>
                                    <Label Key="LogisticsServiceName" Caption="需要装卸" X="0" Y="1">
                                        <DataBinding ColumnKey="Name"/>
                                        <Format ForeColor="#000000" HAlign="Center" BackColor="Transparent">
                                            <Font Size="16"/>
                                        </Format>
                                    </Label>
                                    <Label Key="LogisticsServiceDetail" Caption="(免费)" X="0" Y="0" Visible="false">
                                        <DataBinding ColumnKey="ServiceAmount"/>
                                        <Format ForeColor="#000000" HAlign="Center" BackColor="Transparent">
                                            <Font Size="12"/>
                                        </Format>
                                    </Label>
                                    <Label Key="LogisticsServiceDetail2" Caption="(免费)" X="0" Y="2">
                                        <Format ForeColor="#000000" HAlign="Center" BackColor="Transparent">
                                            <Font Size="12"/>
                                        </Format>
                                    </Label>
                                    <Label Key="oid" Caption="oid" X="0" Y="3" Visible="false">
                                        <DataBinding ColumnKey="OID"/>
                                        <Format ForeColor="#000000" HAlign="Center" BackColor="Transparent">
                                            <Font Size="12"/>
                                        </Format>
                                    </Label>
                                    <RowDefCollection>
                                        <RowDef Height="5px"/>
                                        <RowDef Height="25px"/>
                                        <RowDef Height="25px"/>
                                        <RowDef Height="5px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection>
                                        <ColumnDef Width="100%"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                                <RowDefCollection>
                                    <RowDef Height="10px"/>
                                    <RowDef Height="60px"/>
                                    <RowDef Height="10px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="100%"/>
                                    <ColumnDef Width="10px"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                            <RowClick>
                                <![CDATA[ if(GetCellValue('r2',GetRowIndex('r2'),'LogisticsService_sel')==0){
                            SetCellValue('r2',GetRowIndex('r2'),'LogisticsService_sel',1);
                            SetCellValue('r2',GetRowIndex('r2'),'LogisticsServiceimage','001.png');
                            SetPara('rowIndex',GetRowIndex('r2'));
                            if(LogisticsServiceName=='需带回款'){PopView('pop_spec_sel');}
                            }else{
                                SetCellValue('r2',GetRowIndex('r2'),'LogisticsService_sel',0);
                                SetCellValue('r2',GetRowIndex('r2'),'LogisticsServiceimage','002.png');
                                SetCellValue('r2',GetRowIndex('r2'),'LogisticsServiceDetail',null);
                                SetCellValue('r2',GetRowIndex('r2'),'LogisticsServiceDetail2','(免费)');
                            }
                            ]]>
                            </RowClick>
                        </TableRow>
                        <TableRow Key="r3" SeparatorStyle="solid none none none" SeparatorColor="#cccccc">
                            <GridLayoutPanel Key="LogisticsService22" Height="135px">
                                <Format BackColor="#ffffff"/>
                                <Label Key="LogisticsServiceName22" Caption="回单、回款详细说明" X="2" Y="1">
                                    <Format ForeColor="#000000" HAlign="Left">
                                        <Font Size="18"/>
                                    </Format>
                                </Label>
                                <Label Key="LogisticsServiceDetail22" Caption="回单、回款：" X="2" Y="3">
                                    <Format ForeColor="#cccccc" HAlign="Left">
                                        <Font Size="14"/>
                                    </Format>
                                </Label>
                                <Label Key="LogisticsServiceDetail23" Caption="." X="1" Y="3">
                                    <Format ForeColor="#000000" HAlign="Center">
                                        <Font Size="14"/>
                                    </Format>
                                </Label>
                                <Label Key="LogisticsServiceDetail24" Caption="司机最晚在服务完成后第二天中午12点之前将回执单、货款免费送回始发地（不包括回程带人、带货）。" SingleLine="false" X="2" Y="4">
                                    <Format ForeColor="#cccccc" HAlign="Left">
                                        <Font Size="14"/>
                                    </Format>
                                </Label>
                                <RowDefCollection>
                                    <RowDef Height="10px"/>
                                    <RowDef Height="25px"/>
                                    <RowDef Height="10px"/>
                                    <RowDef Height="20px"/>
                                    <RowDef Height="50px"/>
                                    <RowDef Height="20px"/>
                                </RowDefCollection>
                                <ColumnDefCollection>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="10px"/>
                                    <ColumnDef Width="100%"/>
                                    <ColumnDef Width="10px"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
                <LinearLayoutPanel Key="LogisticsServiceTrue_panel" Orientation="Horizontal" Height="45px" X="0" Y="1">
                    <Button Key="LogisticsServiceTrue" Caption="确认" Width="100%" Weight="1.0" Height="auto" BorderStyle="none">
                        <Format ForeColor="#ffffff" BackColor="#f14c52">
                            <Font Size="16"/>
                        </Format>
                        <OnClick>
                            <![CDATA[
                            var dtable=Parent.GetDataTable("LRP_TransportOrderService_L");
                            var returnvalue = "";
                            var count = GetRowCount('r2');							
                            var i=0;
                            dtable.clear();							                     
                            while(i<count){
                                if(GetCellValue('r2',i,'LogisticsService_sel')){
									    dtable.append();
									    dtable.ServiceId=GetCellValue('r2',i,'oid');
									    dtable.ServiceAmount=GetCellValue('r2',i,'LogisticsServiceDetail');
										if(GetCellValue('r2',i,'LogisticsServiceDetail')){
						                    returnvalue = returnvalue & GetCellValue('r2',i,'LogisticsServiceName') & GetCellValue('r2',i,'LogisticsServiceDetail') & "元、";
					                    }else{
					                        returnvalue = returnvalue & GetCellValue('r2',i,'LogisticsServiceName') & "、";}
										}							
										i=i+1;							
							}
                            if(Length(returnvalue) > 0){
					              returnvalue = Left(returnvalue, Length(returnvalue)-1);
				}
								    Parent.SetValue('Serv',returnvalue);
									Close();
                            
							]]>
                        </OnClick>
                    </Button>
                </LinearLayoutPanel>
                <RowDefCollection>
                    <RowDef Height="100%"/>
                    <RowDef Height="45px"/>
                </RowDefCollection>
                <ColumnDefCollection>
                    <ColumnDef Width="100%"/>
                </ColumnDefCollection>
            </GridLayoutPanel>
        </Block>
        <Block Root="false" Key="block_spec_sel">
            <PopView Key="pop_spec_sel" Height="145px">
                <GridLayoutPanel Key="pop_spec_sel_panel" Height="130px">
                    <Format BackColor="#ffffff"/>
                    <Label Key="spec_pop_title" Caption="司机需带回" X="1" Y="1" XSpan="6">
                        <Format ForeColor="#000000" HAlign="Center">
                            <Font Size="16"/>
                        </Format>
                    </Label>
                    <Label Key="spec_pop_jine" Caption="金额" X="1" Y="3">
                        <Format ForeColor="#cccccc" HAlign="Right">
                            <Font Size="14"/>
                        </Format>
                    </Label>
                    <NumberEditor Key="spec_pop_code" Precision="5" Scale="0" Caption="jine" PromptText="最高10000元" BorderStyle="none" X="3" Y="3" XSpan="4">
                        <Format>
                            <Font Size="14"/>
                        </Format>
                    </NumberEditor>
                    <Button Key="spec_pop_esc" Caption="取消" Enable="True" X="0" Y="5" XSpan="4" BorderStyle="solid" BorderColor="#808080" BorderRadius="4" HasBorder="true">
                        <Format ForeColor="#dde0e7" BackColor="#ffffff"/>
                        <OnClick>
                            <![CDATA[
							var rowIndex=Para('rowIndex');
							SetCellValue('r2',rowIndex,'LogisticsService_sel',0);
							SetCellValue('r2',rowIndex,'LogisticsServiceimage','002.png');
							ClosePop('pop_spec_sel');
							]]>
                        </OnClick>
                    </Button>
                    <Button Key="spec_pop_ok" Caption="确定" Enable="True" X="4" Y="5" XSpan="4" BorderStyle="solid" BorderColor="#808080" BorderRadius="4" HasBorder="true">
                        <Format ForeColor="#ffffff" BackColor="#f14c52"/>
                        <OnClick>
                            <![CDATA[
							var rowIndex=Para('rowIndex');
							if(spec_pop_code){
							SetCellValue('r2',rowIndex,'LogisticsServiceDetail',spec_pop_code);
							SetCellValue('r2',rowIndex,'LogisticsServiceDetail2',spec_pop_code+'元');}
							else{SetCellValue('r2',rowIndex,'LogisticsService_sel',0);
                                 SetCellValue('r2',rowIndex,'LogisticsServiceimage','002.png');		
							}
							ClosePop('pop_spec_sel');
							]]>
                        </OnClick>
                    </Button>
                    <RowDefCollection>
                        <RowDef Height="10px"/>
                        <RowDef Height="20px"/>
                        <RowDef Height="10px"/>
                        <RowDef Height="40px"/>
                        <RowDef Height="10px"/>
                        <RowDef Height="40px"/>
                    </RowDefCollection>
                    <ColumnDefCollection>
                        <ColumnDef Width="10px"/>
                        <ColumnDef Width="40px"/>
                        <ColumnDef Width="10px"/>
                        <ColumnDef Width="50%"/>
                        <ColumnDef Width="50%"/>
                        <ColumnDef Width="40px"/>
                        <ColumnDef Width="10px"/>
                        <ColumnDef Width="10px"/>
                    </ColumnDefCollection>
                </GridLayoutPanel>
                <OnClose>
                    <![CDATA[
					]]>
                </OnClose>
            </PopView>
        </Block>
        <ViewCollection>
            <View Key="All"/>
        </ViewCollection>
    </Body>
    <OnLoad>
        <![CDATA[
        LoadData();
        var dtable=Parent.GetDataTable("LRP_TransportOrderService_L");
        var count = GetRowCount('r2');
        dtable.beforefirst();
        while(dtable.next()){							
            var i=0;
            while(i<count){
                if(dtable.ServiceId==GetCellValue('r2',i,'oid')){
                    SetCellValue('r2',i,'LogisticsService_sel',1);
                    SetCellValue('r2',i,'LogisticsServiceimage','001.png'); 
                    if(dtable.ServiceAmount){
                        SetCellValue('r2',i,'LogisticsServiceDetail',dtable.ServiceAmount);
						SetCellValue('r2',i,'LogisticsServiceDetail2',dtable.ServiceAmount+'元');                    
                    }              
                }
                i=i+1;           
            }
        }
        ]]>
    </OnLoad>
    <FormParaCollection>
        <FormPara Formula="Para('rowIndex')" Key="rowIndex" Type="Formula"/>
    </FormParaCollection>
    <NavigationBar BackColor="#f14c52" Style="Custom">
        <BarItem Key="Centertitle" Caption="额外服务" Location="Center">
            <Label Key="TitleCenter" Caption="额外服务" Width="100%">
                <Format ForeColor="#ffffff" HAlign="Center">
                    <Font Size="20"/>
                </Format>
            </Label>
        </BarItem>
    </NavigationBar>
</Form>
