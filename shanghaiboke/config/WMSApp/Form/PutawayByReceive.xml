<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!--  Caption="按收货单上架" Authenticate="false" HasNavigationBar="false" -->
<Form Key="PutawayByReceive" FormType="View">
    <DataSource>
        <DataObject Key="LRP_PutawayByReceive" Caption="按收货单上架" PrimaryTableKey="LRP_Putaway_H">
            <TableCollection>
                <Table Key="LRP_Putaway_H" Caption="查找收货单" TableMode="Detail" SourceType="Query">
                    <Column Caption="对象标识" DataType="Long" Key="OID"/>
                    <Column Caption="状态" DataType="Integer" Key="Status"/>
                    <Column Caption="创建时间" DataType="DateTime" Key="CREATETIME"/>
                    <Column Caption="创建人" DataType="Long" Key="CREATOR"/>
                    <Column Caption="通知单号" DataType="Varchar" Key="No" Length="100"/>
                    <Column Caption="货主单号" DataType="Varchar" Key="OwnerNo" Length="100"/>
                    <Column Caption="仓储中心id" DataType="Long" Key="WarehouseCenterId"/>
                    <Column Caption="货主id" DataType="Long" Key="OwnerId"/>
                    <Column Key="OwnerName" Caption="货主名称" DataType="Varchar" Length="200"/>
                    <Column Caption="事务类型" DataType="Long" Key="TxTypeId"/>
                    <Column Caption="事务代码" DataType="Varchar" Key="TxTypeCode" Length="10"/>
                    <Column Caption="事务日期时间" DataType="DateTime" Key="TxDateTime"/>
                    <Column Key="TextEditor1" Caption="TextEditor1" DataType="Varchar"/>
                    <ParameterCollection>
                        <Parameter Formula="GetPara('UserDispatchOrg')" DataType="Long"/>
                    </ParameterCollection>
                    <Statement>
                        <![CDATA[
 select 
    h.OID,
	h.Status,
	h.CREATETIME,
	h.CREATOR,
    h.No,
    h.TxTypeId,
    h.TxTypeCode,
    h.OwnerNo,
    h.NoticeNo,
    h.RefNo,
    h.WarehouseCenterId,
	h.OwnerId,
	o.Name as OwnerName,
    h.TxDateTime,
	h.WarehouseKeeperId,
	h.Remark
from LRP_WMTx_H h left join LRP_Owner o on o.oid = h.OwnerId
    where
        h.TxTypeCode in ('101','102','103') and h.WarehouseCenterId = ? and h.Status=900

    ]]>
                    </Statement>
                </Table>
                <Table Key="LRP_Putaway_HHis" Caption="上架历史" TableMode="Detail" SourceType="Query">
                    <Column Caption="对象标识" DataType="Long" Key="OID"/>
                    <Column Caption="状态" DataType="Integer" Key="Status"/>
                    <Column Caption="创建时间" DataType="DateTime" Key="CREATETIME"/>
                    <Column Caption="事务单号" DataType="Varchar" Key="No" Length="100"/>
                    <Column Caption="事务类型" DataType="Long" Key="TxTypeId"/>
                    <Column Caption="事务代码" DataType="Varchar" Key="TxTypeCode" Length="10"/>
                    <Column Caption="货主单号" DataType="Varchar" Key="OwnerNo" Length="100"/>
                    <Column Caption="通知单号" DataType="Varchar" Key="NoticeNo" Length="100"/>
                    <Column Caption="关联单号" DataType="Varchar" Key="RefNo" Length="100"/>
                    <Column Caption="仓储中心id" DataType="Long" Key="WarehouseCenterId"/>
                    <Column Caption="货主id" DataType="Long" Key="OwnerId"/>
                    <Column Key="OwnerName" Caption="货主名称" DataType="Varchar" Length="200"/>
                    <Column Caption="事务日期时间" DataType="DateTime" Key="TxDateTime"/>
                    <Column Caption="仓管员id" DataType="Long" Key="WarehouseKeeperId"/>
                    <Column Caption="备注" DataType="Varchar" Expand="true" Key="Remark" Length="1000"/>
                    <ParameterCollection>
                        <Parameter Formula="GetUserOperator()" DataType="Long"/>
                        <Parameter Formula="GetPara('UserDispatchOrg')" DataType="Long"/>
                    </ParameterCollection>
                    <Statement>
                        <![CDATA[
select 
    h.OID,
	h.Status,
	h.CREATETIME,
    h.No,
    h.TxTypeId,
    h.TxTypeCode,
    h.OwnerNo,
    h.NoticeNo,
    h.RefNo,
    h.WarehouseCenterId,
	h.OwnerId,
	o.Name as OwnerName,
    h.TxDateTime,
	h.WarehouseKeeperId,
	h.Remark
from LRP_WMTx_H h join LRP_Owner o on o.oid = h.OwnerId
    where
        h.TxTypeCode ='111' and h.WarehouseKeeperId = ? and h.WarehouseCenterId = ? order by h.TxDateTime desc
	
    ]]>
                    </Statement>
                </Table>
            </TableCollection>
        </DataObject>
    </DataSource>
    <QueryCollection>
        <Query Key="SelectOwner" Description="查找货主">
            <Statement>
                <![CDATA[select code as c,name as n from lrp_Owner]]>
            </Statement>
        </Query>
    </QueryCollection>
    <Body>
        <Block>
            <GridLayoutPanel Key="root">
                <Format BackColor="#f1f3f8"/>
                <!--
                <LinearLayoutPanel Caption="Title" Key="Title" Orientation="Horizontal" X="0" Y="0">
                    <Format BackColor="#f14c52"/>
                    <Label Key="OrderTitle" Caption="按收货单上架" Height="auto" Weight="1.0">
                        <Format ForeColor="#ffffff" HAlign="Center">
                            <Font Size="20"/>
                        </Format>
                    </Label>
                </LinearLayoutPanel>
                -->
                <Label Key="ShowValue" X="0" Y="0" Visible="false"/>
                <TabGroup Caption="按收货单上架" Key="TabPanel1" IndicatorColor="#ff5000" X="0" Y="0">
                    <TabItem Text="查找收货单">
                        <Action>
                            <![CDATA[SetValue('ShowValue', 0);]]>
                        </Action>
                    </TabItem>
                    <TabItem Text="上架历史">
                        <Action>
                            <![CDATA[SetValue('ShowValue', 1);]]>
                        </Action>
                    </TabItem>
                </TabGroup>
                <TableView Key="RouteName_table" X="0" Y="1" Visible="ShowValue==0">
                    <Format BackColor="#f1f3f8"/>
                    <TableRowCollection>
                        <TableRow Key="r1" SeparatorStyle="solid none none none" SeparatorColor="#dde0e7" TopMargin="6px" Height="auto">
                            <LinearLayoutPanel Key="service_center_panel" Height="50px" Orientation="Horizontal">
                                <Label Key="lab_NoticeNo3" Caption="通知单号" LeftPadding="5px" Height="auto">
                                    <Format HAlign="Center">
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="NoticeNo3" Caption="通知单号" Width="100px" Height="auto">
                                    <Format ForeColor="#969696">
                                        <Font Size="13"/>
                                    </Format>
                                    <Condition CondSign="=">
                                        <ConditionTarget TableKey="LRP_Putaway_H" ColumnKey="No"/>
                                    </Condition>
                                </TextEditor>
                                <Label Key="lab_OwnerId3" Caption="货主" LeftPadding="5px" Height="auto">
                                    <Format HAlign="Center">
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Dict Key="OwnerId3" Caption="货主" ItemKey="LRP_Owner" Width="pref" Weight="1.0" Height="auto">
                                    <Format ForeColor="#969696">
                                        <Font Size="13"/>
                                    </Format>
                                    <Condition CondSign="=">
                                        <ConditionTarget TableKey="LRP_Putaway_H" ColumnKey="OwnerId"/>
                                    </Condition>
                                </Dict>
                                <!--
                                <ComboBox Key="OwnerId" Caption="货主" SourceType="Formula" Weight="1.0" Height="auto">
                                    <Format ForeColor="#969696" HAlign="Left">
                                        <Font Size="13"/>
                                    </Format>
                                    <Condition CondSign="=">
                                        <ConditionTarget TableKey="LRP_Putaway_H" ColumnKey="OwnerId"/>
                                    </Condition>
                                    <FormulaItems>
                                        <![CDATA[DBNamedQuery('SelectOwner')]]>
                                    </FormulaItems>
                                </ComboBox>-->
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="r2" SeparatorStyle="solid solid solid none" SeparatorColor="#ffffff">
                            <LinearLayoutPanel Key="service_center_panel2" Height="50px" Orientation="Horizontal">
                                <Label Key="lab_ReceiveDate" Caption="收货日期" LeftPadding="5px" Height="auto">
                                    <Format HAlign="Center">
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <DatePicker Key="ReceiveDate" Caption="收货日期" Requird="true" Width="100px" Height="auto" Format="yyyy-MM-dd">
                                    <DataBinding DefaultFormulaValue="ServerDate();"/>
                                    <Format ForeColor="#969696">
                                        <Font Size="13"/>
                                    </Format>
                                </DatePicker>
                                <DatePicker Caption="收货日期" Key="ReceiveDate_From" Visible="false">
                                    <DataBinding DefaultFormulaValue="Format(ReceiveDate,'yyyy-MM-dd')&amp;' 00:00:00'"/>
                                    <Condition CondSign="between" Group="TxDateTime" GroupHead="true">
                                        <ConditionTarget TableKey="LRP_Putaway_H" ColumnKey="TxDateTime"/>
                                    </Condition>
                                </DatePicker>
                                <DatePicker Caption="收货日期至" Key="ReceiveDate_To" Visible="false">
                                    <DataBinding DefaultFormulaValue="Format(ReceiveDate,'yyyy-MM-dd')&amp;' 23:59:59'"/>
                                    <Condition CondSign="none" Group="TxDateTime" GroupTail="true">
                                        <ConditionTarget TableKey="LRP_Putaway_H" ColumnKey="TxDateTime"/>
                                    </Condition>
                                </DatePicker>
                                <Label Key="lab_OwnerNo3" Caption="货主单号" LeftPadding="5px" Height="auto">
                                    <Format HAlign="Center">
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <TextEditor Key="OwnerNo3" Caption="货主单号" Width="pref" Weight="1.0" Height="auto">
                                    <DataBinding ColumnKey="OwnerNo" TableKey="LRP_Putaway_H"/>
                                    <Format ForeColor="#969696">
                                        <Font Size="13"/>
                                    </Format>
                                    <Condition CondSign="like">
                                        <ConditionTarget TableKey="LRP_Putaway_H" ColumnKey="OwnerNo"/>
                                    </Condition>
                                </TextEditor>
                            </LinearLayoutPanel>
                        </TableRow>
                        <TableRow Key="r3" SeparatorStyle="solid solid solid none" SeparatorColor="#ffffff">
                            <LinearLayoutPanel Key="service_center_panel3" Height="35px" Orientation="Horizontal">
                                <Label Key="lab_Qurey" Width="pref" Weight="1.0" Height="auto">
                                    <Format>
                                        <Font Size="13"/>
                                    </Format>
                                </Label>
                                <Button Key="Qurey" Caption="查找" Width="200px" BorderRadius="4" BorderColor="#dde0e7" HasBorder="true">
                                    <Format ForeColor="#ffffff" BackColor="#f14c52">
                                        <Font Size="13"/>
                                    </Format>
                                    <OnClick>
                                        <![CDATA[DealCondition();LoadData();
IsShow=1;
										
									]]>
                                    </OnClick>
                                </Button>
                                <TextEditor Key="IsShow" Visible="false" Height="pref" Width="pref">
                                    <DataBinding DefaultValue="0"/>
                                </TextEditor>
                            </LinearLayoutPanel>
                        </TableRow>
                    </TableRowCollection>
                </TableView>
                <GridLayoutPanel Key="GridLayoutPanel1" Caption="进行中" X="0" Y="2">
                    <Format BackColor="#ffffff"/>
                    <!--  <RefreshControl ColorSchemes="#17bb92" Key="RefreshControl1" Caption="刷新控件"  ProgressBackgroundColorScheme="#cccccc">
					<RefreshHeader Icon="" PromptText="正在加载" FinishText="加载完成">
						<Format/>
							<![CDATA[LoadData();ShowToast("没有更多的消息了")]]>
					</RefreshHeader>
					<RefreshFooter Icon="" PromptText="正在加载" FinishText="加载完成">
						<Format/>
						<![CDATA[LoadData();ShowToast("没有更多的消息了")]]>
					</RefreshFooter> -->
                    <ListView Caption="查找收货单" Key="list" TableKey="LRP_Putaway_H" RowHeight="80" Enable="true" SeparatorStyle="solid none solid none" HasBorder="true" BorderColor="#e6e6e6" Padding="5px" X="0" Y="0" Visible="(ShowValue==0 &amp;&amp; IsShow&lt;&gt;0)|| (Length(ShowValue) == 0&amp;&amp; IsShow&lt;&gt;0)">
                        <Format Font="20px"/>
                        <ListViewColumnCollection>
                            <ListViewColumn Key="SelectField" IsSelect="true" DefaultValue="0" ColumnType="CheckBox" Visible="false" Icon="flight_check_unselect.png" SelectedIcon="flight_check_select.png" Stretch="true" ImageScaleType="Fit_XY"/>
                            <ListViewColumn Key="NoticeNo" DataColumnKey="No" Caption="通知单号"/>
                            <ListViewColumn Caption="货主" DataColumnKey="OwnerName" Key="OwnerName"/>
                            <ListViewColumn Caption="事务类型" ColumnType="ComboBox" DataColumnKey="TxTypeCode" Key="TxTypeCode">
                                <Item Caption="按通知收货单" Key="101" Value="101"/>
                                <Item Caption="无通知收货单" Key="102" Value="102"/>
                                <Item Caption="退货收货单" Key="103" Value="103"/>
                            </ListViewColumn>
                            <ListViewColumn Caption="下单日期" ColumnType="DatePicker" DataColumnKey="CREATETIME" Key="CREATETIME">
                                <Format HAlign="Left"/>
                            </ListViewColumn>
                            <ListViewColumn Key="OwnerNo" DataColumnKey="OwnerNo"/>
                            <ListViewColumn Caption="收货人" DataColumnKey="CREATOR" Key="Creator"/>
                            <ListViewColumn Key="OID" DataColumnKey="OID" Caption="OID"/>
                        </ListViewColumnCollection>
                        <RowClick>
                            <![CDATA[
								PushPara('OID',OID);
								PushPara('NoticeNo',NoticeNo);
								PushPara('OwnerName',OwnerName);
								PushPara('OwnerNo',OwnerNo);
								PushPara('TxTypeCode',TxTypeCode);
								
								Show('PutawayDetail');	 
                            ]]>
                        </RowClick>
                    </ListView>
                    <!-- </RefreshControl> -->
                    <RowDefCollection RowGap="5">
                        <RowDef Height="100%"/>
                    </RowDefCollection>
                    <ColumnDefCollection ColumnGap="5">
                        <ColumnDef Width="100%"/>
                    </ColumnDefCollection>
                </GridLayoutPanel>
                <GridLayoutPanel Key="GridLayoutPanel2" Caption="上架历史" X="0" Y="1" YSpan="2" Visible="ShowValue==1">
                    <Format BackColor="#f1f3f8"/>
                    <RefreshControl ColorSchemes="#17bb92" Key="RefreshControl2" Caption="刷新控件" X="0" Y="1" ProgressBackgroundColorScheme="#cccccc">
                        <RefreshHeader Icon="" PromptText="正在加载" FinishText="加载完成">
                            <![CDATA[/*var show=GetValue('ShowValue');
var isshow = IsShow;
LoadData();
IsShow=isshow;
SetValue('ShowValue', show,true);
ShowToast("没有更多的消息了")
*/
var show = IsShow;
DealCondition();
LoadData();
IsShow=show;]]>
                            <Format/>
                        </RefreshHeader>
                        <!-- 	<RefreshFooter Icon="" PromptText="正在加载" FinishText="加载完成">
						<Format/>
						<![CDATA[LoadData();ShowToast("没有更多的消息了")]]>
					</RefreshFooter> -->
                        <ListView Caption="上架历史" Key="list2" TableKey="LRP_Putaway_HHis" RowHeight="70" Enable="true" PageLoadType="DB" PageRowCount="10" HasBorder="true" BorderColor="#e6e6e6" Padding="5px">
                            <ListViewColumnCollection>
                                <ListViewColumn Key="No2" DataColumnKey="No" Caption="上架单号"/>
                                <ListViewColumn Caption="货主" DataColumnKey="OwnerName" Key="OwnerName2"/>
                                <ListViewColumn Caption="通知单号" DataColumnKey="RefNo" Key="NoticeNo2"/>
                                <ListViewColumn Caption="事务日期时间" ColumnType="DatePicker" DataColumnKey="CREATETIME" Key="CREATETIME2">
                                    <Format HAlign="Left"/>
                                </ListViewColumn>
                                <ListViewColumn Caption="状态" ColumnType="ComboBox" Key="Status" DataColumnKey="Status">
                                    <Item Caption="已输入" Key="100" Value="100"/>
                                    <Item Caption="处理中" Key="500" Value="500"/>
                                    <Item Caption="已完成" Key="900" Value="900"/>
                                </ListViewColumn>
                                <ListViewColumn Key="OID2" DataColumnKey="OID" Caption="OID"/>
                            </ListViewColumnCollection>
                            <RowClick>
                                <![CDATA[
                                    PushPara('OID',OID2);
									Show('PutawayHistoryDetail');
            						
                            ]]>
                            </RowClick>
                        </ListView>
                    </RefreshControl>
                    <HyperLink Key="Label2" Visible="GetRowCount('list2')==0" Caption="当前没有已上架的单据！" X="0" Y="1">
                        <Format ForeColor="#000000" HAlign="Center">
                            <Font Size="26"/>
                        </Format>
                    </HyperLink>
                    <RowDefCollection RowGap="5">
                        <RowDef Height="3px"/>
                        <RowDef Height="100%"/>
                    </RowDefCollection>
                    <ColumnDefCollection ColumnGap="5">
                        <ColumnDef Width="100%"/>
                    </ColumnDefCollection>
                </GridLayoutPanel>
                <RowDefCollection>
                    <RowDef Height="50px"/>
                    <RowDef Height="150px"/>
                    <RowDef Height="100%"/>
                </RowDefCollection>
                <ColumnDefCollection>
                    <ColumnDef Width="100%"/>
                </ColumnDefCollection>
            </GridLayoutPanel>
        </Block>
        <ViewCollection>
            <View Key="All">
                <ComponentView Key="list">
                    <GridLayout Key="list">
                        <LayoutSpan Key="SelectField" X="0" Y="0"/>
                        <LayoutSpan Key="NoticeNo" X="1" Y="0"/>
                        <LayoutSpan Key="OwnerName" X="3" Y="0"/>
                        <LayoutSpan Key="TxTypeCode" X="5" Y="0"/>
                        <LayoutSpan Key="CREATETIME" X="1" Y="1"/>
                        <LayoutSpan Key="OwnerNo" X="3" Y="1"/>
                        <LayoutSpan Key="Creator" X="5" Y="1"/>
                        <RowDefCollection>
                            <RowDef Height="35px"/>
                            <RowDef Height="35px"/>
                        </RowDefCollection>
                        <ColumnDefCollection>
                            <ColumnDef Width="5px"/>
                            <ColumnDef Width="45%"/>
                            <ColumnDef Width="5px"/>
                            <ColumnDef Width="20%"/>
                            <ColumnDef Width="5px"/>
                            <ColumnDef Width="35%"/>
                            <ColumnDef Width="5px"/>
                        </ColumnDefCollection>
                    </GridLayout>
                </ComponentView>
                <ComponentView Key="list2">
                    <GridLayout Key="list2">
                        <LayoutSpan Key="No2" X="1" Y="0"/>
                        <LayoutSpan Key="OwnerName2" X="3" Y="1"/>
                        <LayoutSpan Key="CREATETIME2" X="1" Y="1"/>
                        <LayoutSpan Key="NoticeNo2" X="3" Y="0" XSpan="3"/>
                        <LayoutSpan Key="Status" X="5" Y="1"/>
                        <RowDefCollection>
                            <RowDef Height="35px"/>
                            <RowDef Height="35px"/>
                        </RowDefCollection>
                        <ColumnDefCollection>
                            <ColumnDef Width="5px"/>
                            <ColumnDef Width="45%"/>
                            <ColumnDef Width="5px"/>
                            <ColumnDef Width="35%"/>
                            <ColumnDef Width="5px"/>
                            <ColumnDef Width="20%"/>
                            <ColumnDef Width="5px"/>
                        </ColumnDefCollection>
                    </GridLayout>
                </ComponentView>
            </View>
        </ViewCollection>
    </Body>
    <OnLoad>
        <![CDATA[LoadData();]]>
    </OnLoad>
    <!-- <ScriptCollection>		
		<Script Key="FormActive" Range="Action" Verb="Show">
			 <![CDATA[LoadData()]]>
		</Script>
	</ScriptCollection> -->
    <MacroCollection>
        <Macro Key="CalculateQty" Description="计算并设置总通知量和总收货量">
            <![CDATA[
				var total = 0.0;
				var recvqty = 0.0; 
				
				var count = GetRowCount('list');
				var i = 0;
				while(i < count){
					total = total + GetCellValue('list',i,'Qty');
					recvqty = recvqty + GetCellValue('list',i,'CheckQty');
					i = i + 1;							
				}
				SetValue('NoticeQty_code',total);
				SetValue('RecvQty_Null_code',recvqty);
			]]>
        </Macro>
        <Macro Key="SelectTable" Description="根据通知单号查找通知单">
            <![CDATA[
				 if(select<>''){										 
				  var dt1 = DBNamedQuery('SelectInboundNotice',GetValue('select'));
				  var dt2 = DBNamedQuery('SelectReturnNotice',GetValue('select'));
				  var dt3 = DBNamedQuery('SelectCrossDock',GetValue('select'));
				  dt1.beforefirst();
				  dt2.beforefirst();
				  dt3.beforefirst();
					
				  if(dt1.next()){
					   ReplaceTable('LRP_Notice_H',dt1);  	   
				  }										  
				  if(dt2.next()){
					   ReplaceTable('LRP_Notice_H',dt2);  
				  }
				   if(dt3.next()){
					  ReplaceTable('LRP_Notice_H',dt3);  
				  }										 									  
				  RefreshControl('GridLayoutPanel1');
				  
				  }else{
					var dt = DBNamedQuery('SelectNotice');
					 ReplaceTable('LRP_Notice_H',dt);  
					 RefreshControl('GridLayoutPanel1');
				  }
			]]>
        </Macro>
    </MacroCollection>
    <FormParaCollection>
        <FormPara DataType="Long" Key="UserDispatchOrg" Type="Formula" Formula="root.GetPara('WarehouseCenterId')"/>
    </FormParaCollection>
    <NavigationBar BackColor="#f14c52" Style="Custom">
        <BarItem Key="TitleCenter_bar" Caption="按收货单上架" Location="Center">
            <Label Key="TitleCenter" Caption="按收货单上架" Width="150px">
                <Format ForeColor="#ffffff" HAlign="Center">
                    <Font Size="20"/>
                </Format>
            </Label>
        </BarItem>
    </NavigationBar>
</Form>
