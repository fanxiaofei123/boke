<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="TakeStockByOrder" FormType="View">
    <DataSource>
        <DataObject Caption="按单盘点" Key="TakeStockByOrder" PrimaryTableKey="TakeStockByOrder">
            <TableCollection>
                <Table Caption="按单盘点" Key="TakeStockByOrderConfirm" SourceType="Query" TableMode="Detail" Persist="false">
					<Column Caption="OID" DataType="Long" Key="OID"/>
                    <Column Caption="盘点单号" DataType="Varchar" Key="No"/>
                    <Column Caption="货主" DataType="Long" Key="OwnerId"/>
                    <Column Caption="盘点日期时间" DataType="DateTime" Key="CheckDatetime"/>
                    <Statement>
                        <![CDATA[
						select H.OID,H.No,H.OwnerId,H.CheckDatetime from LRP_TakeStock_H H right join LRP_WarehouseKeeper WK on H.WarehouseCenterId=WK.WarehouseCenterId where H.status=200 and WK.OID=?
						]]>
                    </Statement>
					<ParameterCollection>
                        <Parameter Formula="GetUserOperator()" DataType="Long"/>
                    </ParameterCollection>
                </Table>
				<Table Caption="按单盘点" Key="TakeStockByOrderFinish" SourceType="Query" TableMode="Detail" Persist="false">
					<Column Caption="OID" DataType="Long" Key="OID"/>
                    <Column Caption="盘点单号" DataType="Varchar" Key="No"/>
                    <Column Caption="货主" DataType="Long" Key="OwnerId"/>
                    <Column Caption="盘点日期时间" DataType="DateTime" Key="CheckDatetime"/>
					<Column Caption="盘点员" DataType="Varchar" Key="CheckPerson"/>
                    <Statement>
                        <![CDATA[
						select H.OID,H.No,H.OwnerId,H.CheckDatetime,H.CheckPerson from LRP_TakeStock_H H right join LRP_WarehouseKeeper WK on H.WarehouseCenterId=WK.WarehouseCenterId where H.status=900 and WK.OID=?
						]]>
                    </Statement>
					<ParameterCollection>
                        <Parameter Formula="GetUserOperator()" DataType="Long"/>
                    </ParameterCollection>
                </Table>
            </TableCollection>
        </DataObject>
    </DataSource>
	<ScriptCollection>		
		<Script Key="FormActive" Range="Action" Verb="Show">
			<![CDATA[
			if(!IsLogin()){
				return true;
			}
             LoadData();
			]]>
		</Script>
	</ScriptCollection>
    <Body>
        <Block>
			<GridLayoutPanel Key="root">
				<Label Key="ShowValue" X="0" Y="0" Visible="false"/>
				<TabGroup Caption="订单管理" Key="TabPanel1" IndicatorColor="#ff5000" X="0" Y="0">
					<TabItem Text="查找盘点单">
						<Action>
							<![CDATA[SetValue('ShowValue', 0);]]>
						</Action>
					</TabItem>
					<TabItem Text="盘点历史">
						<Action>
							<![CDATA[SetValue('ShowValue', 1);]]>
						</Action>
					</TabItem>
				</TabGroup>
				<GridLayoutPanel Key="GridLayoutPanel1" Caption="GridLayoutPanel1" X="0" Y="1" Visible="ShowValue==0 || Length(ShowValue) == 0">
				 <RefreshControl ColorSchemes="#17bb92" Key="RefreshControl1" Caption="刷新控件" ProgressBackgroundColorScheme="#cccccc" X="0" Y="0">
                        <RefreshHeader Icon="" PromptText="正在加载" FinishText="加载完成">
                            <![CDATA[LoadData();ShowToast("没有更多的消息了")]]>
                            <Format/>
                        </RefreshHeader>
                        <RefreshFooter Icon="" PromptText="正在加载" FinishText="加载完成">
                            <![CDATA[LoadData();ShowToast("没有更多的消息了")]]>
                            <Format/>
                        </RefreshFooter>
					<ListView Key="listConfirm" Caption="按单盘点" TableKey="TakeStockByOrderConfirm" RowHeight="60" ShowHead="false" SeparatorStyle="solid none solid none" Padding="5px">
						<ListViewColumnCollection>
							<ListViewColumn Key="OID" Caption="OID" DataColumnKey="OID" ColumnType="TextEditor" Visible="false"/>
							<ListViewColumn Key="No" Caption="盘点单号" DataColumnKey="No" ColumnType="TextEditor"/>
							<ListViewColumn Key="OwnerId" Caption="货主" DataColumnKey="OwnerId" ColumnType="Dict" ItemKey="LRP_Owner"/>
							<ListViewColumn Key="CheckDatetime" Caption="盘点日期时间" DataColumnKey="CheckDatetime" ColumnType="DatePicker">
								<Format HAlign="Left"/>
							</ListViewColumn>		
						</ListViewColumnCollection>
						<RowClick>
							<![CDATA[
								PushPara('OID',OID);Open('TakeStock',OID);      
							]]>
						</RowClick>
					</ListView>
					   </RefreshControl>
					<RowDefCollection>
						<RowDef Height="100%"/>
					</RowDefCollection>
					<ColumnDefCollection>
						<ColumnDef Width="100%"/>
					</ColumnDefCollection>
				</GridLayoutPanel>
				<GridLayoutPanel Key="GridLayoutPanel2" Caption="GridLayoutPanel2" X="0" Y="1" Visible="ShowValue==1">
				 <RefreshControl ColorSchemes="#17bb92" Key="RefreshControl2" Caption="刷新控件" ProgressBackgroundColorScheme="#cccccc" X="0" Y="0">
                        <RefreshHeader Icon="" PromptText="正在加载" FinishText="加载完成">
                            <![CDATA[LoadData();ShowToast("没有更多的消息了")]]>
                            <Format/>
                        </RefreshHeader>
                        <RefreshFooter Icon="" PromptText="正在加载" FinishText="加载完成">
                            <![CDATA[LoadData();ShowToast("没有更多的消息了")]]>
                            <Format/>
                        </RefreshFooter>
					<ListView Key="listFinish" Caption="按单盘点" TableKey="TakeStockByOrderFinish" RowHeight="60" ShowHead="false" SeparatorStyle="solid none solid none" Padding="5px">
						<ListViewColumnCollection>
							<ListViewColumn Key="OID_f" Caption="OID" DataColumnKey="OID" ColumnType="TextEditor" Visible="false"/>
							<ListViewColumn Key="No_f" Caption="盘点单号" DataColumnKey="No" ColumnType="TextEditor"/>
							<ListViewColumn Key="OwnerId_f" Caption="货主" DataColumnKey="OwnerId" ColumnType="Dict" ItemKey="LRP_Owner"/>
							<ListViewColumn Key="CheckDatetime_f" Caption="盘点日期时间" DataColumnKey="CheckDatetime" ColumnType="DatePicker">
								<Format HAlign="Left"/>
							</ListViewColumn>
							<ListViewColumn Key="CheckPerson_f" Caption="盘点员" DataColumnKey="CheckPerson" ColumnType="TextEditor"/>						
						</ListViewColumnCollection>
						<RowClick>
							<![CDATA[
								PushPara('OID',OID_f);Open('TakeStockDetail',OID_f);      
							]]>
						</RowClick>
					</ListView>
					   </RefreshControl>
					<RowDefCollection>
						<RowDef Height="100%"/>
					</RowDefCollection>
					<ColumnDefCollection>
						<ColumnDef Width="100%"/>
					</ColumnDefCollection>
				</GridLayoutPanel>
				<RowDefCollection>
					<RowDef Height="50px"/>
					<RowDef Height="100%"/>
				</RowDefCollection>
				<ColumnDefCollection>
					<ColumnDef Width="100%"/>
				</ColumnDefCollection>
            </GridLayoutPanel>
        </Block>
        <ViewCollection>
            <View Key="Confirm">
                <ComponentView Key="listConfirm">
                    <GridLayout Key="listConfirm">
                        <LayoutSpan Key="No" X="0" Y="0"/>
                        <LayoutSpan Key="OwnerId" X="1" Y="0"/>
                        <LayoutSpan Key="CheckDatetime" X="0" Y="1"/>
                        <RowDefCollection>
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                        </RowDefCollection>
                        <ColumnDefCollection>
                            <ColumnDef Width="70%"/>
							<ColumnDef Width="30%"/>
                        </ColumnDefCollection>
                    </GridLayout>
                </ComponentView>
				<ComponentView Key="listFinish">
                    <GridLayout Key="listFinish">
                        <LayoutSpan Key="No_f" X="0" Y="0"/>
                        <LayoutSpan Key="OwnerId_f" X="1" Y="0"/>
                        <LayoutSpan Key="CheckDatetime_f" X="0" Y="1"/>
						<LayoutSpan Key="CheckPerson_f" X="1" Y="1"/>
                        <RowDefCollection>
                            <RowDef Height="30px"/>
                            <RowDef Height="30px"/>
                        </RowDefCollection>
                        <ColumnDefCollection>
                            <ColumnDef Width="70%"/>
							<ColumnDef Width="30%"/>
                        </ColumnDefCollection>
                    </GridLayout>
                </ComponentView>
            </View>
        </ViewCollection>
    </Body>
    <NavigationBar BackColor="#f14c52" Style="Custom">
        <BarItem Key="TitleCenter_bar" Caption="按单盘点" Location="Center">
            <Label Key="TitleCenter" Caption="按单盘点" Width="150px">
                <Format ForeColor="#ffffff" HAlign="Center">
                    <Font Size="20"/>
                </Format>
            </Label>
        </BarItem>
    </NavigationBar>
	<OnLoad>
        <![CDATA[
			LoadData();
        ]]>
    </OnLoad>
</Form>
